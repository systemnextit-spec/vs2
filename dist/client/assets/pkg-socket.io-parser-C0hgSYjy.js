import{E as C,a as O}from"./pkg-@socket.io-component-emitter-B3A4JZne.js";const m=typeof ArrayBuffer=="function",_=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,w=Object.prototype.toString,V=typeof Blob=="function"||typeof Blob<"u"&&w.call(Blob)==="[object BlobConstructor]",S=typeof File=="function"||typeof File<"u"&&w.call(File)==="[object FileConstructor]";function N(e){return m&&(e instanceof ArrayBuffer||_(e))||V&&e instanceof Blob||S&&e instanceof File}function f(e,r){if(!e||typeof e!="object")return!1;if(Array.isArray(e)){for(let t=0,n=e.length;t<n;t++)if(f(e[t]))return!0;return!1}if(N(e))return!0;if(e.toJSON&&typeof e.toJSON=="function"&&arguments.length===1)return f(e.toJSON(),!0);for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&f(e[t]))return!0;return!1}function I(e){const r=[],t=e.data,n=e;return n.data=a(t,r),n.attachments=r.length,{packet:n,buffers:r}}function a(e,r){if(!e)return e;if(N(e)){const t={_placeholder:!0,num:r.length};return r.push(e),t}else if(Array.isArray(e)){const t=new Array(e.length);for(let n=0;n<e.length;n++)t[n]=a(e[n],r);return t}else if(typeof e=="object"&&!(e instanceof Date)){const t={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=a(e[n],r));return t}return e}function v(e,r){return e.data=h(e.data,r),delete e.attachments,e}function h(e,r){if(!e)return e;if(e&&e._placeholder===!0){if(typeof e.num=="number"&&e.num>=0&&e.num<r.length)return r[e.num];throw new Error("illegal attachments")}else if(Array.isArray(e))for(let t=0;t<e.length;t++)e[t]=h(e[t],r);else if(typeof e=="object")for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(e[t]=h(e[t],r));return e}const k=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Y=5;var i;(function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"})(i||(i={}));let T=class{constructor(r){this.replacer=r}encode(r){return(r.type===i.EVENT||r.type===i.ACK)&&f(r)?this.encodeAsBinary({type:r.type===i.EVENT?i.BINARY_EVENT:i.BINARY_ACK,nsp:r.nsp,data:r.data,id:r.id}):[this.encodeAsString(r)]}encodeAsString(r){let t=""+r.type;return(r.type===i.BINARY_EVENT||r.type===i.BINARY_ACK)&&(t+=r.attachments+"-"),r.nsp&&r.nsp!=="/"&&(t+=r.nsp+","),r.id!=null&&(t+=r.id),r.data!=null&&(t+=JSON.stringify(r.data,this.replacer)),t}encodeAsBinary(r){const t=I(r),n=this.encodeAsString(t.packet),u=t.buffers;return u.unshift(n),u}};function d(e){return Object.prototype.toString.call(e)==="[object Object]"}let K=class B extends C{constructor(r){super(),this.reviver=r}add(r){let t;if(typeof r=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(r);const n=t.type===i.BINARY_EVENT;n||t.type===i.BINARY_ACK?(t.type=n?i.EVENT:i.ACK,this.reconstructor=new D(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(N(r)||r.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(r),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+r)}decodeString(r){let t=0;const n={type:Number(r.charAt(0))};if(i[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===i.BINARY_EVENT||n.type===i.BINARY_ACK){const c=t+1;for(;r.charAt(++t)!=="-"&&t!=r.length;);const o=r.substring(c,t);if(o!=Number(o)||r.charAt(t)!=="-")throw new Error("Illegal attachments");n.attachments=Number(o)}if(r.charAt(t+1)==="/"){const c=t+1;for(;++t&&!(r.charAt(t)===","||t===r.length););n.nsp=r.substring(c,t)}else n.nsp="/";const u=r.charAt(t+1);if(u!==""&&Number(u)==u){const c=t+1;for(;++t;){const o=r.charAt(t);if(o==null||Number(o)!=o){--t;break}if(t===r.length)break}n.id=Number(r.substring(c,t+1))}if(r.charAt(++t)){const c=this.tryParse(r.substr(t));if(B.isPayloadValid(n.type,c))n.data=c;else throw new Error("invalid payload")}return n}tryParse(r){try{return JSON.parse(r,this.reviver)}catch{return!1}}static isPayloadValid(r,t){switch(r){case i.CONNECT:return d(t);case i.DISCONNECT:return t===void 0;case i.CONNECT_ERROR:return typeof t=="string"||d(t);case i.EVENT:case i.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&k.indexOf(t[0])===-1);case i.ACK:case i.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}},D=class{constructor(r){this.packet=r,this.buffers=[],this.reconPack=r}takeBinaryData(r){if(this.buffers.push(r),this.buffers.length===this.reconPack.attachments){const t=v(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}};const Q=Object.freeze(Object.defineProperty({__proto__:null,Decoder:K,Encoder:T,get PacketType(){return i},protocol:Y},Symbol.toStringTag,{value:"Module"})),$=typeof ArrayBuffer=="function",b=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,R=Object.prototype.toString,x=typeof Blob=="function"||typeof Blob<"u"&&R.call(Blob)==="[object BlobConstructor]",F=typeof File=="function"||typeof File<"u"&&R.call(File)==="[object FileConstructor]";function A(e){return $&&(e instanceof ArrayBuffer||b(e))||x&&e instanceof Blob||F&&e instanceof File}function l(e,r){if(!e||typeof e!="object")return!1;if(Array.isArray(e)){for(let t=0,n=e.length;t<n;t++)if(l(e[t]))return!0;return!1}if(A(e))return!0;if(e.toJSON&&typeof e.toJSON=="function"&&arguments.length===1)return l(e.toJSON(),!0);for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&l(e[t]))return!0;return!1}function J(e){const r=[],t=e.data,n=e;return n.data=y(t,r),n.attachments=r.length,{packet:n,buffers:r}}function y(e,r){if(!e)return e;if(A(e)){const t={_placeholder:!0,num:r.length};return r.push(e),t}else if(Array.isArray(e)){const t=new Array(e.length);for(let n=0;n<e.length;n++)t[n]=y(e[n],r);return t}else if(typeof e=="object"&&!(e instanceof Date)){const t={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=y(e[n],r));return t}return e}function P(e,r){return e.data=p(e.data,r),delete e.attachments,e}function p(e,r){if(!e)return e;if(e&&e._placeholder===!0){if(typeof e.num=="number"&&e.num>=0&&e.num<r.length)return r[e.num];throw new Error("illegal attachments")}else if(Array.isArray(e))for(let t=0;t<e.length;t++)e[t]=p(e[t],r);else if(typeof e=="object")for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(e[t]=p(e[t],r));return e}const L=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],z=5;var s;(function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"})(s||(s={}));class M{constructor(r){this.replacer=r}encode(r){return(r.type===s.EVENT||r.type===s.ACK)&&l(r)?this.encodeAsBinary({type:r.type===s.EVENT?s.BINARY_EVENT:s.BINARY_ACK,nsp:r.nsp,data:r.data,id:r.id}):[this.encodeAsString(r)]}encodeAsString(r){let t=""+r.type;return(r.type===s.BINARY_EVENT||r.type===s.BINARY_ACK)&&(t+=r.attachments+"-"),r.nsp&&r.nsp!=="/"&&(t+=r.nsp+","),r.id!=null&&(t+=r.id),r.data!=null&&(t+=JSON.stringify(r.data,this.replacer)),t}encodeAsBinary(r){const t=J(r),n=this.encodeAsString(t.packet),u=t.buffers;return u.unshift(n),u}}function g(e){return Object.prototype.toString.call(e)==="[object Object]"}class E extends O{constructor(r){super(),this.reviver=r}add(r){let t;if(typeof r=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(r);const n=t.type===s.BINARY_EVENT;n||t.type===s.BINARY_ACK?(t.type=n?s.EVENT:s.ACK,this.reconstructor=new U(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(A(r)||r.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(r),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+r)}decodeString(r){let t=0;const n={type:Number(r.charAt(0))};if(s[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===s.BINARY_EVENT||n.type===s.BINARY_ACK){const c=t+1;for(;r.charAt(++t)!=="-"&&t!=r.length;);const o=r.substring(c,t);if(o!=Number(o)||r.charAt(t)!=="-")throw new Error("Illegal attachments");n.attachments=Number(o)}if(r.charAt(t+1)==="/"){const c=t+1;for(;++t&&!(r.charAt(t)===","||t===r.length););n.nsp=r.substring(c,t)}else n.nsp="/";const u=r.charAt(t+1);if(u!==""&&Number(u)==u){const c=t+1;for(;++t;){const o=r.charAt(t);if(o==null||Number(o)!=o){--t;break}if(t===r.length)break}n.id=Number(r.substring(c,t+1))}if(r.charAt(++t)){const c=this.tryParse(r.substr(t));if(E.isPayloadValid(n.type,c))n.data=c;else throw new Error("invalid payload")}return n}tryParse(r){try{return JSON.parse(r,this.reviver)}catch{return!1}}static isPayloadValid(r,t){switch(r){case s.CONNECT:return g(t);case s.DISCONNECT:return t===void 0;case s.CONNECT_ERROR:return typeof t=="string"||g(t);case s.EVENT:case s.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&L.indexOf(t[0])===-1);case s.ACK:case s.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class U{constructor(r){this.packet=r,this.buffers=[],this.reconPack=r}takeBinaryData(r){if(this.buffers.push(r),this.buffers.length===this.reconPack.attachments){const t=P(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const W=Object.freeze(Object.defineProperty({__proto__:null,Decoder:E,Encoder:M,get PacketType(){return s},protocol:z},Symbol.toStringTag,{value:"Module"}));export{i as P,Y as a,s as b,W as c,Q as p};
