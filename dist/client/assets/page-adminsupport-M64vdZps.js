import{j as e}from"./react-jsx-runtime-BBsywpoz.js";import{r}from"./react-core-KcGD0Z1V.js";import{g as x}from"./cmp-addnewduemodal-tsx-OjU2U-0e.js";import{toast as l}from"./pkg-toast-Dpd4iwUK.js";import{R as Y}from"./cmp-richtexteditor-tsx-CETSPEY1.js";import{P as G,L as C,aO as Q,aB as R,d as Z,X as T,aK as z,I as ee,aS as M,T as se}from"./icons-chunk-AVFeydwE.js";import"./pkg-eventemitter3-CXfM2dhT.js";import"./pkg-goober-N6sOClW1.js";const te=()=>{if(typeof window>"u")return"https://allinbangla.com/api";const i=window.location.hostname;if(i==="localhost"||i==="127.0.0.1"||i.endsWith(".localhost"))return"http://localhost:5001/api";const m=i.split("."),h=m.length>2?m.slice(-2).join("."):i;return`${window.location.protocol}//${h}/api`},p=te(),de=({user:i,activeTenant:m})=>{const[h,O]=r.useState([]),[B,A]=r.useState(!0),[u,H]=r.useState("all"),[q,b]=r.useState(!1),[t,g]=r.useState(null),[F,U]=r.useState(!1),[y,$]=r.useState("issue"),[j,E]=r.useState(""),[c,w]=r.useState([]),[I,D]=r.useState(!1),d=r.useCallback(async()=>{try{A(!0);const s=new URLSearchParams;u!=="all"&&s.append("type",u),m?.id&&s.append("tenantId",m.id);const a=await fetch(`${p}/support?${s.toString()}`,{headers:x()});if(!a.ok)throw new Error("Failed to fetch tickets");const n=await a.json();O(n.data||[])}catch(s){console.error("Error fetching tickets:",s),l.error("Failed to load support tickets")}finally{A(!1)}},[u,m?.id]);r.useEffect(()=>{d()},[d]);const W=async()=>{if(!j.trim()){l.error("Please enter a description");return}try{if(U(!0),!(await fetch(`${p}/support`,{method:"POST",headers:{...x(),"Content-Type":"application/json"},body:JSON.stringify({type:y,description:j,images:c,userName:i?.name,tenantId:m?.id})})).ok)throw new Error("Failed to create ticket");l.success("Support ticket submitted successfully"),b(!1),P(),d()}catch(s){console.error("Error creating ticket:",s),l.error("Failed to submit support ticket")}finally{U(!1)}},P=()=>{$("issue"),E(""),w([])},J=async s=>{const a=s.target.files;if(!(!a||a.length===0)){if(c.length+a.length>3){l.error("Maximum 3 images allowed");return}D(!0);try{const n=Array.from(a).map(async k=>{const f=new FormData;f.append("file",k),f.append("tenantId",m?.id||"default"),f.append("folder","support");const _=await fetch(`${p}/upload`,{method:"POST",headers:{Authorization:x().Authorization||""},body:f});if(!_.ok)throw new Error("Upload failed");const S=await _.json();return S.imageUrl||S.url||S.path}),o=await Promise.all(n);w(k=>[...k,...o.filter(Boolean)]),l.success("Images uploaded")}catch(n){console.error("Error uploading images:",n),l.error("Failed to upload images")}finally{D(!1)}}},K=s=>{w(a=>a.filter((n,o)=>o!==s))},V=async(s,a)=>{try{if(!(await fetch(`${p}/support/${s}`,{method:"PATCH",headers:{...x(),"Content-Type":"application/json"},body:JSON.stringify({status:a})})).ok)throw new Error("Failed to update ticket");l.success("Ticket status updated"),d(),t?.id===s&&g(o=>o?{...o,status:a}:null)}catch(n){console.error("Error updating ticket:",n),l.error("Failed to update ticket status")}},X=async s=>{if(confirm("Are you sure you want to delete this ticket?"))try{if(!(await fetch(`${p}/support/${s}`,{method:"DELETE",headers:x()})).ok)throw new Error("Failed to delete ticket");l.success("Ticket deleted"),d(),t?.id===s&&g(null)}catch(a){console.error("Error deleting ticket:",a),l.error("Failed to delete ticket")}},N=s=>{const a=new Date(s);return a.toLocaleDateString("en-US",{day:"2-digit",month:"short",year:"numeric"})+" - "+a.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})},v=s=>{switch(s){case"pending":return"bg-orange-500";case"in-progress":return"bg-blue-500";case"resolved":return"bg-green-500";case"closed":return"bg-gray-500"}},L=s=>{switch(s){case"issue":return"bg-red-500";case"feedback":return"bg-blue-500";case"feature":return"bg-purple-500"}};return e.jsxs("div",{className:"p-4 sm:p-6 min-h-screen bg-[#F8FAFC]",children:[e.jsxs("div",{className:"flex flex-col xs:flex-row items-start xs:items-center justify-between gap-3 mb-4 sm:mb-6",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-gray-800",children:"Support"}),e.jsxs("button",{onClick:()=>b(!0),className:"flex items-center gap-2 px-3 sm:px-4 py-2 sm:py-2.5 bg-violet-600 text-white rounded-lg hover:bg-violet-700 transition font-medium text-sm sm:text-base w-full xs:w-auto justify-center",children:[e.jsx(G,{className:"w-4 h-4"}),"Add New"]})]}),e.jsx("div",{className:"flex gap-2 mb-4 sm:mb-6 overflow-x-auto pb-2 scrollbar-hide",children:["all","issue","feedback","feature"].map(s=>e.jsx("button",{onClick:()=>H(s),className:`px-3 sm:px-4 py-1.5 sm:py-2 rounded-full text-xs sm:text-sm font-medium transition whitespace-nowrap flex-shrink-0 ${u===s?"bg-green-500 text-white":"bg-white text-gray-600 hover:bg-gray-100 border border-gray-200"}`,children:s==="all"?"All":s.charAt(0).toUpperCase()+s.slice(1)},s))}),B?e.jsx("div",{className:"flex items-center justify-center py-12 sm:py-20",children:e.jsx(C,{className:"w-6 h-6 sm:w-8 sm:h-8 animate-spin text-violet-600"})}):h.length===0?e.jsxs("div",{className:"text-center py-12 sm:py-20 text-gray-500",children:[e.jsx(Q,{className:"w-10 h-10 sm:w-12 sm:h-12 mx-auto mb-3 sm:mb-4 text-gray-300"}),e.jsx("p",{className:"text-sm sm:text-base",children:"No support tickets found"})]}):e.jsx("div",{className:"grid gap-3 sm:gap-4",children:h.map(s=>e.jsx("div",{className:"bg-white rounded-lg sm:rounded-xl p-3 sm:p-4 shadow-sm border border-gray-100 hover:shadow-md transition cursor-pointer active:bg-gray-50",onClick:()=>g(s),children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 mb-2 sm:mb-3 flex-wrap",children:[e.jsx("span",{className:`px-2 sm:px-3 py-0.5 sm:py-1 rounded-full text-[10px] sm:text-xs font-medium text-white ${L(s.type)}`,children:s.type.charAt(0).toUpperCase()+s.type.slice(1)}),e.jsx("span",{className:`px-2 sm:px-3 py-0.5 sm:py-1 rounded-full text-[10px] sm:text-xs font-medium text-white ${v(s.status)}`,children:s.status.charAt(0).toUpperCase()+s.status.slice(1).replace("-"," ")})]}),e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 text-xs sm:text-sm text-gray-500 mb-1.5 sm:mb-2",children:[e.jsx(R,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),e.jsx("span",{className:"truncate",children:N(s.createdAt)})]}),e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 text-xs sm:text-sm mb-2 sm:mb-3",children:[e.jsx("span",{className:"text-gray-500",children:"Assigned To:"}),s.assignedTo?e.jsx("span",{className:"text-gray-700 font-medium truncate",children:s.assignedTo.name}):e.jsx("span",{className:"text-orange-500 font-medium",children:"Not Assign Yet!"})]}),e.jsx("div",{className:"text-xs sm:text-sm text-gray-700 line-clamp-2",dangerouslySetInnerHTML:{__html:s.description.replace(/<[^>]+>/g," ").slice(0,150)+"..."}})]}),e.jsx("div",{className:"relative flex-shrink-0",children:e.jsx("button",{onClick:a=>{a.stopPropagation()},className:"p-1.5 sm:p-2 hover:bg-gray-100 rounded-lg transition",children:e.jsx(Z,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-400"})})})]})},s.id))}),q&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-end sm:items-center justify-center z-50 p-0 sm:p-4",children:e.jsxs("div",{className:"bg-white rounded-t-2xl sm:rounded-2xl w-full sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 sm:p-4 border-b sticky top-0 bg-white z-10",children:[e.jsx("h2",{className:"text-base sm:text-lg font-semibold text-gray-800",children:"Create Support Ticket"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>{b(!1),P()},className:"flex items-center gap-1 sm:gap-2 px-3 sm:px-4 py-1.5 sm:py-2 text-red-600 border border-red-200 rounded-lg hover:bg-red-50 transition text-sm",children:[e.jsx(T,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden xs:inline",children:"Discard"})]}),e.jsxs("button",{onClick:W,disabled:F,className:"flex items-center gap-1 sm:gap-2 px-3 sm:px-4 py-1.5 sm:py-2 bg-violet-600 text-white rounded-lg hover:bg-violet-700 transition disabled:opacity-50 text-sm",children:[F?e.jsx(C,{className:"w-4 h-4 animate-spin"}):e.jsx(z,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden xs:inline",children:"Submit Data"}),e.jsx("span",{className:"xs:hidden",children:"Submit"})]})]})]}),e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsx("div",{className:"grid grid-cols-1 xs:grid-cols-3 gap-3 sm:gap-4 mb-4 sm:mb-6",children:[{type:"issue",title:"Website Issue",desc:"Report a problem you faced"},{type:"feedback",title:"Website Feedback",desc:"Share your experience"},{type:"feature",title:"Custom Feature",desc:"Request a new feature"}].map(s=>e.jsxs("button",{onClick:()=>$(s.type),className:`relative p-3 sm:p-4 rounded-lg sm:rounded-xl border-2 text-left transition ${y===s.type?"border-green-500 bg-green-50":"border-gray-200 hover:border-gray-300"}`,children:[y===s.type&&e.jsx("div",{className:"absolute -to p-2 -left-2 w-5 h-5 sm:w-6 sm:h-6 bg-green-500 rounded-full flex items-center justify-center",children:e.jsx(z,{className:"w-3 h-3 sm:w-4 sm:h-4 text-white"})}),e.jsx("h3",{className:"font-semibold text-gray-800 mb-0.5 sm:mb-1 text-sm sm:text-base",children:s.title}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500",children:s.desc})]},s.type))}),e.jsxs("div",{className:"mb-4 sm:mb-6",children:[e.jsx("label",{className:"block",children:e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg sm:rounded-xl p-4 sm:p-6 text-center cursor-pointer hover:border-gray-400 transition",children:[e.jsx(ee,{className:"w-8 h-8 sm:w-10 sm:h-10 mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"font-medium text-gray-700 text-sm sm:text-base",children:"Upload Image"}),e.jsx("p",{className:"text-xs sm:text-sm text-green-500",children:"Please select up to 3 images"}),e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:J,className:"hidden",disabled:I||c.length>=3})]})}),c.length>0&&e.jsx("div",{className:"flex gap-2 mt-3 flex-wrap",children:c.map((s,a)=>e.jsxs("div",{className:"relative w-16 h-16 sm:w-20 sm:h-20 rounded-lg overflow-hidden",children:[e.jsx("img",{src:s,alt:"",className:"w-full h-full object-cover"}),e.jsx("button",{onClick:()=>K(a),className:"absolute top-1 right-1 w-4 h-4 sm:w-5 sm:h-5 bg-red-500 text-white rounded-full flex items-center justify-center",children:e.jsx(T,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3"})})]},a))}),I&&e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-xs sm:text-sm text-gray-500",children:[e.jsx(C,{className:"w-4 h-4 animate-spin"}),"Uploading..."]})]}),e.jsx("div",{children:e.jsx(Y,{value:j,onChange:E,placeholder:"Describe your issue, feedback, or feature request..."})})]})]})}),t&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-end sm:items-center justify-center z-50 p-0 sm:p-4",children:e.jsxs("div",{className:"bg-white rounded-t-2xl sm:rounded-2xl w-full sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 sm:p-4 border-b sticky top-0 bg-white z-10",children:[e.jsx("h2",{className:"text-base sm:text-lg font-semibold text-gray-800",children:"Ticket Details"}),e.jsx("button",{onClick:()=>g(null),className:"p-1.5 sm:p-2 hover:bg-gray-100 rounded-lg transition",children:e.jsx(T,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 sm:mb-4 flex-wrap",children:[e.jsx("span",{className:`px-2 sm:px-3 py-0.5 sm:py-1 rounded-full text-[10px] sm:text-xs font-medium text-white ${L(t.type)}`,children:t.type.charAt(0).toUpperCase()+t.type.slice(1)}),e.jsx("span",{className:`px-2 sm:px-3 py-0.5 sm:py-1 rounded-full text-[10px] sm:text-xs font-medium text-white ${v(t.status)}`,children:t.status.charAt(0).toUpperCase()+t.status.slice(1).replace("-"," ")})]}),e.jsxs("div",{className:"space-y-1.5 sm:space-y-2 mb-3 sm:mb-4 text-xs sm:text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 text-gray-400 flex-shrink-0"}),e.jsxs("span",{className:"text-gray-600 truncate",children:["Created: ",N(t.createdAt)]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(M,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 text-gray-400 flex-shrink-0 mt-0.5"}),e.jsxs("span",{className:"text-gray-600 break-words",children:["Submitted by: ",t.submittedBy.name," (",t.submittedBy.email,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 text-gray-400 flex-shrink-0"}),e.jsxs("span",{className:"text-gray-600",children:["Assigned to: ",t.assignedTo?`${t.assignedTo.name}`:e.jsx("span",{className:"text-orange-500",children:"Not assigned"})]})]})]}),t.images&&t.images.length>0&&e.jsxs("div",{className:"mb-3 sm:mb-4",children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium text-gray-700 mb-2",children:"Attachments:"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:t.images.map((s,a)=>e.jsx("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"w-20 h-20 sm:w-24 sm:h-24 rounded-lg overflow-hidden border",children:e.jsx("img",{src:s,alt:"",className:"w-full h-full object-cover"})},a))})]}),e.jsxs("div",{className:"mb-4 sm:mb-6",children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium text-gray-700 mb-2",children:"Description:"}),e.jsx("div",{className:"prose prose-sm max-w-none text-gray-600 bg-gray-50 rounded-lg p-3 sm:p-4 text-xs sm:text-sm",dangerouslySetInnerHTML:{__html:t.description}})]}),(i?.role==="super_admin"||i?.role==="admin"||i?.role==="tenant_admin")&&e.jsxs("div",{className:"border-t pt-3 sm:pt-4",children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium text-gray-700 mb-2 sm:mb-3",children:"Update Status:"}),e.jsx("div",{className:"flex flex-wrap gap-1.5 sm:gap-2",children:["pending","in-progress","resolved","closed"].map(s=>e.jsx("button",{onClick:()=>V(t.id,s),disabled:t.status===s,className:`px-3 sm:px-4 py-1.5 sm:py-2 rounded-lg text-xs sm:text-sm font-medium transition ${t.status===s?`${v(s)} text-white`:"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:s.charAt(0).toUpperCase()+s.slice(1).replace("-"," ")},s))}),e.jsxs("button",{onClick:()=>X(t.id),className:"mt-3 sm:mt-4 flex items-center gap-2 px-3 sm:px-4 py-1.5 sm:py-2 text-red-600 hover:bg-red-50 rounded-lg transition text-sm",children:[e.jsx(se,{className:"w-4 h-4"}),"Delete Ticket"]})]}),t.comments&&t.comments.length>0&&e.jsxs("div",{className:"border-t pt-3 sm:pt-4 mt-3 sm:mt-4",children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium text-gray-700 mb-2 sm:mb-3",children:"Comments:"}),e.jsx("div",{className:"space-y-2 sm:space-y-3",children:t.comments.map(s=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-2.5 sm:p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm text-gray-500 mb-1",children:[e.jsx("span",{className:"font-medium text-gray-700",children:s.userName}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{className:"truncate",children:N(s.createdAt)})]}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:s.message})]},s.id))})]})]})]})})]})};export{de as default};
