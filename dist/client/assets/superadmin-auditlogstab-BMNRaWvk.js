import{j as e}from"./react-jsx-runtime-BBsywpoz.js";import{r as a}from"./react-core-KcGD0Z1V.js";import{g as w}from"./cmp-addnewduemodal-tsx-OjU2U-0e.js";import{toast as R}from"./pkg-toast-Dpd4iwUK.js";import{aQ as F,R as z,S as P,E as U,ao as D,bf as B,aK as $}from"./icons-chunk-AVFeydwE.js";import"./pkg-eventemitter3-CXfM2dhT.js";import"./pkg-goober-N6sOClW1.js";const V=()=>{const[p,S]=a.useState([]),[o,A]=a.useState(null),[k,j]=a.useState(!0),[x,T]=a.useState(""),[d,L]=a.useState("all"),[c,C]=a.useState("all"),[t,m]=a.useState(null),[r,i]=a.useState(1),[n,E]=a.useState(1),f=(()=>{if(typeof window<"u"){const s=window.location.hostname;return s==="localhost"||s==="127.0.0.1"?"http://localhost:5001/api":"https://allinbangla.com/api"}return"https://allinbangla.com/api"})(),u=async()=>{j(!0);try{const s=new URLSearchParams({page:r.toString(),limit:"20"});d!=="all"&&s.append("resourceType",d),c!=="all"&&s.append("status",c),x&&s.append("action",x);const l=await fetch(`${f}/audit-logs?${s}`,{headers:w()});if(l.ok){const y=await l.json();S(y.data||[]),E(y.pagination?.pages||1)}}catch(s){console.error("Failed to load audit logs:",s),R.error("Failed to load audit logs")}finally{j(!1)}},g=async()=>{try{const s=await fetch(`${f}/audit-logs/stats`,{headers:w()});if(s.ok){const l=await s.json();A(l.data)}}catch(s){console.error("Failed to load audit log stats:",s)}};a.useEffect(()=>{u(),g()},[r,d,c]);const b=()=>{i(1),u()},h=s=>{switch(s){case"success":return e.jsx($,{className:"text-emerald-500",size:16});case"failure":return e.jsx(B,{className:"text-red-500",size:16});case"warning":return e.jsx(D,{className:"text-amber-500",size:16});default:return null}},N=s=>({success:"bg-emerald-100 text-emerald-700",failure:"bg-red-100 text-red-700",warning:"bg-amber-100 text-amber-700"})[s]||"bg-slate-100 text-slate-700",v=s=>new Date(s).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(F,{className:"text-emerald-500"}),"Audit Logs"]}),e.jsx("p",{className:"text-slate-600 mt-1",children:"Track all superadmin actions and system events"})]}),e.jsxs("button",{onClick:()=>{u(),g()},className:"px-4 py-2 bg-gradient-to-r from-[#38BDF8] to-[#1E90FF] text-white rounded-lg hover:from-[#2BAEE8] hover:to-[#1A7FE8] transition-colors flex items-center gap-2",children:[e.jsx(z,{size:16}),"Refresh"]})]}),o&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-slate-200 p-4",children:[e.jsx("div",{className:"text-sm text-slate-600 mb-1",children:"Total Logs"}),e.jsx("div",{className:"text-2xl font-bold text-slate-800",children:o.totalLogs.toLocaleString()})]}),o.statusBreakdown.map(s=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-slate-200 p-4",children:[e.jsx("div",{className:"text-sm text-slate-600 mb-1 capitalize",children:s.status}),e.jsxs("div",{className:"text-2xl font-bold text-slate-800 flex items-center gap-2",children:[h(s.status),s.count.toLocaleString()]})]},s.status))]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Search Action"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(P,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400",size:16}),e.jsx("input",{type:"text",value:x,onChange:s=>T(s.target.value),onKeyPress:s=>s.key==="Enter"&&b(),placeholder:"Search by action...",className:"w-full pl-9 pr-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"})]}),e.jsx("button",{onClick:b,className:"px-4 py-2 bg-gradient-to-r from-[#38BDF8] to-[#1E90FF] text-white rounded-lg hover:from-[#2BAEE8] hover:to-[#1A7FE8] transition-colors",children:"Search"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Resource Type"}),e.jsxs("select",{value:d,onChange:s=>{L(s.target.value),i(1)},className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"tenant",children:"Tenant"}),e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"subscription",children:"Subscription"}),e.jsx("option",{value:"order",children:"Order"}),e.jsx("option",{value:"product",children:"Product"}),e.jsx("option",{value:"settings",children:"Settings"}),e.jsx("option",{value:"notification",children:"Notification"}),e.jsx("option",{value:"support_ticket",children:"Support Ticket"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Status"}),e.jsxs("select",{value:c,onChange:s=>{C(s.target.value),i(1)},className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"success",children:"Success"}),e.jsx("option",{value:"failure",children:"Failure"}),e.jsx("option",{value:"warning",children:"Warning"})]})]})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-600 uppercase",children:"Timestamp"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-600 uppercase",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-600 uppercase",children:"Action"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-600 uppercase",children:"Resource"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-600 uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-600 uppercase",children:"Details"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200",children:k?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-8 text-center text-slate-500",children:"Loading audit logs..."})}):p.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-8 text-center text-slate-500",children:"No audit logs found"})}):p.map(s=>e.jsxs("tr",{className:"hover:bg-slate-50",children:[e.jsx("td",{className:"px-6 py-4 text-sm text-slate-600",children:v(s.createdAt)}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm font-medium text-slate-800",children:s.userName}),e.jsx("div",{className:"text-xs text-slate-500",children:s.userRole})]}),e.jsx("td",{className:"px-6 py-4 text-sm text-slate-800 font-medium",children:s.action}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm text-slate-800 capitalize",children:s.resourceType}),s.resourceName&&e.jsx("div",{className:"text-xs text-slate-500",children:s.resourceName})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${N(s.status)}`,children:[h(s.status),s.status]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("button",{onClick:()=>m(s),className:"text-emerald-600 hover:text-emerald-700 flex items-center gap-1 text-sm",children:[e.jsx(U,{size:14}),"View"]})})]},s._id))})]})}),n>1&&e.jsxs("div",{className:"px-6 py-4 border-t border-slate-200 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-slate-600",children:["Page ",r," of ",n]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>i(s=>Math.max(1,s-1)),disabled:r===1,className:"px-3 py-1 border border-slate-300 rounded-lg text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-slate-50",children:"Previous"}),e.jsx("button",{onClick:()=>i(s=>Math.min(n,s+1)),disabled:r===n,className:"px-3 py-1 border border-slate-300 rounded-lg text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-slate-50",children:"Next"})]})]})]}),t&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-slate-200 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-800",children:"Audit Log Details"}),e.jsx("button",{onClick:()=>m(null),className:"text-slate-400 hover:text-slate-600",children:"âœ•"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Timestamp"}),e.jsx("div",{className:"text-sm text-slate-800 mt-1",children:v(t.createdAt)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Status"}),e.jsx("div",{className:"mt-1",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${N(t.status)}`,children:[h(t.status),t.status]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"User"}),e.jsx("div",{className:"text-sm text-slate-800 mt-1",children:t.userName}),e.jsx("div",{className:"text-xs text-slate-500",children:t.userRole})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Action"}),e.jsx("div",{className:"text-sm text-slate-800 mt-1",children:t.action})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Resource Type"}),e.jsx("div",{className:"text-sm text-slate-800 mt-1 capitalize",children:t.resourceType})]}),t.resourceName&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Resource Name"}),e.jsx("div",{className:"text-sm text-slate-800 mt-1",children:t.resourceName})]}),t.ipAddress&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"IP Address"}),e.jsx("div",{className:"text-sm text-slate-800 mt-1",children:t.ipAddress})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Details"}),e.jsx("div",{className:"text-sm text-slate-800 mt-1 bg-slate-50 rounded-lg p-3",children:t.details})]}),t.metadata&&Object.keys(t.metadata).length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Metadata"}),e.jsx("pre",{className:"text-xs text-slate-800 mt-1 bg-slate-50 rounded-lg p-3 overflow-x-auto",children:JSON.stringify(t.metadata,null,2)})]})]}),e.jsx("div",{className:"p-6 border-t border-slate-200 flex justify-end",children:e.jsx("button",{onClick:()=>m(null),className:"px-4 py-2 bg-slate-200 text-slate-700 rounded-lg hover:bg-slate-300 transition-colors",children:"Close"})})]})})]})};export{V as default};
