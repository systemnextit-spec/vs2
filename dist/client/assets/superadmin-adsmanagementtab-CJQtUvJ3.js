import{j as e}from"./react-jsx-runtime-BBsywpoz.js";import{r}from"./react-core-KcGD0Z1V.js";import{toast as x}from"./pkg-toast-Dpd4iwUK.js";import{g as U}from"./cmp-addnewduemodal-tsx-OjU2U-0e.js";import{L as E,I,R as T,P as _,U as z,b3 as H,aA as O,aZ as M,f as B,X as G,E as J,b5 as V,aE as W,T as X}from"./icons-chunk-AVFeydwE.js";import"./pkg-eventemitter3-CXfM2dhT.js";import"./pkg-goober-N6sOClW1.js";const Z=()=>{if(typeof window>"u")return"https://allinbangla.com/api";const l=window.location.hostname;if(l==="localhost"||l==="127.0.0.1"||l.endsWith(".localhost"))return"http://localhost:5001/api";const n=l.split("."),c=n.length>2?n.slice(-2).join("."):l;return`${window.location.protocol}//${c}/api`},b=Z(),ae=()=>{const[l,n]=r.useState([]),[c,j]=r.useState(!0),[d,v]=r.useState(!1),[p,y]=r.useState(!1),[m,u]=r.useState(null),[o,h]=r.useState({title:"",linkUrl:""}),f=r.useRef(null),w=async()=>{j(!0);try{const s=await(await fetch(`${b}/tenant-data/global/billing_ads`)).json();s.data&&Array.isArray(s.data)?n(s.data):n([])}catch(t){console.error("Error fetching ads:",t),x.error("Failed to load ads")}finally{j(!1)}};r.useEffect(()=>{w()},[]);const g=async t=>{v(!0);try{const s=U();if(!(await fetch(`${b}/tenant-data/global/billing_ads`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:s.Authorization||""},body:JSON.stringify({data:t})})).ok)throw new Error("Failed to save");n(t),x.success("Ads saved successfully")}catch(s){console.error("Error saving ads:",s),x.error("Failed to save ads")}finally{v(!1)}},N=async t=>{const s=t.target.files?.[0];if(s){y(!0);try{const a=new FormData;a.append("file",s),a.append("tenantId","global"),a.append("folder","ads");const i=U(),k=await fetch(`${b}/upload`,{method:"POST",headers:{Authorization:i.Authorization||""},body:a});if(!k.ok)throw new Error("Upload failed");const P=await k.json(),R={id:`ad_${Date.now()}`,imageUrl:P.imageUrl,title:"",linkUrl:"",active:!0,createdAt:new Date().toISOString()},D=[...l,R];await g(D)}catch(a){console.error("Error uploading image:",a),x.error("Failed to upload image")}finally{y(!1),f.current&&(f.current.value="")}}},S=async t=>{const s=l.map(a=>a.id===t?{...a,active:!a.active}:a);await g(s)},C=async t=>{if(!confirm("Are you sure you want to delete this ad?"))return;const s=l.filter(a=>a.id!==t);await g(s)},$=t=>{u(t.id),h({title:t.title||"",linkUrl:t.linkUrl||""})},F=async()=>{if(!m)return;const t=l.map(s=>s.id===m?{...s,title:o.title,linkUrl:o.linkUrl}:s);await g(t),u(null)},L=()=>{u(null),h({title:"",linkUrl:""})},A=async(t,s)=>{const a=s==="up"?t-1:t+1;if(a<0||a>=l.length)return;const i=[...l];[i[t],i[a]]=[i[a],i[t]],await g(i)};return c?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(E,{className:"w-8 h-8 animate-spin text-teal-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(I,{className:"w-7 h-7 text-teal-600"}),"Billing Page Ads"]}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Manage ads shown on tenant billing pages"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:w,disabled:c,className:"flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:[e.jsx(T,{className:`w-4 h-4 ${c?"animate-spin":""}`}),"Refresh"]}),e.jsxs("label",{className:"flex items-center gap-2 px-4 py-2 bg-teal-600 hover:bg-teal-700 text-white rounded-lg transition-colors cursor-pointer",children:[p?e.jsx(E,{className:"w-4 h-4 animate-spin"}):e.jsx(_,{className:"w-4 h-4"}),"Add New Ad",e.jsx("input",{ref:f,type:"file",accept:"image/*",onChange:N,className:"hidden",disabled:p})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-xl p-4 border border-gray-200",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:l.length}),e.jsx("div",{className:"text-sm text-gray-500",children:"Total Ads"})]}),e.jsxs("div",{className:"bg-green-50 rounded-xl p-4 border border-green-200",children:[e.jsx("div",{className:"text-2xl font-bold text-green-700",children:l.filter(t=>t.active).length}),e.jsx("div",{className:"text-sm text-green-600",children:"Active"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 border border-gray-200",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-700",children:l.filter(t=>!t.active).length}),e.jsx("div",{className:"text-sm text-gray-500",children:"Inactive"})]})]}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",children:l.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(I,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No ads yet"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Upload your first ad image to get started"}),e.jsxs("label",{className:"inline-flex items-center gap-2 px-4 py-2 bg-teal-600 hover:bg-teal-700 text-white rounded-lg transition-colors cursor-pointer",children:[e.jsx(z,{className:"w-4 h-4"}),"Upload Image",e.jsx("input",{type:"file",accept:"image/*",onChange:N,className:"hidden",disabled:p})]})]}):e.jsx("div",{className:"divide-y divide-gray-200",children:l.map((t,s)=>e.jsxs("div",{className:`p-4 flex items-center gap-4 ${t.active?"":"bg-gray-50 opacity-60"}`,children:[e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("button",{onClick:()=>A(s,"up"),disabled:s===0||d,className:"p-1 text-gray-400 hover:text-gray-600 disabled:opacity-30",children:"▲"}),e.jsx(H,{className:"w-5 h-5 text-gray-400"}),e.jsx("button",{onClick:()=>A(s,"down"),disabled:s===l.length-1||d,className:"p-1 text-gray-400 hover:text-gray-600 disabled:opacity-30",children:"▼"})]}),e.jsx("div",{className:"w-48 h-24 rounded-lg overflow-hidden bg-gray-100 flex-shrink-0",children:e.jsx("img",{src:t.imageUrl,alt:t.title||"Ad",className:"w-full h-full object-cover"})}),e.jsx("div",{className:"flex-1 min-w-0",children:m===t.id?e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"text",value:o.title,onChange:a=>h({...o,title:a.target.value}),placeholder:"Ad title (optional)",className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-teal-500"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4 text-gray-400"}),e.jsx("input",{type:"url",value:o.linkUrl,onChange:a=>h({...o,linkUrl:a.target.value}),placeholder:"Link URL (optional)",className:"flex-1 px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-teal-500"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:t.title||`Ad #${s+1}`}),t.linkUrl&&e.jsxs("a",{href:t.linkUrl,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-teal-600 hover:underline flex items-center gap-1 mt-1",children:[e.jsx(M,{className:"w-3 h-3"}),t.linkUrl.substring(0,40),"..."]}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Added: ",new Date(t.createdAt).toLocaleDateString()]})]})}),e.jsx("div",{className:"flex items-center gap-2",children:m===t.id?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:F,disabled:d,className:"p-2 bg-teal-100 text-teal-700 rounded-lg hover:bg-teal-200 disabled:opacity-50",children:e.jsx(B,{className:"w-4 h-4"})}),e.jsx("button",{onClick:L,className:"p-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:e.jsx(G,{className:"w-4 h-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>S(t.id),disabled:d,className:`p-2 rounded-lg ${t.active?"bg-green-100 text-green-700 hover:bg-green-200":"bg-gray-100 text-gray-500 hover:bg-gray-200"}`,title:t.active?"Hide ad":"Show ad",children:t.active?e.jsx(J,{className:"w-4 h-4"}):e.jsx(V,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>$(t),className:"p-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200",children:e.jsx(W,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>C(t.id),disabled:d,className:"p-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200",children:e.jsx(X,{className:"w-4 h-4"})})]})})]},t.id))})}),l.filter(t=>t.active).length>0&&e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-4 sm:p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Preview (Active Ads)"}),e.jsxs("div",{className:"rounded-lg overflow-hidden",style:{background:"linear-gradient(180deg, #ff6a00 0%, #ff9f1c 100%)",height:"200px",position:"relative"},children:[e.jsx("img",{src:l.filter(t=>t.active)[0]?.imageUrl,alt:"Preview",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex gap-2",children:l.filter(t=>t.active).map((t,s)=>e.jsx("div",{className:`w-3 h-3 rounded-full ${s===0?"bg-blue-500":"bg-white/50"}`},s))})]})]})]})};export{ae as default};
