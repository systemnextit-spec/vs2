import{R as p,r as P}from"./react-core-KcGD0Z1V.js";import{c as N}from"./pkg-clsx-B-dksMZM.js";import{b as j,r as C}from"./pkg-lodash-CH_GMSlH.js";import{L as E}from"./recharts-container-layer-zUiNMosr.js";import{T as W}from"./recharts-component-text-BFSAMVpI.js";import{g as U}from"./recharts-util-chartutils-xkzwGM0S.js";import{a as M}from"./recharts-util-datautils-CozywqZh.js";import{g as H}from"./recharts-util-cssprefixutils-DL4DResu.js";import{f as z}from"./recharts-util-reactutils-Is6lFQr1.js";import{p as G}from"./pkg-d3-scale-CTOhuMsp.js";function S(n){"@babel/helpers - typeof";return S=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},S(n)}function O(){return O=Object.assign?Object.assign.bind():function(n){for(var r=1;r<arguments.length;r++){var i=arguments[r];for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(n[e]=i[e])}return n},O.apply(this,arguments)}function $(n,r){var i=Object.keys(n);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(n);r&&(e=e.filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})),i.push.apply(i,e)}return i}function k(n){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?$(Object(i),!0).forEach(function(e){y(n,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):$(Object(i)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(i,e))})}return n}function Y(n,r){if(!(n instanceof r))throw new TypeError("Cannot call a class as a function")}function F(n,r){for(var i=0;i<r.length;i++){var e=r[i];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(n,A(e.key),e)}}function q(n,r,i){return r&&F(n.prototype,r),i&&F(n,i),Object.defineProperty(n,"prototype",{writable:!1}),n}function J(n,r,i){return r=D(r),Q(n,V()?Reflect.construct(r,i||[],D(n).constructor):r.apply(n,i))}function Q(n,r){if(r&&(S(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return T(n)}function V(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(V=function(){return!!n})()}function D(n){return D=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},D(n)}function T(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function Z(n,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(r&&r.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),r&&_(n,r)}function _(n,r){return _=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},_(n,r)}function y(n,r,i){return r=A(r),r in n?Object.defineProperty(n,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[r]=i,n}function A(n){var r=ee(n,"string");return S(r)=="symbol"?r:String(r)}function ee(n,r){if(S(n)!="object"||!n)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var e=i.call(n,r);if(S(e)!="object")return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}var te=function(r){var i=r.data,e=r.startIndex,t=r.endIndex,l=r.x,a=r.width,s=r.travellerWidth;if(!i||!i.length)return{};var o=i.length,d=G().domain(C(0,o)).range([l,l+a-s]),h=d.domain().map(function(u){return d(u)});return{isTextActive:!1,isSlideMoving:!1,isTravellerMoving:!1,isTravellerFocused:!1,startX:d(e),endX:d(t),scale:d,scaleValues:h}},B=function(r){return r.changedTouches&&!!r.changedTouches.length},R=(function(n){Z(r,n);function r(i){var e;return Y(this,r),e=J(this,r,[i]),y(T(e),"handleDrag",function(t){e.leaveTimer&&(clearTimeout(e.leaveTimer),e.leaveTimer=null),e.state.isTravellerMoving?e.handleTravellerMove(t):e.state.isSlideMoving&&e.handleSlideDrag(t)}),y(T(e),"handleTouchMove",function(t){t.changedTouches!=null&&t.changedTouches.length>0&&e.handleDrag(t.changedTouches[0])}),y(T(e),"handleDragEnd",function(){e.setState({isTravellerMoving:!1,isSlideMoving:!1},function(){var t=e.props,l=t.endIndex,a=t.onDragEnd,s=t.startIndex;a?.({endIndex:l,startIndex:s})}),e.detachDragEndListener()}),y(T(e),"handleLeaveWrapper",function(){(e.state.isTravellerMoving||e.state.isSlideMoving)&&(e.leaveTimer=window.setTimeout(e.handleDragEnd,e.props.leaveTimeOut))}),y(T(e),"handleEnterSlideOrTraveller",function(){e.setState({isTextActive:!0})}),y(T(e),"handleLeaveSlideOrTraveller",function(){e.setState({isTextActive:!1})}),y(T(e),"handleSlideDragStart",function(t){var l=B(t)?t.changedTouches[0]:t;e.setState({isTravellerMoving:!1,isSlideMoving:!0,slideMoveStartX:l.pageX}),e.attachDragEndListener()}),e.travellerDragStartHandlers={startX:e.handleTravellerDragStart.bind(T(e),"startX"),endX:e.handleTravellerDragStart.bind(T(e),"endX")},e.state={},e}return q(r,[{key:"componentWillUnmount",value:function(){this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=null),this.detachDragEndListener()}},{key:"getIndex",value:function(e){var t=e.startX,l=e.endX,a=this.state.scaleValues,s=this.props,o=s.gap,d=s.data,h=d.length-1,u=Math.min(t,l),v=Math.max(t,l),c=r.getIndexInRange(a,u),g=r.getIndexInRange(a,v);return{startIndex:c-c%o,endIndex:g===h?h:g-g%o}}},{key:"getTextOfTick",value:function(e){var t=this.props,l=t.data,a=t.tickFormatter,s=t.dataKey,o=U(l[e],s,e);return j(a)?a(o,e):o}},{key:"attachDragEndListener",value:function(){window.addEventListener("mouseup",this.handleDragEnd,!0),window.addEventListener("touchend",this.handleDragEnd,!0),window.addEventListener("mousemove",this.handleDrag,!0)}},{key:"detachDragEndListener",value:function(){window.removeEventListener("mouseup",this.handleDragEnd,!0),window.removeEventListener("touchend",this.handleDragEnd,!0),window.removeEventListener("mousemove",this.handleDrag,!0)}},{key:"handleSlideDrag",value:function(e){var t=this.state,l=t.slideMoveStartX,a=t.startX,s=t.endX,o=this.props,d=o.x,h=o.width,u=o.travellerWidth,v=o.startIndex,c=o.endIndex,g=o.onChange,f=e.pageX-l;f>0?f=Math.min(f,d+h-u-s,d+h-u-a):f<0&&(f=Math.max(f,d-a,d-s));var w=this.getIndex({startX:a+f,endX:s+f});(w.startIndex!==v||w.endIndex!==c)&&g&&g(w),this.setState({startX:a+f,endX:s+f,slideMoveStartX:e.pageX})}},{key:"handleTravellerDragStart",value:function(e,t){var l=B(t)?t.changedTouches[0]:t;this.setState({isSlideMoving:!1,isTravellerMoving:!0,movingTravellerId:e,brushMoveStartX:l.pageX}),this.attachDragEndListener()}},{key:"handleTravellerMove",value:function(e){var t=this.state,l=t.brushMoveStartX,a=t.movingTravellerId,s=t.endX,o=t.startX,d=this.state[a],h=this.props,u=h.x,v=h.width,c=h.travellerWidth,g=h.onChange,f=h.gap,w=h.data,b={startX:this.state.startX,endX:this.state.endX},m=e.pageX-l;m>0?m=Math.min(m,u+v-c-d):m<0&&(m=Math.max(m,u-d)),b[a]=d+m;var x=this.getIndex(b),X=x.startIndex,I=x.endIndex,K=function(){var L=w.length-1;return a==="startX"&&(s>o?X%f===0:I%f===0)||s<o&&I===L||a==="endX"&&(s>o?I%f===0:X%f===0)||s>o&&I===L};this.setState(y(y({},a,d+m),"brushMoveStartX",e.pageX),function(){g&&K()&&g(x)})}},{key:"handleTravellerMoveKeyboard",value:function(e,t){var l=this,a=this.state,s=a.scaleValues,o=a.startX,d=a.endX,h=this.state[t],u=s.indexOf(h);if(u!==-1){var v=u+e;if(!(v===-1||v>=s.length)){var c=s[v];t==="startX"&&c>=d||t==="endX"&&c<=o||this.setState(y({},t,c),function(){l.props.onChange(l.getIndex({startX:l.state.startX,endX:l.state.endX}))})}}}},{key:"renderBackground",value:function(){var e=this.props,t=e.x,l=e.y,a=e.width,s=e.height,o=e.fill,d=e.stroke;return p.createElement("rect",{stroke:d,fill:o,x:t,y:l,width:a,height:s})}},{key:"renderPanorama",value:function(){var e=this.props,t=e.x,l=e.y,a=e.width,s=e.height,o=e.data,d=e.children,h=e.padding,u=P.Children.only(d);return u?p.cloneElement(u,{x:t,y:l,width:a,height:s,margin:h,compact:!0,data:o}):null}},{key:"renderTravellerLayer",value:function(e,t){var l=this,a=this.props,s=a.y,o=a.travellerWidth,d=a.height,h=a.traveller,u=a.ariaLabel,v=a.data,c=a.startIndex,g=a.endIndex,f=Math.max(e,this.props.x),w=k(k({},z(this.props,!1)),{},{x:f,y:s,width:o,height:d}),b=u||"Min value: ".concat(v[c].name,", Max value: ").concat(v[g].name);return p.createElement(E,{tabIndex:0,role:"slider","aria-label":b,"aria-valuenow":e,className:"recharts-brush-traveller",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.travellerDragStartHandlers[t],onTouchStart:this.travellerDragStartHandlers[t],onKeyDown:function(x){["ArrowLeft","ArrowRight"].includes(x.key)&&(x.preventDefault(),x.stopPropagation(),l.handleTravellerMoveKeyboard(x.key==="ArrowRight"?1:-1,t))},onFocus:function(){l.setState({isTravellerFocused:!0})},onBlur:function(){l.setState({isTravellerFocused:!1})},style:{cursor:"col-resize"}},r.renderTraveller(h,w))}},{key:"renderSlide",value:function(e,t){var l=this.props,a=l.y,s=l.height,o=l.stroke,d=l.travellerWidth,h=Math.min(e,t)+d,u=Math.max(Math.abs(t-e)-d,0);return p.createElement("rect",{className:"recharts-brush-slide",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.handleSlideDragStart,onTouchStart:this.handleSlideDragStart,style:{cursor:"move"},stroke:"none",fill:o,fillOpacity:.2,x:h,y:a,width:u,height:s})}},{key:"renderText",value:function(){var e=this.props,t=e.startIndex,l=e.endIndex,a=e.y,s=e.height,o=e.travellerWidth,d=e.stroke,h=this.state,u=h.startX,v=h.endX,c=5,g={pointerEvents:"none",fill:d};return p.createElement(E,{className:"recharts-brush-texts"},p.createElement(W,O({textAnchor:"end",verticalAnchor:"middle",x:Math.min(u,v)-c,y:a+s/2},g),this.getTextOfTick(t)),p.createElement(W,O({textAnchor:"start",verticalAnchor:"middle",x:Math.max(u,v)+o+c,y:a+s/2},g),this.getTextOfTick(l)))}},{key:"render",value:function(){var e=this.props,t=e.data,l=e.className,a=e.children,s=e.x,o=e.y,d=e.width,h=e.height,u=e.alwaysShowText,v=this.state,c=v.startX,g=v.endX,f=v.isTextActive,w=v.isSlideMoving,b=v.isTravellerMoving,m=v.isTravellerFocused;if(!t||!t.length||!M(s)||!M(o)||!M(d)||!M(h)||d<=0||h<=0)return null;var x=N("recharts-brush",l),X=p.Children.count(a)===1,I=H("userSelect","none");return p.createElement(E,{className:x,onMouseLeave:this.handleLeaveWrapper,onTouchMove:this.handleTouchMove,style:I},this.renderBackground(),X&&this.renderPanorama(),this.renderSlide(c,g),this.renderTravellerLayer(c,"startX"),this.renderTravellerLayer(g,"endX"),(f||w||b||m||u)&&this.renderText())}}],[{key:"renderDefaultTraveller",value:function(e){var t=e.x,l=e.y,a=e.width,s=e.height,o=e.stroke,d=Math.floor(l+s/2)-1;return p.createElement(p.Fragment,null,p.createElement("rect",{x:t,y:l,width:a,height:s,fill:o,stroke:"none"}),p.createElement("line",{x1:t+1,y1:d,x2:t+a-1,y2:d,fill:"none",stroke:"#fff"}),p.createElement("line",{x1:t+1,y1:d+2,x2:t+a-1,y2:d+2,fill:"none",stroke:"#fff"}))}},{key:"renderTraveller",value:function(e,t){var l;return p.isValidElement(e)?l=p.cloneElement(e,t):j(e)?l=e(t):l=r.renderDefaultTraveller(t),l}},{key:"getDerivedStateFromProps",value:function(e,t){var l=e.data,a=e.width,s=e.x,o=e.travellerWidth,d=e.updateId,h=e.startIndex,u=e.endIndex;if(l!==t.prevData||d!==t.prevUpdateId)return k({prevData:l,prevTravellerWidth:o,prevUpdateId:d,prevX:s,prevWidth:a},l&&l.length?te({data:l,width:a,x:s,travellerWidth:o,startIndex:h,endIndex:u}):{scale:null,scaleValues:null});if(t.scale&&(a!==t.prevWidth||s!==t.prevX||o!==t.prevTravellerWidth)){t.scale.range([s,s+a-o]);var v=t.scale.domain().map(function(c){return t.scale(c)});return{prevData:l,prevTravellerWidth:o,prevUpdateId:d,prevX:s,prevWidth:a,startX:t.scale(e.startIndex),endX:t.scale(e.endIndex),scaleValues:v}}return null}},{key:"getIndexInRange",value:function(e,t){for(var l=e.length,a=0,s=l-1;s-a>1;){var o=Math.floor((a+s)/2);e[o]>t?s=o:a=o}return t>=e[s]?s:a}}]),r})(P.PureComponent);y(R,"displayName","Brush");y(R,"defaultProps",{height:40,travellerWidth:5,gap:1,fill:"#fff",stroke:"#666",padding:{top:1,right:1,bottom:1,left:1},leaveTimeOut:1e3,alwaysShowText:!1});export{R as B};
