import{j as e}from"./react-jsx-runtime-BBsywpoz.js";import{r as s}from"./react-core-KcGD0Z1V.js";import{toast as oe}from"./pkg-toast-Dpd4iwUK.js";import{X as ne,aJ as ie,aE as ce,T as de,c2 as me,N as he,a3 as xe}from"./icons-chunk-AVFeydwE.js";import"./pkg-eventemitter3-CXfM2dhT.js";import"./pkg-goober-N6sOClW1.js";const ue=i=>{if(!i)return null;const o=i.trim().replace(/[^0-9]/g,"");return o?`https://wa.me/${o}`:null},K=i=>{if(!i)return"0, 0, 0";let o=i.replace("#","");if(o.length===3&&(o=o.split("").map(c=>c+c).join("")),o.length!==6)return"0, 0, 0";const r=parseInt(o,16),x=r>>16&255,y=r>>8&255,j=r&255;return`${x}, ${y}, ${j}`},pe=[{id:"know",label:"ðŸ‘‹ à¦¨à¦¾à¦® à¦œà¦¾à¦¨à§à¦¨",message:"à¦†à¦ªà¦¨à¦¾à¦¦à§‡à¦° à¦¸à¦®à§à¦ªà¦°à§à¦•à§‡ à¦œà¦¾à¦¨à¦¤à§‡ à¦šà¦¾à¦‡"},{id:"demo",label:"ðŸ“¦ à¦¡à§‡à¦®à§‹",message:"à¦†à¦®à¦¿ à¦à¦•à¦Ÿà¦¿ à¦¡à§‡à¦®à§‹ à¦¦à§‡à¦–à¦¤à§‡ à¦šà¦¾à¦‡"},{id:"feature",label:"âœ¨ à¦«à¦¿à¦šà¦¾à¦°",message:"à¦†à¦ªà¦¨à¦¾à¦¦à§‡à¦° à¦«à¦¿à¦šà¦¾à¦°à¦—à§à¦²à§‹ à¦•à¦¿ à¦•à¦¿?"}],ve=({isOpen:i,onClose:o,websiteConfig:r,themeConfig:x,user:y,messages:j=[],onSendMessage:c,context:_="customer",onEditMessage:k,onDeleteMessage:z,canDeleteAll:F=!1})=>{const[w,C]=s.useState(""),[d,v]=s.useState(null),[R,u]=s.useState(""),[p,E]=s.useState(!1),S=s.useRef(null),b=s.useRef(null),a=_!=="admin",N=a?ue(r?.whatsappNumber):null,m=a?r?.chatEnabled??!0:!0,L=r?.chatWhatsAppFallback?N:null,D=r?.chatSupportHours?`${r.chatSupportHours.from} â€” ${r.chatSupportHours.to}`:null,f=j,I=y?.email?.toLowerCase(),H=r?.websiteName||"Support Team",M=r?.chatGreeting||(D?`Typically replies ${D}`:"Active now"),O=H.charAt(0).toUpperCase(),Y=s.useMemo(()=>{const t=x?.primaryColor||"#16a34a",l=r?.chatAccentColor||t,h=K(l),g=x?.surfaceColor||"#f5f6f7",n=r?.chatSurfaceColor||`rgba(${K(g)}, 0.96)`,A=r?.chatBorderColor||`rgba(${h}, 0.18)`,T=r?.chatShadowColor||`rgba(${h}, 0.28)`;return{"--chat-accent":l,"--chat-accent-rgb":h,"--chat-surface":n,"--chat-border":A,"--chat-shadow":T}},[x?.primaryColor,x?.surfaceColor,r?.chatAccentColor,r?.chatSurfaceColor,r?.chatBorderColor,r?.chatShadowColor]),q=a?"à¦†à¦ªà¦¨à¦¾à¦° à¦ªà§à¦°à¦¶à§à¦¨ à¦²à¦¿à¦–à§à¦¨...":"Reply to the customer...";s.useCallback(()=>{!N||typeof window>"u"||window.open(N,"_blank","noopener,noreferrer")},[N]),s.useCallback(()=>{oe.custom(()=>e.jsxs("div",{className:"max-w-sm rounded-2xl border border-gray-200 bg-white px-4 py-3 shadow-xl text-sm text-gray-700",children:[e.jsx("p",{className:"font-semibold text-gray-900 mb-2",children:"How live chat works"}),e.jsxs("ul",{className:"list-disc pl-4 space-y-1",children:[e.jsx("li",{children:"Messages sync in real-time between customer and admin."}),e.jsx("li",{children:"Tap and hold on your own replies to edit or delete them."}),e.jsx("li",{children:"Use the call or video icons to jump into WhatsApp if you need faster support."})]})]}),{duration:6e3})},[]);const $=!!(w.trim()&&(m||!a));s.useEffect(()=>{if(!i)return;const t=setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth"})},80);return()=>clearTimeout(t)},[i,j.length]),s.useEffect(()=>{if(!p)return;const t=l=>{S.current&&!S.current.contains(l.target)&&E(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[p]),s.useEffect(()=>{if(!d)return;f.some(l=>l.id===d)||(v(null),u(""))},[f,d]);const P=s.useCallback(()=>{const t=w.trim();!t||!c||!m&&a||(c(t),C(""),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth"})},10))},[w,c,m,a]),G=s.useCallback(t=>{!c||!m&&a||(c(t),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth"})},10))},[c,m,a]),J=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),P())},Q=t=>{C(l=>l+t),E(!1)},X=t=>{v(t.id),u(t.text)},W=()=>{v(null),u("")},Z=()=>{if(!d||!k)return;const t=R.trim();t&&(k(d,t),v(null),u(""))},ee=t=>{z?.(t),d===t&&W()};if(!i)return null;const te=["ðŸ˜€","ðŸ˜‚","ðŸ˜","ðŸ¥°","ðŸ˜Ž","ðŸ¤”","ðŸ˜¢","ðŸ˜¡","ðŸ‘","ðŸ‘Ž","â¤ï¸","ðŸ’”","ðŸŽ‰","ðŸŽŠ","âœ¨","â­","ðŸ”¥","ðŸ’¯","ðŸ˜´","ðŸ˜·","ðŸ¤","ðŸ¤®","ðŸ¤¢","ðŸ¤®","ðŸ˜ˆ","ðŸ‘¿","ðŸ’€","â˜ ï¸","ðŸ‘«","ðŸ’¥","âœ…","âŒ","ðŸ™Œ","ðŸ¤","ðŸ‘","ðŸŽ","ðŸŽˆ","ðŸŽ€","ðŸŒˆ","ðŸŒŸ","ðŸ’–","ðŸ’™","ðŸ’—","ðŸ’“","ðŸ’ž","ðŸš€","âš¡","ðŸŒº","ðŸŒ¸","ðŸŒ¼","ðŸ•","ðŸ”","ðŸŸ","ðŸŒ®","ðŸ°","ðŸª","â˜•","ðŸº","ðŸ»","ðŸ¥‚","ðŸ¾"];return e.jsx("div",{className:"fixed inset-0 z-[150] flex items-end sm:items-center justify-center bg-black/40 backdrop-blur-[2px] px-0 sm:px-4 transition-all duration-300",children:e.jsxs("div",{className:"live-chat-shell bg-white w-full sm:max-w-[380px] rounded-t-[28px] sm:rounded-[28px] flex flex-col h-[80vh] sm:h-[520px] shadow-2xl overflow-hidden animate-in slide-in-from-bottom-4 duration-300",style:Y,children:[e.jsxs("div",{className:"bg-gradient-to-r from-emerald-500 to-teal-500 px-5 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center text-white font-bold text-sm ring-2 ring-white/30",children:O}),e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 bg-green-400 rounded-full border-2 border-white"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-semibold text-[15px]",children:H}),e.jsx("p",{className:"text-white/80 text-xs",children:M})]})]}),e.jsx("button",{onClick:o,className:"p-2 rounded-full text-white/80 hover:text-white hover:bg-white/10 transition-all duration-200","aria-label":"Close chat",children:e.jsx(ne,{size:20,strokeWidth:2.5})})]}),!m&&a&&e.jsx("div",{className:"bg-amber-50 text-amber-700 text-sm px-5 py-3 border-b border-amber-100",children:r?.chatOfflineMessage||"Our agents are currently offline. Please try again later or use the fallback options below."}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-5 bg-gradient-to-b from-gray-50 to-white",children:[f.length===0?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-5 max-w-[90%]",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ‘‹"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900 text-[15px] mb-1",children:"à¦¸à§à¦¬à¦¾à¦—à¦¤à¦®!"}),e.jsx("p",{className:"text-gray-600 text-sm leading-relaxed",children:"à¦†à¦®à¦°à¦¾ à¦†à¦ªà¦¨à¦¾à¦•à§‡ à¦¸à¦¾à¦¹à¦¾à¦¯à§à¦¯ à¦•à¦°à¦¤à§‡ à¦à¦–à¦¾à¦¨à§‡ à¦†à¦›à¦¿à¥¤ à¦•à¦¿à¦›à§ à¦œà¦¿à¦œà§à¦žà¦¾à¦¸à¦¾ à¦•à¦°à§à¦¨!"})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-4 pt-4 border-t border-gray-100",children:pe.map(t=>e.jsx("button",{onClick:()=>G(t.message),className:"inline-flex items-center gap-1.5 px-3 py-2 rounded-full border border-gray-200 bg-white text-sm font-medium text-gray-700 hover:border-emerald-300 hover:text-emerald-600 hover:bg-emerald-50 transition-all duration-200 active:scale-95",children:t.label},t.id))})]})}):e.jsxs("div",{className:"space-y-3",children:[f.map(t=>{const l=t.sender==="customer",h=I&&t.authorEmail?.toLowerCase()===I,g=t.authorRole==="super_admin"||t.authorEmail?.toLowerCase()==="admin@allinbangla.com",n=a?l:g,A=h?"You":t.authorName||(t.sender==="admin"?"Support Team":t.customerName||"Customer"),T=!a&&g?"Super Admin":A,B=!!(h&&k),U=!!(z&&(h||!a&&F)),V=d===t.id,re=!a&&(!g||l),ae=!n,se=(t.authorName||t.customerName||"A").charAt(0).toUpperCase();return e.jsxs("div",{className:`flex ${n?"justify-end":"justify-start"} gap-2`,children:[ae&&e.jsx("div",{className:"flex-shrink-0 pt-1",children:e.jsx("div",{className:"h-8 w-8 rounded-full bg-gradient-to-br from-emerald-400 to-teal-500 text-white text-xs font-semibold flex items-center justify-center shadow-sm",children:se})}),e.jsxs("div",{className:`max-w-[75%] ${n?"order-first":""}`,children:[re&&e.jsx("span",{className:"text-[11px] font-medium text-gray-500 px-1 mb-1 block",children:T}),e.jsxs("div",{className:`px-4 py-2.5 rounded-2xl text-sm leading-relaxed shadow-sm ${n?"bg-gradient-to-r from-emerald-500 to-teal-500 text-white rounded-br-md":"bg-white border border-gray-100 text-gray-800 rounded-bl-md"}`,children:[V?e.jsxs("div",{className:"space-y-2",children:[e.jsx("textarea",{value:R,onChange:le=>u(le.target.value),className:"w-full rounded-xl border border-gray-200 bg-white text-sm text-gray-800 p-2 focus:outline-none focus:ring-2 focus:ring-emerald-200",rows:2}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:W,className:"text-xs font-semibold text-gray-500 hover:text-gray-700",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:Z,className:"text-xs font-semibold text-emerald-600 hover:text-emerald-700 flex items-center gap-1",children:[e.jsx(ie,{size:14})," Save"]})]})]}):e.jsx("p",{className:"whitespace-pre-line break-words",children:t.text}),(B||U)&&!V&&e.jsxs("div",{className:`mt-2 flex justify-end gap-2 text-xs ${n?"text-white/70":"text-gray-400"}`,children:[B&&e.jsx("button",{type:"button",onClick:()=>X(t),className:`hover:${n?"text-white":"text-gray-600"}`,"aria-label":"Edit message",children:e.jsx(ce,{size:13})}),U&&e.jsx("button",{type:"button",onClick:()=>ee(t.id),className:`hover:${n?"text-white":"text-gray-600"}`,"aria-label":"Delete message",children:e.jsx(de,{size:13})})]})]}),e.jsxs("div",{className:`text-[10px] text-gray-400 mt-1 px-1 ${n?"text-right":"text-left"}`,children:[new Date(t.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),t.editedAt?" â€¢ Edited":""]})]})]},t.id)}),e.jsx("div",{ref:b})]}),f.length===0&&e.jsx("div",{ref:b})]}),e.jsx("div",{className:"px-4 pb-4 pt-3 bg-white border-t border-gray-100",children:m||!a?e.jsxs("div",{className:"flex items-center gap-2 bg-gray-50 rounded-full px-4 py-2 border border-gray-200 focus-within:border-emerald-300 focus-within:ring-2 focus-within:ring-emerald-100 transition-all duration-200",children:[e.jsxs("div",{className:"relative",children:[e.jsx("button",{type:"button",onClick:()=>E(!p),className:`p-1.5 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-100 transition ${p?"text-emerald-500 bg-emerald-50":""}`,"aria-label":"Add emoji",children:e.jsx(me,{size:20})}),p&&e.jsx("div",{ref:S,className:"absolute bottom-full left-0 mb-2 bg-white border border-gray-200 rounded-2xl shadow-2xl p-3 z-50 grid grid-cols-8 gap-1 w-72",children:te.map((t,l)=>e.jsx("button",{onClick:()=>Q(t),className:"text-xl hover:bg-gray-100 p-1.5 rounded-lg transition hover:scale-110",title:t,children:t},`${t}-${l}`))})]}),e.jsx("input",{type:"text",value:w,onChange:t=>C(t.target.value),onKeyDown:J,placeholder:q,className:"flex-1 bg-transparent outline-none text-sm text-gray-800 placeholder:text-gray-400"}),e.jsx("button",{onClick:P,className:`p-2.5 rounded-full transition-all duration-200 ${$?"bg-gradient-to-r from-emerald-500 to-teal-500 text-white shadow-lg shadow-emerald-200 hover:shadow-xl hover:shadow-emerald-300 active:scale-95":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,"aria-label":"Send message",disabled:!$,children:e.jsx(he,{size:18,className:$?"-rotate-45":""})})]}):e.jsxs("div",{className:"text-sm text-gray-600 space-y-3",children:[e.jsx("p",{children:"Need urgent help? You can still reach us via the options below:"}),L&&e.jsxs("a",{href:L,target:"_blank",rel:"noreferrer",className:"inline-flex w-full items-center justify-center gap-2 rounded-xl border border-green-500 text-green-700 py-2 font-semibold",children:[e.jsx(xe,{size:16})," Chat on WhatsApp"]}),e.jsx("p",{className:"text-xs text-gray-400",children:"Leave your message and we will respond once we are online."})]})})]})})};export{ve as StoreChatModal,ve as default};
