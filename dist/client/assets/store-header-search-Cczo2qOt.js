import{j as e}from"./react-jsx-runtime-BBsywpoz.js";import{f as R}from"./cmp-landingpagecomponents-tsx-r6jaT4TN.js";import{n as W}from"./cmp-admincustomization-BgTFiuh2.js";import{L as F,J as V,S,b9 as k,X as M,U as X,I as Z,aU as K,aZ as Q}from"./icons-chunk-AVFeydwE.js";import{r as t}from"./react-core-KcGD0Z1V.js";const A=({variant:n="dark",supportsVoiceSearch:r,isListening:a,onVoiceSearch:i})=>{if(!r)return null;const o=n==="light"?"bg-white/90 text-gray-700 hover:bg-white":"bg-gray-100 text-gray-700 hover:bg-gray-200";return e.jsx("button",{type:"button",onClick:i,className:`${o} border border-gray-200 rounded-full p-2 flex items-center justify-center transition shadow-sm disabled:opacity-50`,title:"Voice search","aria-pressed":a,children:a?e.jsx(F,{size:16,className:"animate-spin"}):e.jsx(V,{size:16})})},E=({suggestions:n,onSuggestionClick:r})=>n.length===0?null:e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white rounded-xl shadow-2xl border border-gray-200 max-h-[420px] overflow-y-auto z-50",children:n.map(a=>e.jsxs("button",{onClick:()=>r(a),className:"w-full flex items-center gap-4 p-3 hover:bg-gray-50 transition border-b border-gray-100 last:border-0 text-left group",children:[e.jsx("div",{className:"w-14 h-14 flex-shrink-0 rounded-lg overflow-hidden bg-gray-100 border border-gray-200",children:e.jsx("img",{src:W(a.image),alt:a.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform",loading:"lazy",decoding:"async"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-800 line-clamp-2 group-hover:text-theme-primary transition-colors",children:a.name}),e.jsx("p",{className:"text-xs text-green-600 font-medium mt-0.5",children:a.category||"General"})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("div",{className:"text-base font-bold text-green-600",children:R(a.price)}),a.originalPrice&&a.originalPrice>a.price&&e.jsx("div",{className:"text-xs text-gray-400 line-through",children:R(a.originalPrice)})]})]},a.id))}),O=({isListening:n,transcript:r,positionClass:a="absolute -bottom-11 left-0 right-0"})=>n?e.jsx("div",{className:`pointer-events-none ${a}`,children:e.jsxs("div",{className:"flex items-center gap-2 rounded-full border border-blue-200 bg-white/95 px-3 py-1 text-xs font-semibold text-blue-600 shadow-sm",children:[e.jsx("span",{className:"h-2 w-2 rounded-full bg-blue-500 animate-ping"}),e.jsx("span",{className:"truncate",children:r||"Listening…"})]})}):null,$=({activeSearchValue:n,activeHint:r,activeHintIndex:a,offsetClass:i="left-4",textSizeClass:o="text-sm"})=>n.trim()||!r?null:e.jsx("div",{className:`pointer-events-none absolute inset-y-0 ${i} flex items-center text-gray-400 ${o} z-10`,children:e.jsx("span",{className:"search-hint-animate",children:r})},`${i}-${a}`),B=({onClick:n})=>e.jsx("button",{onClick:n,className:"p-2 text-gray-500 hover:text-theme-primary transition-colors",title:"AI Product Search - Upload or capture an image",children:e.jsx(k,{size:20})}),ae=({containerRef:n,activeSearchValue:r,onInputChange:a,suggestions:i,isSuggestionsOpen:o,onSuggestionClick:h,activeHint:m,activeHintIndex:u,isListening:x,liveTranscript:p,supportsVoiceSearch:l,onVoiceSearch:g,onVisualSearch:f})=>e.jsxs("div",{ref:n,className:"hidden md:flex flex-1 max-w-2xl relative",children:[e.jsx($,{activeSearchValue:r,activeHint:m,activeHintIndex:u,offsetClass:"left-5"}),e.jsx("input",{type:"text",placeholder:m?"":"Search products...",value:r,onChange:d=>a(d.target.value),className:"w-full border-2 border-theme-primary hover:border-theme-primary focus:border-theme-primary rounded-full py-2.5 pl-5 pr-36 focus:outline-none focus:ring-4 focus:ring-theme-primary/10 placeholder-gray-400 transition-all bg-gray-50 focus:bg-white"}),e.jsxs("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-1",children:[e.jsx(B,{onClick:f}),e.jsx(A,{isListening:x,supportsVoiceSearch:l,onVoiceSearch:g}),e.jsx("button",{className:"btn-order px-5 py-2 rounded-full font-semibold hover:shadow-lg active:scale-95",children:e.jsx(S,{size:18})})]}),o&&i.length>0&&e.jsx(E,{suggestions:i,onSuggestionClick:h}),e.jsx(O,{isListening:x,liveTranscript:p})]}),te=({containerRef:n,activeSearchValue:r,onInputChange:a,suggestions:i,isSuggestionsOpen:o,onSuggestionClick:h,activeHint:m,activeHintIndex:u,isListening:x,liveTranscript:p,supportsVoiceSearch:l,onVoiceSearch:g,onVisualSearch:f})=>e.jsxs("div",{ref:n,className:"flex-1 relative",children:[e.jsx($,{activeSearchValue:r,activeHint:m,activeHintIndex:u,offsetClass:"left-4"}),e.jsx("input",{type:"text",placeholder:m?"":"Search products...",value:r,onChange:d=>a(d.target.value),className:"w-full border-2 border-gray-200 focus:border-theme-primary rounded-full py-3 pl-4 pr-28 text-sm focus:outline-none focus:ring-4 focus:ring-theme-primary/10 bg-gray-50 focus:bg-white transition-all"}),e.jsxs("div",{className:"absolute right-1.5 top-1/2 -translate-y-1/2 flex items-center gap-0.5",children:[e.jsx(B,{onClick:f}),e.jsx(A,{isListening:x,supportsVoiceSearch:l,onVoiceSearch:g}),e.jsx("button",{className:"btn-order p-2.5 rounded-full active:scale-95",children:e.jsx(S,{size:16})})]}),o&&i.length>0&&e.jsx("div",{className:"absolute left-0 right-0 top-full mt-2 z-50",children:e.jsx(E,{suggestions:i,onSuggestionClick:h})}),e.jsx(O,{isListening:x,liveTranscript:p})]}),re=({isOpen:n,onClose:r,tenantId:a,onProductClick:i})=>{const[o,h]=t.useState(null),[m,u]=t.useState(null),[x,p]=t.useState(!1),[l,g]=t.useState(null),[f,d]=t.useState(null),[z,I]=t.useState(!1),U=t.useRef(null),b=t.useRef(null),P=t.useRef(null),N=t.useRef(null),v=t.useCallback(()=>{h(null),u(null),g(null),d(null),C()},[]),w=t.useCallback(()=>{v(),r()},[r,v]),D=t.useCallback(s=>{const c=s.target.files?.[0];c&&(h(c),u(URL.createObjectURL(c)),g(null),d(null))},[]),L=t.useCallback(async()=>{try{const s=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}});N.current=s,b.current&&(b.current.srcObject=s,await b.current.play()),I(!0),d(null)}catch(s){console.error("Camera error:",s),d("Unable to access camera. Please check permissions or use file upload.")}},[]),C=t.useCallback(()=>{N.current&&(N.current.getTracks().forEach(s=>s.stop()),N.current=null),I(!1)},[]),T=t.useCallback(()=>{if(b.current&&P.current){const s=b.current,c=P.current;c.width=s.videoWidth,c.height=s.videoHeight;const j=c.getContext("2d");j&&(j.drawImage(s,0,0),c.toBlob(y=>{if(y){const J=new File([y],"captured-image.jpg",{type:"image/jpeg"});h(J),u(URL.createObjectURL(y)),C()}},"image/jpeg",.9))}},[C]),G=t.useCallback(async()=>{if(o){p(!0),d(null);try{const s=new FormData;s.append("image",o);const j=await fetch("https://allinbangla.com/api/image-search/analyze",{method:"POST",headers:{"x-tenant-id":a},body:s});if(!j.ok)throw new Error("Failed to analyze image");const y=await j.json();g(y)}catch(s){console.error("Analysis error:",s),d("Failed to analyze image. Please try again.")}finally{p(!1)}}},[o,a]),q=t.useCallback(s=>{i&&(i(s),w())},[i,w]);return n?e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/60 backdrop-blur-sm",onClick:w,children:e.jsxs("div",{className:"relative w-full max-w-2xl max-h-[90vh] bg-white rounded-2xl shadow-2xl overflow-hidden",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b bg-gradient-to-r from-theme-primary to-blue-600",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-lg",children:e.jsx(S,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-white",children:"AI Product Search"}),e.jsx("p",{className:"text-xs text-white/80",children:"Upload or capture an image to find products"})]})]}),e.jsx("button",{onClick:w,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:e.jsx(M,{className:"w-5 h-5 text-white"})})]}),e.jsxs("div",{className:"p-4 overflow-y-auto max-h-[calc(90vh-80px)]",children:[z&&e.jsxs("div",{className:"relative mb-4",children:[e.jsx("video",{ref:b,className:"w-full rounded-xl bg-black",playsInline:!0,autoPlay:!0,muted:!0}),e.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-3",children:[e.jsxs("button",{onClick:T,className:"px-6 py-3 bg-theme-primary text-white rounded-full font-semibold shadow-lg hover:shadow-xl transition-all flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5"}),"Capture"]}),e.jsx("button",{onClick:C,className:"px-6 py-3 bg-gray-600 text-white rounded-full font-semibold shadow-lg hover:shadow-xl transition-all",children:"Cancel"})]})]}),!z&&!m&&!l&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("button",{onClick:()=>U.current?.click(),className:"flex flex-col items-center justify-center p-4 sm:p-6 border-2 border-dashed border-gray-300 rounded-xl hover:border-theme-primary hover:bg-theme-primary/5 transition-all group",children:[e.jsx(X,{className:"w-10 h-10 text-gray-400 group-hover:text-theme-primary mb-2"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Upload Image"}),e.jsx("span",{className:"text-xs text-gray-500",children:"JPG, PNG, WebP"})]}),e.jsxs("button",{onClick:L,className:"flex flex-col items-center justify-center p-4 sm:p-6 border-2 border-dashed border-gray-300 rounded-xl hover:border-theme-primary hover:bg-theme-primary/5 transition-all group",children:[e.jsx(k,{className:"w-10 h-10 text-gray-400 group-hover:text-theme-primary mb-2"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Take Photo"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Use camera"})]}),e.jsx("input",{ref:U,type:"file",accept:"image/jpeg,image/png,image/webp",onChange:D,className:"hidden"})]}),m&&!l&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:m,alt:"Selected",className:"w-full max-h-64 object-contain rounded-xl bg-gray-100"}),e.jsx("button",{onClick:v,className:"absolute to p-2 right-2 p-1.5 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors",children:e.jsx(M,{className:"w-4 h-4"})})]}),e.jsx("button",{onClick:G,disabled:x,className:"w-full mt-4 py-3 bg-gradient-to-r from-theme-primary to-blue-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:x?e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"w-5 h-5 animate-spin"}),"Analyzing with AI..."]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"w-5 h-5"}),"Search Products"]})})]}),f&&e.jsx("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-xl text-red-700 text-sm",children:f}),l&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl border border-blue-100",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Z,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-gray-900",children:l.analysis.productName}),e.jsx("p",{className:"text-sm text-gray-600",children:l.analysis.category})]}),e.jsxs("span",{className:"px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium",children:[Math.round(l.analysis.confidence*100),"% confidence"]})]}),e.jsx("p",{className:"text-sm text-gray-700 mb-3",children:l.analysis.description}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:l.analysis.features.slice(0,4).map((s,c)=>e.jsx("span",{className:"px-2 py-1 bg-white rounded-full text-xs text-gray-600 border",children:s},c))}),e.jsxs("div",{className:"text-sm font-semibold text-theme-primary",children:["Estimated: ",l.analysis.estimatedPrice]})]}),l.hasMatches?e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5 text-theme-primary"}),"Found in Our Store (",l.totalMatches,")"]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:l.matchingProducts.map(s=>e.jsxs("button",{onClick:()=>q(s),className:"p-3 bg-white border rounded-xl hover:border-theme-primary hover:shadow-md transition-all text-left group",children:[e.jsx("div",{className:"aspect-square mb-2 rounded-lg overflow-hidden bg-gray-100",children:e.jsx("img",{src:s.image||"/placeholder.png",alt:s.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform"})}),e.jsx("h4",{className:"font-medium text-sm text-gray-900 line-clamp-2",children:s.name}),e.jsx("div",{className:"flex items-center gap-2 mt-1",children:s.originalPrice&&s.originalPrice>s.price?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"font-bold text-theme-primary",children:["৳",s.price]}),e.jsxs("span",{className:"text-xs text-gray-400 line-through",children:["৳",s.originalPrice]})]}):e.jsxs("span",{className:"font-bold text-theme-primary",children:["৳",s.price]})}),e.jsxs("div",{className:"mt-2 flex items-center gap-1 text-xs text-green-600",children:[e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full"}),s.matchScore,"% match"]})]},s.id))})]}):e.jsx("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-xl",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Q,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-yellow-800",children:"Not Found in Store"}),e.jsxs("p",{className:"text-sm text-yellow-700 mt-1",children:["This product is not currently available in our store. Based on our analysis, it appears to be: ",e.jsx("strong",{children:l.analysis.productName})]}),e.jsx("p",{className:"text-sm text-yellow-600 mt-2",children:"Contact us if you'd like to request this product!"})]})]})}),e.jsxs("button",{onClick:v,className:"w-full py-3 bg-gray-100 text-gray-700 rounded-xl font-semibold hover:bg-gray-200 transition-all flex items-center justify-center gap-2",children:[e.jsx(k,{className:"w-5 h-5"}),"Search Another Product"]})]})]}),e.jsx("canvas",{ref:P,className:"hidden"})]})}):null};export{ae as D,re as I,te as M};
