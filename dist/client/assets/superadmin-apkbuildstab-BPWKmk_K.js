import{j as e}from"./react-jsx-runtime-BBsywpoz.js";import{r as a}from"./react-core-KcGD0Z1V.js";import{g as f}from"./cmp-addnewduemodal-tsx-OjU2U-0e.js";import{toast as r}from"./pkg-toast-Dpd4iwUK.js";import{c as y,R as I,S as T,a1 as P,aZ as k,n as D,E as K,a4 as b,T as R}from"./icons-chunk-AVFeydwE.js";import"./pkg-eventemitter3-CXfM2dhT.js";import"./pkg-goober-N6sOClW1.js";const H=({tenants:C,onSendNotification:m})=>{const[S,A]=a.useState([]),[n,U]=a.useState(null),[B,N]=a.useState(!0),[c,L]=a.useState(""),[t,h]=a.useState(null),[g,o]=a.useState(!1),[i,d]=a.useState({title:"",message:"",type:"info"}),x=(()=>{if(typeof window<"u"){const s=window.location.hostname;return s==="localhost"||s==="127.0.0.1"?"http://localhost:5001/api":"https://allinbangla.com/api"}return"https://allinbangla.com/api"})(),u=a.useCallback(async()=>{N(!0);try{const s=await fetch(`${x}/apk-builder/builds`,{headers:f()});if(s.ok){const l=await s.json();A(l.data||[])}}catch(s){console.error("Failed to load APK builds:",s),r.error("Failed to load APK builds")}finally{N(!1)}},[x]),p=a.useCallback(async()=>{try{const s=await fetch(`${x}/apk-builder/builds/stats`,{headers:f()});if(s.ok){const l=await s.json();U(l.data)}}catch(s){console.error("Failed to load APK build stats:",s)}},[x]);a.useEffect(()=>{u(),p()},[u,p]);const E=async s=>{if(confirm("Are you sure you want to delete this build record?"))try{(await fetch(`${x}/apk-builder/builds/${s}`,{method:"DELETE",headers:f()})).ok?(r.success("Build record deleted"),u(),p()):r.error("Failed to delete build record")}catch(l){console.error("Failed to delete build:",l),r.error("Failed to delete build record")}},z=async()=>{if(!t||!m)return;const s=t.tenantId;if(!s||s==="public"){r.error("Cannot send notification to public/anonymous builds");return}try{await m(s,i),r.success("Notification sent successfully"),o(!1),d({title:"",message:"",type:"info"})}catch{r.error("Failed to send notification")}},v=s=>new Date(s).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}),j=s=>!s||s==="public"?"Public/Anonymous":C.find(F=>F.id===s)?.name||s,w=S.filter(s=>s.appName?.toLowerCase().includes(c.toLowerCase())||s.packageName?.toLowerCase().includes(c.toLowerCase())||s.websiteUrl?.toLowerCase().includes(c.toLowerCase())||s.userEmail?.toLowerCase().includes(c.toLowerCase()));return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(y,{className:"text-emerald-500"}),"APK Builds"]}),e.jsx("p",{className:"text-slate-600 mt-1",children:"Track all APK builds created by users and tenants"})]}),e.jsxs("button",{onClick:()=>{u(),p()},className:"px-4 py-2 bg-gradient-to-r from-[#38BDF8] to-[#1E90FF] text-white rounded-lg hover:from-[#2BAEE8] hover:to-[#1A7FE8] transition-colors flex items-center gap-2",children:[e.jsx(I,{size:16}),"Refresh"]})]}),n&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-slate-200 p-4",children:[e.jsx("div",{className:"text-sm text-slate-600 mb-1",children:"Total Builds"}),e.jsx("div",{className:"text-2xl font-bold text-slate-800",children:n.totalBuilds.toLocaleString()})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-slate-200 p-4",children:[e.jsx("div",{className:"text-sm text-slate-600 mb-1",children:"Today's Builds"}),e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:n.todayBuilds.toLocaleString()})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-slate-200 p-4",children:[e.jsx("div",{className:"text-sm text-slate-600 mb-1",children:"Unique Users"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:n.uniqueUsers.toLocaleString()})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-slate-200 p-4",children:[e.jsx("div",{className:"text-sm text-slate-600 mb-1",children:"Unique Tenants"}),e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:n.uniqueTenants.toLocaleString()})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-4",children:e.jsx("div",{className:"flex gap-4",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(T,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400",size:16}),e.jsx("input",{type:"text",value:c,onChange:s=>L(s.target.value),placeholder:"Search by app name, package name, website, or email...",className:"w-full pl-9 pr-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"})]})})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-600 uppercase",children:"App Info"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-600 uppercase",children:"Website"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-600 uppercase",children:"User/Tenant"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-600 uppercase",children:"Build Info"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-600 uppercase",children:"Created"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-600 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200",children:B?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-8 text-center text-slate-500",children:"Loading APK builds..."})}):w.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-8 text-center text-slate-500",children:"No APK builds found"})}):w.map(s=>e.jsxs("tr",{className:"hover:bg-slate-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-emerald-400 to-emerald-600 rounded-lg flex items-center justify-center",children:e.jsx(y,{className:"text-white",size:20})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-slate-800",children:s.appName}),e.jsx("div",{className:"text-xs text-slate-500",children:s.packageName})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"text-slate-400",size:14}),e.jsxs("a",{href:s.websiteUrl,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:underline flex items-center gap-1",children:[s.websiteUrl?.replace(/https?:\/\//,"").substring(0,30),s.websiteUrl?.length>30?"...":"",e.jsx(k,{size:12})]})]})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm text-slate-800",children:j(s.tenantId)}),e.jsx("div",{className:"text-xs text-slate-500",children:s.userEmail||"Unknown"})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"text-slate-400",size:14}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-slate-800",children:["v",s.versionName]}),e.jsx("div",{className:"text-xs text-slate-500",children:s.fileSize})]})]})}),e.jsx("td",{className:"px-6 py-4 text-sm text-slate-600",children:v(s.createdAt)}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>h(s),className:"p-1.5 text-slate-400 hover:text-emerald-600 hover:bg-emerald-50 rounded-lg transition-colors",title:"View Details",children:e.jsx(K,{size:16})}),s.tenantId&&s.tenantId!=="public"&&m&&e.jsx("button",{onClick:()=>{h(s),o(!0)},className:"p-1.5 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Send Notification",children:e.jsx(b,{size:16})}),e.jsx("button",{onClick:()=>E(s.buildId),className:"p-1.5 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Delete Record",children:e.jsx(R,{size:16})})]})})]},s.buildId))})]})})}),t&&!g&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-slate-200 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-800",children:"APK Build Details"}),e.jsx("button",{onClick:()=>h(null),className:"text-slate-400 hover:text-slate-600",children:"✕"})]}),e.jsx("div",{className:"p-6 space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"App Name"}),e.jsx("div",{className:"text-sm text-slate-800 mt-1",children:t.appName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Package Name"}),e.jsx("div",{className:"text-sm text-slate-800 mt-1",children:t.packageName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Website URL"}),e.jsx("div",{className:"text-sm mt-1",children:e.jsxs("a",{href:t.websiteUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline flex items-center gap-1",children:[t.websiteUrl,e.jsx(k,{size:12})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Version"}),e.jsxs("div",{className:"text-sm text-slate-800 mt-1",children:[t.versionName," (Code: ",t.versionCode,")"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"File Name"}),e.jsx("div",{className:"text-sm text-slate-800 mt-1",children:t.fileName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"File Size"}),e.jsx("div",{className:"text-sm text-slate-800 mt-1",children:t.fileSize})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Tenant"}),e.jsx("div",{className:"text-sm text-slate-800 mt-1",children:j(t.tenantId)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"User Email"}),e.jsx("div",{className:"text-sm text-slate-800 mt-1",children:t.userEmail||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"IP Address"}),e.jsx("div",{className:"text-sm text-slate-800 mt-1",children:t.ipAddress||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Created At"}),e.jsx("div",{className:"text-sm text-slate-800 mt-1",children:v(t.createdAt)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Build ID"}),e.jsx("div",{className:"text-xs text-slate-600 mt-1 font-mono",children:t.buildId})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Status"}),e.jsx("div",{className:"mt-1",children:e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${t.status==="completed"?"bg-emerald-100 text-emerald-700":"bg-amber-100 text-amber-700"}`,children:t.status})})]})]})}),e.jsxs("div",{className:"p-6 border-t border-slate-200 flex justify-end gap-2",children:[t.tenantId&&t.tenantId!=="public"&&m&&e.jsxs("button",{onClick:()=>o(!0),className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors flex items-center gap-2",children:[e.jsx(b,{size:16}),"Send Notification"]}),e.jsx("button",{onClick:()=>h(null),className:"px-4 py-2 bg-slate-200 text-slate-700 rounded-lg hover:bg-slate-300 transition-colors",children:"Close"})]})]})}),g&&t&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full",children:[e.jsxs("div",{className:"p-6 border-b border-slate-200 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-800",children:"Send Notification"}),e.jsx("button",{onClick:()=>{o(!1),d({title:"",message:"",type:"info"})},className:"text-slate-400 hover:text-slate-600",children:"✕"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"bg-slate-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-sm text-slate-600",children:"Sending to:"}),e.jsx("div",{className:"text-sm font-medium text-slate-800",children:j(t.tenantId)}),e.jsxs("div",{className:"text-xs text-slate-500",children:["App: ",t.appName]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Notification Type"}),e.jsxs("select",{value:i.type,onChange:s=>d(l=>({...l,type:s.target.value})),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",children:[e.jsx("option",{value:"info",children:"Info"}),e.jsx("option",{value:"success",children:"Success"}),e.jsx("option",{value:"warning",children:"Warning"}),e.jsx("option",{value:"error",children:"Error"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Title"}),e.jsx("input",{type:"text",value:i.title,onChange:s=>d(l=>({...l,title:s.target.value})),placeholder:"Notification title",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Message"}),e.jsx("textarea",{value:i.message,onChange:s=>d(l=>({...l,message:s.target.value})),placeholder:"Notification message",rows:3,className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"})]})]}),e.jsxs("div",{className:"p-6 border-t border-slate-200 flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>{o(!1),d({title:"",message:"",type:"info"})},className:"px-4 py-2 bg-slate-200 text-slate-700 rounded-lg hover:bg-slate-300 transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:z,disabled:!i.title||!i.message,className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[e.jsx(b,{size:16}),"Send"]})]})]})})]})};export{H as default};
