import{j as e}from"./react-jsx-runtime-BBsywpoz.js";import{r as l}from"./react-core-KcGD0Z1V.js";import{g as te,u as ae,d as le}from"./cmp-dashboard-CvCpAVHs.js";import{i as ne}from"./cmp-addnewduemodal-tsx-OjU2U-0e.js";import{g as re,P as ie,S as oe,aI as ce,z as S,d as de,E as z,aE as A,ak as xe,aZ as fe,T as E,C as me,b as pe,M as ge,c as ue,ao as he}from"./icons-chunk-AVFeydwE.js";const ke=({tenantId:r,tenantSubdomain:V,onCreateNew:L,onEdit:_,onPreview:T})=>{const c=V||"";console.log("[OfferPageManager] Using subdomain from prop:",c,"for tenantId:",r);const[j,p]=l.useState([]),[R,M]=l.useState(!0),[y,W]=l.useState(""),[N,I]=l.useState("all"),[B,G]=l.useState("all"),[Z,q]=l.useState("all"),[d,g]=l.useState({open:!1,page:null}),[v,F]=l.useState(!1),[w,P]=l.useState([]),[i,$]=l.useState(null),[k,n]=l.useState(null),[u,h]=l.useState(1),[x,H]=l.useState(10),b=s=>{const a=window.location.protocol,t=window.location.host;if(t.includes("localhost")){const se=t.split(":")[1]||"3000";return`${c?`${a}//${c}.localhost:${se}`:window.location.origin}/offer/${s}`}const O=t.split("."),ee=O.length>=2?O.slice(-2).join("."):t;return`${c?`${a}//${c}.${ee}`:window.location.origin}/offer/${s}`},J=async()=>{if(!r){console.log("[OfferPageManager] No tenantId, skipping fetch");return}if(!ne()){console.log("[OfferPageManager] Not authenticated, skipping fetch");return}M(!0);try{const s=await te(r);p(s.data||[]),s.data?.length>0&&$(s.data[0])}catch(s){console.error("Error fetching offer pages:",s),p([])}finally{M(!1)}};l.useEffect(()=>{J()},[r]);const f=j.filter(s=>{const a=s.productTitle.toLowerCase().includes(y.toLowerCase())||s.urlSlug.toLowerCase().includes(y.toLowerCase()),t=N==="all"||s.status===N;return a&&t}),C=Math.ceil(f.length/x),m=(u-1)*x,o=f.slice(m,m+x),K=async()=>{if(d.page){F(!0);try{await le(r,d.page._id),p(j.filter(s=>s._id!==d.page?._id)),g({open:!1,page:null})}catch(s){console.error("Error deleting page:",s),alert("Failed to delete page")}finally{F(!1)}}},U=async s=>{const a=s.status==="published"?"draft":"published";try{await ae(r,s._id,{status:a}),p(j.map(t=>t._id===s._id?{...t,status:a}:t))}catch(t){console.error("Error updating page status:",t),alert("Failed to update page status")}},Q=s=>{const a=b(s);navigator.clipboard.writeText(a),alert("URL copied!")},X=()=>{w.length===o.length?P([]):P(o.map(s=>s._id))},Y=s=>{P(a=>a.includes(s)?a.filter(t=>t!==s):[...a,s])},D=s=>{$(s)};return e.jsxs("div",{className:"flex flex-col lg:flex-row h-full bg-[#f9f9f9]",children:[e.jsxs("div",{className:"flex-1 p-3 sm:p-4 lg:p-5 overflow-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-lg sm:text-xl lg:text-lg sm:text-xl lg:text-[22px] font-bold text-[#023337] tracking-[0.11px] font-['Lato',sans-serif]",children:"Landing Page"}),e.jsx("p",{className:"text-[#777] mt-1 text-base font-['Poppins',sans-serif]",children:"Create unlimited landing Page"})]}),e.jsxs("div",{className:"flex flex-col xs:flex-row items-stretch xs:items-center gap-2 sm:gap-3",children:[e.jsxs("button",{className:"flex items-center justify-center gap-1 px-3 sm:px-4 py-2.5 border border-[#ff6a00] text-black rounded-lg hover:bg-orange-50 transition-colors text-[15px] font-bold font-['Lato',sans-serif] tracking-[-0.3px]",children:["Version 1",e.jsx(re,{size:18})]}),e.jsxs("button",{onClick:L,className:"flex items-center justify-center gap-1.5 px-3 sm:px-4 py-2.5 bg-gradient-to-r from-[#38bdf8] to-[#1e90ff] text-white rounded-lg hover:opacity-90 transition-opacity text-[15px] font-bold font-['Lato',sans-serif] tracking-[-0.3px]",children:[e.jsx(ie,{size:20}),e.jsx("span",{className:"hidden xs:inline",children:"Create"})," Landing Page"]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row flex-wrap items-stretch sm:items-center gap-3 sm:gap-4 mb-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-full sm:max-w-[240px]",children:[e.jsx(oe,{className:"absolute left-2 top-1/2 -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",placeholder:"Search Category",value:y,onChange:s=>W(s.target.value),className:"w-full pl-10 pr-4 py-2 bg-[#f2f2f2] border-0 rounded-lg focus:ring-2 focus:ring-[#38bdf8] text-xs font-['Poppins',sans-serif] text-[#7b7b7b] placeholder:text-[#7b7b7b]"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-black text-xs font-['Poppins',sans-serif]",children:[e.jsx(ce,{size:18}),e.jsx("span",{children:"Filter:"})]}),e.jsx("select",{value:Z,onChange:s=>q(s.target.value),className:"min-w-[100px] px-2 py-2 bg-[#f2f2f2] border-0 rounded-lg text-xs font-['Poppins',sans-serif] focus:ring-2 focus:ring-[#38bdf8] cursor-pointer",children:e.jsx("option",{value:"all",children:"All Category"})}),e.jsxs("select",{value:B,onChange:s=>G(s.target.value),className:"min-w-[100px] px-2 py-2 bg-[#f2f2f2] border-0 rounded-lg text-xs font-['Poppins',sans-serif] focus:ring-2 focus:ring-[#38bdf8] cursor-pointer",children:[e.jsx("option",{value:"all",children:"All Version"}),e.jsx("option",{value:"v1",children:"V-1"}),e.jsx("option",{value:"v2",children:"V-2"})]}),e.jsxs("select",{value:N,onChange:s=>I(s.target.value),className:"min-w-[100px] px-2 py-2 bg-[#f2f2f2] border-0 rounded-lg text-xs font-['Poppins',sans-serif] focus:ring-2 focus:ring-[#38bdf8] cursor-pointer",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"published",children:"Published"}),e.jsx("option",{value:"draft",children:"Draft"})]})]}),e.jsx("div",{className:"bg-white rounded-lg flex flex-col min-h-[500px]",children:R?e.jsxs("div",{className:"p-8 text-center flex-1 flex flex-col items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#38bdf8] mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"Loading..."})]}):f.length===0?e.jsxs("div",{className:"p-8 text-center flex-1 flex flex-col items-center justify-center",children:[e.jsx(S,{className:"mx-auto h-12 w-12 text-gray-300"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No landing pages"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Get started by creating a new landing page."}),e.jsx("button",{onClick:L,className:"mt-4 px-4 py-2 bg-gradient-to-r from-[#38bdf8] to-[#1e90ff] text-white rounded-lg hover:opacity-90",children:"Create First Page"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:block overflow-x-auto overflow-y-visible flex-1",children:e.jsxs("table",{className:"w-full table-fixed",children:[e.jsx("thead",{className:"bg-gradient-to-r from-[rgba(56,189,248,0.15)] to-[rgba(30,144,255,0.15)]",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:w.length===o.length&&o.length>0,onChange:X,className:"w-5 h-5 rounded border-[#eaf8e7] border-[1.5px] bg-white focus:ring-[#38bdf8]"})}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700 font-['Poppins',sans-serif] w-12",children:"SL"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700 font-['Poppins',sans-serif] w-40",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700 font-['Poppins',sans-serif]",children:"Landing Page URL"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold text-gray-700 font-['Poppins',sans-serif] w-24",children:"Version"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold text-gray-700 font-['Poppins',sans-serif] w-24",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold text-gray-700 font-['Poppins',sans-serif] w-20",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-[#b9b9b9]/50",children:o.map((s,a)=>e.jsxs("tr",{className:`hover:bg-gray-50 cursor-pointer ${i?._id===s._id?"bg-[rgba(56,189,248,0.08)]":""}`,onClick:()=>D(s),children:[e.jsx("td",{className:"px-4 py-3.5",onClick:t=>t.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:w.includes(s._id),onChange:()=>Y(s._id),className:"w-5 h-5 rounded border-[#eaf8e7] border-[1.5px] bg-white focus:ring-[#38bdf8]"})}),e.jsx("td",{className:"px-4 py-3.5 text-xs text-[#1d1a1a] font-['Poppins',sans-serif] text-center w-[50px]",children:m+a+1}),e.jsx("td",{className:"px-4 py-3.5",children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.imageUrl?e.jsx("img",{src:s.imageUrl,alt:s.productTitle,className:"w-10 h-10 object-cover rounded-lg bg-gradient-to-r from-[#38bdf8] to-[#1e90ff]"}):e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-[#38bdf8] to-[#1e90ff] rounded-lg flex items-center justify-center",children:e.jsx(S,{size:16,className:"text-white"})}),e.jsx("p",{className:"text-xs text-[#1d1a1a] font-['Poppins',sans-serif] line-clamp-2 max-w-[120px]",children:s.productTitle})]})}),e.jsx("td",{className:"px-4 py-3.5",children:e.jsxs("p",{className:"text-xs text-[#1d1a1a] font-['Poppins',sans-serif] truncate max-w-[160px]",children:["offer/",s.urlSlug]})}),e.jsx("td",{className:"px-4 py-3.5",children:e.jsx("span",{className:"inline-flex items-center justify-center px-3 py-0.5 rounded-full text-xs font-medium bg-gradient-to-r from-[rgba(56,189,248,0.2)] to-[rgba(30,144,255,0.2)] text-transparent bg-clip-text font-['Poppins',sans-serif]",style:{backgroundImage:"linear-gradient(to right, #38bdf8, #1e90ff)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"V-1"})}),e.jsx("td",{className:"px-4 py-3.5",children:e.jsx("button",{onClick:t=>{t.stopPropagation(),U(s)},className:`px-3 py-0.5 rounded-full text-xs font-medium font-['Poppins',sans-serif] ${s.status==="published"?"bg-[#c1ffbc] text-[#085e00]":"bg-gray-200 text-gray-600 hover:bg-gray-300"}`,children:s.status==="published"?"Publish":"Draft"})}),e.jsxs("td",{className:"px-4 py-3.5 relative",onClick:t=>t.stopPropagation(),children:[e.jsx("button",{onClick:()=>n(k===s._id?null:s._id),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",title:"Actions",children:e.jsx(de,{size:18,className:"text-gray-600"})}),k===s._id&&e.jsxs("div",{className:"absolute right-4 top-full mt-1 w-44 bg-white rounded-xl shadow-xl border border-gray-200 z-50 py-1 animate-in fade-in slide-in-from-to p-2 duration-200",children:[e.jsxs("button",{onClick:()=>{T(s),n(null)},className:"w-full px-4 py-2.5 text-left text-sm hover:bg-blue-50 flex items-center gap-3 text-gray-700 font-medium transition-colors",children:[e.jsx(z,{size:16,className:"text-blue-500"})," Preview"]}),e.jsxs("button",{onClick:()=>{_(s),n(null)},className:"w-full px-4 py-2.5 text-left text-sm hover:bg-emerald-50 flex items-center gap-3 text-gray-700 font-medium transition-colors",children:[e.jsx(A,{size:16,className:"text-emerald-500"})," Edit"]}),e.jsxs("button",{onClick:()=>{Q(s.urlSlug),n(null)},className:"w-full px-4 py-2.5 text-left text-sm hover:bg-purple-50 flex items-center gap-3 text-gray-700 font-medium transition-colors",children:[e.jsx(xe,{size:16,className:"text-purple-500"})," Copy URL"]}),e.jsxs("button",{onClick:()=>{window.open(b(s.urlSlug),"_blank"),n(null)},className:"w-full px-4 py-2.5 text-left text-sm hover:bg-sky-50 flex items-center gap-3 text-gray-700 font-medium transition-colors",children:[e.jsx(fe,{size:16,className:"text-sky-500"})," Open Link"]}),e.jsx("hr",{className:"my-1 border-gray-100"}),e.jsxs("button",{onClick:()=>{g({open:!0,page:s}),n(null)},className:"w-full px-4 py-2.5 text-left text-sm hover:bg-red-50 text-red-600 flex items-center gap-3 font-medium transition-colors",children:[e.jsx(E,{size:16})," Delete"]})]})]})]},s._id))})]})}),e.jsx("div",{className:"md:hidden divide-y divide-[#b9b9b9]/50 flex-1",children:o.map((s,a)=>e.jsx("div",{className:`p-4 hover:bg-gray-50 ${i?._id===s._id?"bg-[rgba(56,189,248,0.08)]":""}`,onClick:()=>D(s),children:e.jsxs("div",{className:"flex gap-3",children:[s.imageUrl?e.jsx("img",{src:s.imageUrl,alt:s.productTitle,className:"w-14 h-14 object-cover rounded-lg flex-shrink-0 bg-gradient-to-r from-[#38bdf8] to-[#1e90ff]"}):e.jsx("div",{className:"w-14 h-14 bg-gradient-to-r from-[#38bdf8] to-[#1e90ff] rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(S,{size:18,className:"text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h4",{className:"font-medium text-[#1d1a1a] text-xs line-clamp-2 font-['Poppins',sans-serif]",children:s.productTitle}),e.jsx("button",{onClick:t=>{t.stopPropagation(),U(s)},className:`px-2 py-0.5 rounded-full text-xs font-medium flex-shrink-0 font-['Poppins',sans-serif] ${s.status==="published"?"bg-[#c1ffbc] text-[#085e00]":"bg-gray-200 text-gray-600"}`,children:s.status==="published"?"Publish":"Draft"})]}),e.jsxs("p",{className:"text-xs text-[#1d1a1a] truncate mt-1 font-['Poppins',sans-serif]",children:["offer/",s.urlSlug]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-gradient-to-r from-[rgba(56,189,248,0.2)] to-[rgba(30,144,255,0.2)]",style:{backgroundImage:"linear-gradient(to right, #38bdf8, #1e90ff)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"V-1"}),e.jsxs("div",{className:"flex gap-1",onClick:t=>t.stopPropagation(),children:[e.jsx("button",{onClick:()=>T(s),className:"p-1.5 hover:bg-gray-100 rounded text-gray-500",children:e.jsx(z,{size:16})}),e.jsx("button",{onClick:()=>_(s),className:"p-1.5 hover:bg-gray-100 rounded text-[#38bdf8]",children:e.jsx(A,{size:16})}),e.jsx("button",{onClick:()=>g({open:!0,page:s}),className:"p-1.5 hover:bg-red-50 rounded text-red-600",children:e.jsx(E,{size:16})})]})]})]})]})},s._id))}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3 px-4 py-4 mt-auto border-t border-[#b9b9b9]/30 bg-gray-50 rounded-b-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600 font-['Poppins',sans-serif]",children:[e.jsx("span",{children:"Show"}),e.jsxs("select",{value:x,onChange:s=>{H(Number(s.target.value)),h(1)},className:"px-2 py-1 bg-[#f2f2f2] border-0 rounded text-xs",children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"})]}),e.jsx("span",{className:"hidden xs:inline",children:"entries"})]}),e.jsxs("div",{className:"flex flex-col xs:flex-row items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-gray-600 font-['Poppins',sans-serif]",children:["Showing ",m+1,"-",Math.min(m+x,f.length)," of ",f.length]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>h(s=>Math.max(1,s-1)),disabled:u===1,className:"p-1 rounded hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(me,{size:18})}),Array.from({length:Math.min(3,C)},(s,a)=>{const t=a+1;return e.jsx("button",{onClick:()=>h(t),className:`w-8 h-8 rounded text-xs ${u===t?"bg-gradient-to-r from-[#38bdf8] to-[#1e90ff] text-white":"hover:bg-gray-200 text-gray-600"}`,children:t},t)}),e.jsx("button",{onClick:()=>h(s=>Math.min(C,s+1)),disabled:u===C,className:"p-1 rounded hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(pe,{size:18})})]})]})]})]})})]}),e.jsxs("div",{className:"hidden lg:flex w-[420px] bg-white rounded-lg p-4 flex-col m-2 ml-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-[#023337] font-['Lato',sans-serif] tracking-[0.1px]",children:"Preview"}),e.jsx("div",{className:"flex items-center gap-2",children:i&&e.jsx("button",{onClick:()=>window.open(b(i.urlSlug),"_blank"),className:"p-2 hover:bg-gray-100 rounded",title:"Open in new tab",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ge,{size:16,className:"text-gray-500"}),e.jsx(ue,{size:14,className:"text-gray-500"})]})})})]}),i?e.jsx("div",{className:"flex-1 overflow-hidden rounded-lg bg-gray-100",children:e.jsx("div",{className:"w-full h-full overflow-auto",children:e.jsx("div",{className:"transform scale-[0.38] origin-top-left w-[263%]",children:e.jsx("iframe",{src:b(i.urlSlug),className:"w-full h-[1800px] border-0",title:"Preview"})})})}):e.jsx("div",{className:"flex-1 flex items-center justify-center bg-gray-100 rounded-lg",children:e.jsxs("div",{className:"text-center text-gray-400",children:[e.jsx(z,{size:48,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"font-['Poppins',sans-serif]",children:"Select a page to preview"})]})})]}),d.open&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-full",children:e.jsx(he,{className:"text-red-600",size:24})}),e.jsx("h3",{className:"text-lg font-bold text-[#023337] font-['Lato',sans-serif]",children:"Delete Landing Page"})]}),e.jsxs("p",{className:"text-gray-600 mb-6 font-['Poppins',sans-serif] text-sm",children:['Are you sure you want to delete "',e.jsx("strong",{children:d.page?.productTitle}),'"? This action cannot be undone.']}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>g({open:!1,page:null}),className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg font-['Poppins',sans-serif] text-sm",disabled:v,children:"Cancel"}),e.jsx("button",{onClick:K,disabled:v,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 font-['Poppins',sans-serif] text-sm",children:v?"Deleting...":"Delete"})]})]})}),k&&e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>n(null)})]})};export{ke as O};
