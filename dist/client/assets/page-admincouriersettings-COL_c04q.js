import{j as e}from"./react-jsx-runtime-BBsywpoz.js";import{r as l}from"./react-core-KcGD0Z1V.js";import w from"./pkg-toast-Dpd4iwUK.js";import{g as y}from"./cmp-addnewduemodal-tsx-OjU2U-0e.js";import{L as j,aW as U,aK as v,by as X,g as B,am as $,ah as H,f as _,a9 as q}from"./icons-chunk-AVFeydwE.js";import"./pkg-eventemitter3-CXfM2dhT.js";import"./pkg-goober-N6sOClW1.js";const m=()=>{if(typeof window<"u"){const f=window.location.hostname;if(f!=="localhost"&&f!=="127.0.0.1")return window.location.origin}return import.meta?.env?.VITE_API_BASE_URL||"http://localhost:5001"},ee=({config:f,onSave:K,onBack:F,tenantId:N})=>{const[c,D]=l.useState("Steadfast"),[n,p]=l.useState({apiKey:"",secretKey:"",instruction:""}),[t,d]=l.useState({apiKey:"",secretKey:"",username:"",password:"",storeId:"",instruction:""}),[L,S]=l.useState(!1),[h,u]=l.useState(!1),[x,o]=l.useState(null),[g,C]=l.useState(!1),[k,b]=l.useState(!1),[O,I]=l.useState(!0),[P,T]=l.useState(!1),E=()=>N||localStorage.getItem("activeTenantId")||"";l.useEffect(()=>{(async()=>{const a=E();if(!a){I(!1);return}try{const i=await fetch(`${m()}/api/courier/config`,{headers:{"X-Tenant-Id":a,...y()}});if(i.ok){const r=await i.json();p({apiKey:r.apiKey||"",secretKey:r.secretKey||"",instruction:r.instruction||""}),(r.apiKey||r.secretKey)&&K({apiKey:r.apiKey||"",secretKey:r.secretKey||"",instruction:r.instruction||""})}const z=await fetch(`${m()}/api/courier/pathao/config`,{headers:{"X-Tenant-Id":a,...y()}});if(z.ok){const r=await z.json();d({apiKey:r.apiKey||"",secretKey:r.secretKey||"",username:r.username||"",password:r.password||"",storeId:r.storeId||"",instruction:r.instruction||""}),T(!!(r.apiKey&&r.secretKey&&r.username&&r.password))}}catch(i){console.error("Failed to load courier config:",i)}finally{I(!1)}})()},[]),l.useEffect(()=>{const s=a=>{if((a.ctrlKey||a.metaKey)&&a.key==="s"){a.preventDefault();const i=document.querySelector("form");i&&i.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))}};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[]);const R=async s=>{if(s.preventDefault(),g)return;const a=E();if(!a){w.error("Tenant ID not found");return}C(!0),b(!1);try{if(c==="Steadfast"){if(!(await fetch(`${m()}/api/courier/config`,{method:"POST",headers:{"Content-Type":"application/json","X-Tenant-Id":a,...y()},body:JSON.stringify({apiKey:n.apiKey.trim(),secretKey:n.secretKey.trim(),instruction:n.instruction.trim()})})).ok)throw new Error("Failed to save config");K({apiKey:n.apiKey.trim(),secretKey:n.secretKey.trim(),instruction:n.instruction.trim()})}else{if(!(await fetch(`${m()}/api/courier/pathao/config`,{method:"POST",headers:{"Content-Type":"application/json","X-Tenant-Id":a,...y()},body:JSON.stringify({apiKey:t.apiKey.trim(),secretKey:t.secretKey.trim(),username:t.username.trim(),password:t.password.trim(),storeId:t.storeId.trim(),instruction:t.instruction.trim()})})).ok)throw new Error("Failed to save Pathao config");T(!!(t.apiKey&&t.secretKey&&t.username&&t.password))}b(!0),S(!0),w.success(`${c} courier settings saved!`),setTimeout(()=>{b(!1),S(!1)},2e3)}catch(i){console.error("Failed to save:",i),w.error("Failed to save settings")}finally{C(!1)}},J=async()=>{u(!0),o(null);try{if(c==="Steadfast"){if(!n.apiKey||!n.secretKey){o({valid:!1,message:"Please enter both API Key and Secret Key"}),u(!1);return}const a=await(await fetch(`${m()}/api/courier/steadfast/test-credentials`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({apiKey:n.apiKey.trim(),secretKey:n.secretKey.trim()})})).json();a.valid?o({valid:!0,message:`Connection successful! Balance: ৳${a.balance||0}`,balance:a.balance}):o({valid:!1,message:a.error||a.hint||"Invalid credentials or account not activated"})}else{if(!t.apiKey||!t.secretKey||!t.username||!t.password){o({valid:!1,message:"Please fill in all required fields (API Key, Secret Key, Username, Password)"}),u(!1);return}const a=await(await fetch(`${m()}/api/courier/pathao/test-credentials`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({apiKey:t.apiKey.trim(),secretKey:t.secretKey.trim(),username:t.username.trim(),password:t.password.trim()})})).json();a.valid?o({valid:!0,message:a.message||"Pathao connection successful!"}):o({valid:!1,message:a.error||"Failed to connect to Pathao. Check your credentials."})}}catch{o({valid:!1,message:`Failed to connect to ${c}. Please check your credentials and try again.`})}finally{u(!1)}};if(O)return e.jsxs("div",{className:"flex items-center justify-center min-h-[400px]",children:[e.jsx(j,{className:"w-8 h-8 animate-spin text-purple-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading courier settings..."})]});const A=n.apiKey&&n.secretKey;return e.jsxs("div",{className:"space-y-4 sm:space-y-6 animate-fade-in w-full max-w-4xl mx-auto px-3 sm:px-4 lg:px-0",children:[e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4 mb-4 sm:mb-6",children:[e.jsx("button",{onClick:F,className:"p-1.5 sm:p-2 hover:bg-gray-200 rounded-full transition flex-shrink-0",children:e.jsx(U,{size:18,className:"text-gray-600 sm:w-5 sm:h-5"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h2",{className:"text-lg sm:text-2xl font-bold text-gray-800 truncate",children:"Courier Configuration"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 line-clamp-1",children:"Manage third-party logistics integrations."})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2 sm:gap-3 lg:gap-4",children:["Steadfast","Pathao"].map(s=>{const a=c===s,i=s==="Steadfast"?A:P;return e.jsxs("div",{onClick:()=>{D(s),o(null)},className:`
                relative p-2.5 sm:p-3 lg:p-4 rounded-lg sm:rounded-xl border-2 cursor-pointer transition-all duration-200 flex flex-col justify-between min-h-[60px] sm:min-h-[70px] lg:h-24
                ${a?"border-purple-600 bg-purple-50":"border-gray-200 bg-white hover:border-purple-200"}
              `,children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 lg:gap-3",children:[i?e.jsx(v,{size:16,className:"text-green-500 fill-green-100 sm:w-5 sm:h-5 lg:w-[22px] lg:h-[22px]"}):e.jsx(X,{size:16,className:"text-gray-300 sm:w-5 sm:h-5 lg:w-[22px] lg:h-[22px]"}),e.jsx("div",{children:e.jsx("span",{className:`font-bold text-xs sm:text-sm block ${a?"text-purple-700":"text-gray-700"}`,children:s})})]})}),a&&e.jsxs("div",{className:"text-[10px] sm:text-xs text-purple-600 font-medium flex items-center gap-1 mt-1.5 sm:mt-2",children:["Show ",e.jsx(B,{size:10,className:"sm:w-3 sm:h-3"})]})]},s)})}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg sm:rounded-xl shadow-sm overflow-hidden animate-in slide-in-from-to p-2",children:[e.jsxs("div",{className:"p-3 sm:p-4 lg:p-6 border-b border-gray-100 bg-gray-50 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx($,{size:16,className:"text-purple-600 sm:w-5 sm:h-5"}),e.jsxs("h3",{className:"font-bold text-gray-800 text-sm sm:text-base lg:text-lg",children:[c," Integration"]})]}),(c==="Steadfast"?A:P)&&e.jsx("span",{className:"text-[10px] sm:text-xs bg-green-100 text-green-700 px-1.5 sm:px-2 py-0.5 sm:py-1 rounded-full",children:"✓ Configured"})]}),e.jsxs("form",{onSubmit:R,className:"p-3 sm:p-4 lg:p-6",children:[L&&e.jsxs("div",{className:"bg-green-50 text-green-700 px-3 sm:px-4 py-2 sm:py-3 rounded-lg flex items-center gap-2 border border-green-100 mb-4 sm:mb-6 animate-in fade-in slide-in-from-top-1 text-xs sm:text-sm",children:[e.jsx(v,{size:16,className:"sm:w-[18px] sm:h-[18px]"})," Credentials saved successfully!"]}),c==="Steadfast"?e.jsxs("div",{className:"space-y-3 sm:space-y-4 lg:space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] sm:text-xs font-bold text-gray-500 uppercase tracking-wider mb-1",children:"Provider*"}),e.jsx("select",{className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 lg:py-3 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none bg-gray-50",value:"Steadfast Courier",disabled:!0,children:e.jsx("option",{children:"Steadfast Courier"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1",children:"Api Key"}),e.jsx("input",{type:"text",className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 lg:py-3 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none transition",placeholder:"Enter API Key",value:n.apiKey,onChange:s=>p({...n,apiKey:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-purple-600 mb-1",children:"Secret Key"}),e.jsx("input",{type:"text",className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 lg:py-3 text-sm border border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none transition bg-purple-50/30",placeholder:"Enter Secret Key",value:n.secretKey,onChange:s=>p({...n,secretKey:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1",children:"Special Instruction"}),e.jsx("input",{type:"text",className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 lg:py-3 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none transition",placeholder:"e.g. Handle fragile items with care",value:n.instruction,onChange:s=>p({...n,instruction:s.target.value})})]})]}):e.jsxs("div",{className:"space-y-3 sm:space-y-4 lg:space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] sm:text-xs font-bold text-gray-500 uppercase tracking-wider mb-1",children:"Provider*"}),e.jsx("select",{className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 lg:py-3 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none bg-gray-50",value:"Pathao Courier",disabled:!0,children:e.jsx("option",{children:"Pathao Courier"})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1",children:"Api Key"}),e.jsx("input",{type:"text",className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 lg:py-3 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none transition",placeholder:"Enter Pathao API Key",value:t.apiKey,onChange:s=>d({...t,apiKey:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-purple-600 mb-1",children:"Secret Key"}),e.jsx("input",{type:"text",className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 lg:py-3 text-sm border border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none transition bg-purple-50/30",placeholder:"Enter Pathao Secret Key",value:t.secretKey,onChange:s=>d({...t,secretKey:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1",children:"Username"}),e.jsx("input",{type:"email",className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 lg:py-3 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none transition",placeholder:"Enter Pathao account email",value:t.username,onChange:s=>d({...t,username:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1",children:"Password"}),e.jsx("input",{type:"password",className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 lg:py-3 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none transition",placeholder:"Enter Pathao account password",value:t.password,onChange:s=>d({...t,password:s.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1",children:"Store Id"}),e.jsx("input",{type:"text",className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 lg:py-3 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none transition",placeholder:"Enter Pathao Store ID",value:t.storeId,onChange:s=>d({...t,storeId:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1",children:"Special Instruction"}),e.jsx("input",{type:"text",className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 lg:py-3 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none transition",placeholder:"e.g. Handle fragile items with care",value:t.instruction,onChange:s=>d({...t,instruction:s.target.value})})]})]}),e.jsxs("div",{className:"pt-4 sm:pt-5 lg:pt-6 mt-4 sm:mt-5 lg:mt-6 flex flex-col sm:flex-row gap-2 sm:gap-4",children:[e.jsxs("button",{type:"button",onClick:J,disabled:h,className:"flex items-center justify-center gap-1.5 sm:gap-2 px-4 sm:px-6 py-2 sm:py-2.5 lg:py-3 bg-gray-100 text-gray-700 rounded-lg font-bold text-sm hover:bg-gray-200 transition border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed",children:[h?e.jsx(j,{size:16,className:"animate-spin sm:w-[18px] sm:h-[18px]"}):e.jsx($,{size:16,className:"sm:w-[18px] sm:h-[18px]"}),h?"Testing...":"Test"]}),e.jsx("button",{type:"submit",disabled:g,className:`flex items-center gap-1.5 sm:gap-2 px-4 sm:px-6 py-2 sm:py-2.5 lg:py-3 rounded-lg font-bold text-sm transition-all duration-300 shadow-lg min-w-[120px] sm:min-w-[140px] lg:min-w-[160px] justify-center ${k?"bg-emerald-500 text-white shadow-emerald-200":g?"bg-purple-500 text-white shadow-purple-200 cursor-wait":"bg-purple-600 text-white shadow-purple-200 hover:bg-purple-700"}`,children:k?e.jsxs(e.Fragment,{children:[e.jsx(H,{size:16,className:"animate-bounce sm:w-[18px] sm:h-[18px]"})," Saved!"]}):g?e.jsxs(e.Fragment,{children:[e.jsx(j,{size:16,className:"animate-spin sm:w-[18px] sm:h-[18px]"})," Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{size:16,className:"sm:w-[18px] sm:h-[18px]"})," Save"]})})]}),x&&e.jsxs("div",{className:`mt-3 sm:mt-4 px-3 sm:px-4 py-2 sm:py-3 rounded-lg flex items-center gap-2 text-xs sm:text-sm ${x.valid?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"}`,children:[x.valid?e.jsx(v,{size:16,className:"sm:w-[18px] sm:h-[18px]"}):e.jsx(q,{size:16,className:"sm:w-[18px] sm:h-[18px]"}),e.jsx("span",{className:"truncate",children:x.message})]})]})]})]})};export{ee as default};
