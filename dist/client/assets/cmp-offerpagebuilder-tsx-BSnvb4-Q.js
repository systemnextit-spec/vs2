import{j as e}from"./react-jsx-runtime-BBsywpoz.js";import{r as d}from"./react-core-KcGD0Z1V.js";import{u as F,c as M}from"./cmp-dashboard-CwyHj6aR.js";import{aW as $,L as h,f as I,S as k,I as W,U as G,aB as H,aA as Q,z as D,aL as L,P as V,aX as X,aY as Y,T as J,aV as K}from"./icons-chunk-AVFeydwE.js";const ae=({tenantId:g,products:O,editingPage:l,onSave:B,onCancel:f})=>{const[t,i]=d.useState({productId:l?.productId||0,productTitle:l?.productTitle||"",searchQuery:l?.searchQuery||"",imageUrl:l?.imageUrl||"",offerEndDate:l?.offerEndDate?new Date(l.offerEndDate).toISOString().split("T")[0]:"",description:l?.description||"",productOfferInfo:l?.productOfferInfo||"",paymentSectionTitle:l?.paymentSectionTitle||"",whyBuySection:l?.whyBuySection||"",urlSlug:l?.urlSlug||"",status:l?.status||"draft"}),[o,p]=d.useState(l?.benefits||[{id:crypto.randomUUID(),text:""}]),[c,b]=d.useState(!1),[j,y]=d.useState(""),[N,v]=d.useState(!1),[w,S]=d.useState(!1),[U,n]=d.useState(""),C=O.filter(s=>s.name.toLowerCase().includes(j.toLowerCase())),E=s=>{i({...t,productId:s.id,productTitle:s.name,imageUrl:s.image||"",urlSlug:t.urlSlug||`${s.name.toLowerCase().replace(/[^a-z0-9]+/g,"-")}-${Date.now().toString(36).slice(-6)}`}),v(!1),y("")},P=async s=>{const a=s.target.files?.[0];if(a){S(!0);try{const r=new FormData;r.append("file",a),r.append("tenantId",g||"default");const m=await fetch("https://allinbangla.com/api/upload",{method:"POST",body:r});if(m.ok){const x=await m.json();i({...t,imageUrl:x.imageUrl||x.url})}else alert("Upload failed")}catch(r){console.error("Upload failed:",r),alert("Upload failed")}finally{S(!1)}}},R=()=>{p([...o,{id:crypto.randomUUID(),text:""}])},A=(s,a)=>{p(o.map(r=>r.id===s?{...r,text:a}:r))},_=s=>{o.length>1&&p(o.filter(a=>a.id!==s))},z=(s,a)=>{const r=o.findIndex(x=>x.id===s);if(a==="up"&&r===0||a==="down"&&r===o.length-1)return;const u=[...o],m=a==="up"?r-1:r+1;[u[r],u[m]]=[u[m],u[r]],p(u)},q=()=>{const s=t.productTitle.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");i({...t,urlSlug:s})},T=async s=>{if(s.preventDefault(),n(""),!t.productTitle.trim()){n("Product title is required");return}if(!t.imageUrl.trim()){n("Image URL is required");return}if(!t.offerEndDate){n("Offer end date is required");return}if(!t.description.trim()){n("Description is required");return}if(!t.urlSlug.trim()){n("URL slug is required");return}b(!0);try{const a={...t,benefits:o.filter(r=>r.text.trim())};l?._id?await F(g,l._id,a):await M(g,a),B()}catch(a){console.error("Error saving offer page:",a),n(a.message||"Failed to save offer page")}finally{b(!1)}};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:f,className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx($,{size:20})}),e.jsx("h1",{className:"text-xl font-semibold",children:l?"Edit Offer Page":"Create Offer Page"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:f,className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg",children:"Cancel"}),e.jsxs("button",{onClick:T,disabled:c,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:[c?e.jsx(h,{className:"animate-spin",size:18}):e.jsx(I,{size:18}),c?"Saving...":"Save"]})]})]})}),e.jsxs("form",{onSubmit:T,className:"max-w-5xl mx-auto px-4 py-4 sm:py-6 space-y-6",children:[U&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg text-red-700",children:U}),e.jsxs("div",{className:"bg-white p-4 sm:p-6 rounded-lg shadow-sm border",children:[e.jsxs("h2",{className:"text-lg font-medium mb-4 flex items-center gap-2",children:[e.jsx(k,{size:20}),"Product Selection"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>v(!N),className:"w-full px-4 py-3 border rounded-lg text-left flex items-center justify-between hover:border-blue-500",children:[e.jsx("span",{className:t.productTitle?"text-gray-900":"text-gray-400",children:t.productTitle||"Select a product or enter manually..."}),e.jsx(k,{size:18,className:"text-gray-400"})]}),N&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border rounded-lg shadow-lg z-20 max-h-64 overflow-auto",children:[e.jsx("input",{type:"text",value:j,onChange:s=>y(s.target.value),placeholder:"Search products...",className:"w-full px-4 py-2 border-b",autoFocus:!0}),C.length===0?e.jsx("div",{className:"p-4 text-gray-500 text-center",children:"No products found"}):C.slice(0,10).map(s=>e.jsxs("button",{type:"button",onClick:()=>E(s),className:"w-full px-4 py-3 text-left hover:bg-gray-50 flex items-center gap-3",children:[s.image&&e.jsx("img",{src:s.image,alt:"",className:"w-10 h-10 object-cover rounded"}),e.jsx("span",{children:s.name})]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Product Title *"}),e.jsx("input",{type:"text",value:t.productTitle,onChange:s=>i({...t,productTitle:s.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Enter product title"})]})]})]}),e.jsxs("div",{className:"bg-white p-4 sm:p-6 rounded-lg shadow-sm border",children:[e.jsxs("h2",{className:"text-lg font-medium mb-4 flex items-center gap-2",children:[e.jsx(W,{size:20}),"Product Image"]}),e.jsxs("div",{className:"space-y-4",children:[t.imageUrl&&e.jsx("div",{className:"w-full max-w-md",children:e.jsx("img",{src:t.imageUrl,alt:"Product",className:"w-full h-48 object-cover rounded-lg border"})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex-1",children:[e.jsx("span",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Image URL"}),e.jsx("input",{type:"url",value:t.imageUrl,onChange:s=>i({...t,imageUrl:s.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"https://..."})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Or Upload"}),e.jsxs("label",{className:"flex items-center gap-2 px-4 py-2 border rounded-lg cursor-pointer hover:bg-gray-50",children:[w?e.jsx(h,{className:"animate-spin",size:18}):e.jsx(G,{size:18}),e.jsx("span",{children:"Upload"}),e.jsx("input",{type:"file",accept:"image/*",onChange:P,className:"hidden",disabled:w})]})]})]})]})]}),e.jsxs("div",{className:"bg-white p-4 sm:p-6 rounded-lg shadow-sm border",children:[e.jsxs("h2",{className:"text-lg font-medium mb-4 flex items-center gap-2",children:[e.jsx(H,{size:20}),"Offer Details"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Offer End Date *"}),e.jsx("input",{type:"date",value:t.offerEndDate,onChange:s=>i({...t,offerEndDate:s.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"URL Slug *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:t.urlSlug,onChange:s=>i({...t,urlSlug:s.target.value}),className:"flex-1 px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"product-name"}),e.jsx("button",{type:"button",onClick:q,className:"px-3 py-2 border rounded-lg hover:bg-gray-50",title:"Generate from title",children:e.jsx(Q,{size:18})})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["URL: /",t.urlSlug||"slug"]})]})]})]}),e.jsxs("div",{className:"bg-white p-4 sm:p-6 rounded-lg shadow-sm border",children:[e.jsxs("h2",{className:"text-lg font-medium mb-4 flex items-center gap-2",children:[e.jsx(D,{size:20}),"Description *"]}),e.jsx("textarea",{value:t.description,onChange:s=>i({...t,description:s.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",rows:4,placeholder:"Enter product description..."})]}),e.jsxs("div",{className:"bg-white p-4 sm:p-6 rounded-lg shadow-sm border",children:[e.jsxs("h2",{className:"text-lg font-medium mb-4 flex items-center gap-2",children:[e.jsx(L,{size:20}),"Product Offer Info (HTML)"]}),e.jsx("textarea",{value:t.productOfferInfo,onChange:s=>i({...t,productOfferInfo:s.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 font-mono text-sm",rows:6,placeholder:"<p>Special offer details...</p>"})]}),e.jsxs("div",{className:"bg-white p-4 sm:p-6 rounded-lg shadow-sm border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-lg font-medium flex items-center gap-2",children:[e.jsx(L,{size:20}),"Benefits"]}),e.jsxs("button",{type:"button",onClick:R,className:"flex items-center gap-1 px-3 py-1.5 text-sm bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100",children:[e.jsx(V,{size:16}),"Add Benefit"]})]}),e.jsx("div",{className:"space-y-3",children:o.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-400 w-6",children:[a+1,"."]}),e.jsx("input",{type:"text",value:s.text,onChange:r=>A(s.id,r.target.value),className:"flex-1 px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Enter benefit..."}),e.jsx("button",{type:"button",onClick:()=>z(s.id,"up"),disabled:a===0,className:"p-2 text-gray-400 hover:text-gray-600 disabled:opacity-30",children:e.jsx(X,{size:18})}),e.jsx("button",{type:"button",onClick:()=>z(s.id,"down"),disabled:a===o.length-1,className:"p-2 text-gray-400 hover:text-gray-600 disabled:opacity-30",children:e.jsx(Y,{size:18})}),e.jsx("button",{type:"button",onClick:()=>_(s.id),disabled:o.length===1,className:"p-2 text-red-400 hover:text-red-600 disabled:opacity-30",children:e.jsx(J,{size:18})})]},s.id))})]}),e.jsxs("div",{className:"bg-white p-4 sm:p-6 rounded-lg shadow-sm border",children:[e.jsxs("h2",{className:"text-lg font-medium mb-4 flex items-center gap-2",children:[e.jsx(D,{size:20}),"Why Buy This Product (HTML)"]}),e.jsx("textarea",{value:t.whyBuySection,onChange:s=>i({...t,whyBuySection:s.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 font-mono text-sm",rows:6,placeholder:"<h3>Why choose us?</h3><ul><li>Reason 1</li></ul>"})]}),e.jsxs("div",{className:"bg-white p-4 sm:p-6 rounded-lg shadow-sm border",children:[e.jsxs("h2",{className:"text-lg font-medium mb-4 flex items-center gap-2",children:[e.jsx(K,{size:20}),"Payment Section Title"]}),e.jsx("input",{type:"text",value:t.paymentSectionTitle,onChange:s=>i({...t,paymentSectionTitle:s.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Order Now"})]}),e.jsxs("div",{className:"bg-white p-4 sm:p-6 rounded-lg shadow-sm border",children:[e.jsx("h2",{className:"text-lg font-medium mb-4",children:"Status"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",checked:t.status==="draft",onChange:()=>i({...t,status:"draft"}),className:"w-4 h-4 text-blue-600"}),e.jsx("span",{children:"Draft"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",checked:t.status==="published",onChange:()=>i({...t,status:"published"}),className:"w-4 h-4 text-blue-600"}),e.jsx("span",{children:"Published"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pb-6",children:[e.jsx("button",{type:"button",onClick:f,className:"px-6 py-2 text-gray-600 hover:bg-gray-100 rounded-lg",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:c,className:"flex items-center gap-2 px-3 sm:px-4 lg:px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:[c?e.jsx(h,{className:"animate-spin",size:18}):e.jsx(I,{size:18}),c?"Saving...":l?"Update Page":"Create Page"]})]})]})]})};export{ae as O};
