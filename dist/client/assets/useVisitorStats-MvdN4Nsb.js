import{r as l}from"./react-core-KcGD0Z1V.js";import"./pkg-eventemitter3-CXfM2dhT.js";const h="https://allinbangla.com",k=(a={})=>{const{tenantId:r,period:i="7d",refreshInterval:c=3e4}=a,[f,s]=l.useState({totalVisitors:0,periodVisitors:0,todayVisitors:0,totalPageViews:0,onlineNow:0,dailyStats:[],topPages:[],devices:[]}),[t,n]=l.useState(!0),[o,d]=l.useState(null),u=l.useCallback(async()=>{if(r)try{const e=await fetch(`${h}/api/visitors/${r}/stats?period=${i}`);if(!e.ok)throw new Error("Failed to fetch stats");const g=await e.json(),p=await fetch(`${h}/api/visitors/${r}/online`);if(!p.ok)throw new Error("Failed to fetch online count");const v=await p.json();s({...g,onlineNow:v.online||0}),d(null)}catch(e){console.error("Error fetching visitor stats:",e),d(e instanceof Error?e.message:"Unknown error")}finally{n(!1)}},[r,i]);return l.useEffect(()=>{u();const e=setInterval(u,c);return()=>clearInterval(e)},[u,c]),{stats:f,isLoading:t,error:o,refresh:u}},w=new Map,S=5e3,y=async(a,r)=>{if(!a)return;const i=`${a}:${r}`,c=w.get(i)||0,f=Date.now();if(f-c<S)return;w.set(i,f);let s=localStorage.getItem("_vid");s||(s=`v_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,localStorage.setItem("_vid",s));const t=navigator.userAgent;let n="Desktop";/tablet|ipad|playbook|silk/i.test(t)?n="Tablet":/mobile|iphone|ipod|android|blackberry|opera mini|iemobile/i.test(t)&&(n="Mobile");let o="Other";t.includes("Chrome")?o="Chrome":t.includes("Safari")?o="Safari":t.includes("Firefox")?o="Firefox":t.includes("Edge")&&(o="Edge");try{await fetch(`${h}/api/visitors/${a}/track`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({visitorId:s,page:r,referrer:document.referrer,userAgent:t,device:n,browser:o})})}catch(d){console.warn("Failed to track page view:",d)}};export{k as default,y as trackPageView,k as useVisitorStats};
