import{j as e}from"./react-jsx-runtime-BBsywpoz.js";import{r}from"./react-core-KcGD0Z1V.js";import v from"./pkg-toast-Dpd4iwUK.js";import{D as h,h as m,j as D,k as P,l as O,i as w,e as _}from"./cmp-admincustomization-BgTFiuh2.js";import{ah as M,L as N,f as Q}from"./icons-chunk-AVFeydwE.js";import"./pkg-eventemitter3-CXfM2dhT.js";import"./pkg-goober-N6sOClW1.js";import"./cmp-gallerypicker-tsx-T-_pXSB3.js";import"./cmp-dashboard-CwyHj6aR.js";import"./pkg-socket-D1bUdbwx.js";import"./pkg-engine-io-BZqIjJKj.js";import"./pkg-@socket.io-component-emitter-Dkula2eQ.js";import"./pkg-socket.io-parser-CafqElEs.js";import"./cmp-approutes-tsx-DORRjFJg.js";import"./cmp-skeletonloaders-tsx-Durrj7lG.js";import"./cmp-addnewduemodal-tsx-OjU2U-0e.js";import"./cmp-modern-dashboard-C6grFkCj.js";import"./cmp-invoiceprinttemplate-tsx-CUwUe6zE.js";import"./pkg-papaparse-BEpmA8em.js";import"./pkg-xlsx-BljOZNTS.js";import"./page-adminnote-C1Ob2d7z.js";import"./cmp-duehistorymodal-tsx-KQ79TbYj.js";const xe=({tenantId:u,logo:K,onUpdateLogo:J,themeConfig:n,onUpdateTheme:B,websiteConfig:o,onUpdateWebsiteConfig:C,initialTab:x="website_info",products:V=[]})=>{const[a,S]=r.useState(x==="theme_view"||x==="theme_colors"?x:"theme_view"),[t,p]=r.useState(()=>o?{...h,...o}:h),[l,F]=r.useState({...m}),[R,b]=r.useState(!1),[g,W]=r.useState(!1),[T,L]=r.useState(!1),[G,U]=r.useState(!0),z=r.useRef(u),f=r.useRef(!1),y=r.useRef(!1),k=r.useRef(null),j=r.useRef(!1),E=r.useRef(0),A=3e3;r.useEffect(()=>{const c=setTimeout(()=>U(!1),600);return()=>clearTimeout(c)},[]),r.useEffect(()=>{S(x)},[x]),r.useEffect(()=>(typeof window<"u"&&(window.__getAdminCustomizationUnsavedChanges=()=>Date.now()-E.current<A?(console.log("[AdminCustomization] Within save protection window, blocking refresh"),!0):y.current),()=>{typeof window<"u"&&delete window.__getAdminCustomizationUnsavedChanges}),[]),r.useEffect(()=>{j.current||(z.current!==u?(console.log("[AdminCustomization] Tenant changed, reloading config"),z.current=u,f.current=!1,y.current=!1,o&&(p({...h,...o,addresses:o.addresses||[],emails:o.emails||[],phones:o.phones||[],socialLinks:o.socialLinks||[],footerQuickLinks:o.footerQuickLinks||[],footerUsefulLinks:o.footerUsefulLinks||[],showFlashSaleCounter:o.showFlashSaleCounter??!0,headerLogo:o.headerLogo??null,footerLogo:o.footerLogo??null,campaigns:o.campaigns||[],carouselItems:o.carouselItems||[],popups:o.popups||[],categorySectionStyle:o.categorySectionStyle||h.categorySectionStyle}),f.current=!0)):!f.current&&o&&(console.log("[AdminCustomization] Initial config load"),p({...h,...o,addresses:o.addresses||[],emails:o.emails||[],phones:o.phones||[],socialLinks:o.socialLinks||[],footerQuickLinks:o.footerQuickLinks||[],footerUsefulLinks:o.footerUsefulLinks||[],showFlashSaleCounter:o.showFlashSaleCounter??!0,headerLogo:o.headerLogo??null,footerLogo:o.footerLogo??null,campaigns:o.campaigns||[],carouselItems:o.carouselItems||[],popups:o.popups||[],categorySectionStyle:o.categorySectionStyle||h.categorySectionStyle}),f.current=!0,y.current=!1))},[u,o]),r.useEffect(()=>{f.current&&k.current&&JSON.stringify(t)!==JSON.stringify(k.current)&&(y.current=!0),k.current=t},[t]),r.useEffect(()=>{const c=async()=>{const i={};let d=!1;if(t.headerLogo&&w(t.headerLogo))try{const s=await _(t.headerLogo,u,"branding");i.headerLogo=s,d=!0}catch(s){console.error("[AdminCustomization] Failed to convert headerLogo:",s)}if(t.footerLogo&&w(t.footerLogo))try{const s=await _(t.footerLogo,u,"branding");i.footerLogo=s,d=!0}catch(s){console.error("[AdminCustomization] Failed to convert footerLogo:",s)}if(t.favicon&&w(t.favicon))try{const s=await _(t.favicon,u,"branding");i.favicon=s,d=!0}catch(s){console.error("[AdminCustomization] Failed to convert favicon:",s)}d&&p(s=>({...s,...i}))};f.current&&c()},[u]),r.useEffect(()=>{n&&(F({primary:n.primaryColor,secondary:n.secondaryColor,tertiary:n.tertiaryColor,font:n.fontColor||m.font,hover:n.hoverColor||m.hover,surface:n.surfaceColor||m.surface,adminBg:n.adminBgColor||m.adminBg,adminInputBg:n.adminInputBgColor||m.adminInputBg,adminBorder:n.adminBorderColor||m.adminBorder,adminFocus:n.adminFocusColor||m.adminFocus}),b(n.darkMode))},[n]);const I=async()=>{if(g)return;W(!0),j.current=!0,L(!1);const c=v.loading("Saving changes..."),i=Date.now();try{if(C&&await C(t),B){const s={primaryColor:l.primary,secondaryColor:l.secondary,tertiaryColor:l.tertiary,fontColor:l.font,hoverColor:l.hover,surfaceColor:l.surface,darkMode:R,adminBgColor:l.adminBg,adminInputBgColor:l.adminInputBg,adminBorderColor:l.adminBorder,adminFocusColor:l.adminFocus};await B(s)}const d=Date.now()-i;d<1e3&&await new Promise(s=>setTimeout(s,1e3-d)),v.dismiss(c),L(!0),y.current=!1,k.current=t,E.current=Date.now(),v.success("Saved successfully!"),setTimeout(()=>L(!1),2e3)}catch(d){v.dismiss(c),console.error("Save failed:",d),v.error("Save failed. Please try again.")}finally{W(!1),setTimeout(()=>{j.current=!1},2e3)}};return r.useEffect(()=>{const c=i=>{(i.ctrlKey||i.metaKey)&&i.key==="s"&&(i.preventDefault(),I())};return window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)}),e.jsx("div",{style:{minHeight:"100vh",backgroundColor:"#f9f9f9",padding:"20px"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:[e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"8px",padding:"20px",display:"flex",flexDirection:"column",gap:"20px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h1",{style:{fontFamily:'"Lato", sans-serif',fontWeight:700,fontSize:"22px",color:"#023337",letterSpacing:"0.11px",margin:0},children:"Customization"}),e.jsx("button",{onClick:I,disabled:g,style:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 24px",borderRadius:"8px",border:"none",fontFamily:'"Lato", sans-serif',fontWeight:700,fontSize:"15px",cursor:g?"wait":"pointer",transition:"all 0.2s ease",...T?{backgroundColor:"#22c55e",color:"white"}:g?{backgroundColor:"#4ade80",color:"white"}:{backgroundColor:"#22c55e",color:"white"}},children:T?e.jsxs(e.Fragment,{children:[e.jsx(M,{size:18}),"Saved!"]}):g?e.jsxs(e.Fragment,{children:[e.jsx(N,{size:18,className:"animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{size:18}),"Save Changes"]})})]}),e.jsxs("div",{style:{display:"flex",gap:"16px"},children:[e.jsxs("button",{onClick:()=>S("theme_view"),style:{display:"flex",alignItems:"center",gap:"4px",padding:"12px 22px",backgroundColor:"white",border:"none",borderBottom:a==="theme_view"?"2px solid #38bdf8":"2px solid transparent",cursor:"pointer",transition:"all 0.2s ease"},children:[e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",style:{opacity:a==="theme_view"?1:.5},children:[e.jsx("rect",{x:"3",y:"3",width:"7",height:"7",rx:"1",stroke:a==="theme_view"?"#38bdf8":"#333",strokeWidth:"1.5"}),e.jsx("rect",{x:"14",y:"3",width:"7",height:"7",rx:"1",stroke:a==="theme_view"?"#38bdf8":"#333",strokeWidth:"1.5"}),e.jsx("rect",{x:"3",y:"14",width:"7",height:"7",rx:"1",stroke:a==="theme_view"?"#38bdf8":"#333",strokeWidth:"1.5"}),e.jsx("rect",{x:"14",y:"14",width:"7",height:"7",rx:"1",stroke:a==="theme_view"?"#38bdf8":"#333",strokeWidth:"1.5"})]}),e.jsx("span",{style:{fontFamily:'"Poppins", sans-serif',fontWeight:500,fontSize:"16px",...a==="theme_view"?{background:"linear-gradient(90deg, #38bdf8 0%, #1e90ff 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"}:{color:"black"}},children:"Ready made theme"})]}),e.jsxs("button",{onClick:()=>S("theme_colors"),style:{display:"flex",alignItems:"center",gap:"4px",padding:"12px 22px",backgroundColor:"white",border:"none",borderBottom:a==="theme_colors"?"2px solid #38bdf8":"2px solid transparent",cursor:"pointer",transition:"all 0.2s ease"},children:[e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",style:{opacity:a==="theme_colors"?1:.5},children:[e.jsx("circle",{cx:"8",cy:"8",r:"4",stroke:a==="theme_colors"?"#38bdf8":"#333",strokeWidth:"1.5"}),e.jsx("circle",{cx:"16",cy:"8",r:"4",stroke:a==="theme_colors"?"#38bdf8":"#333",strokeWidth:"1.5"}),e.jsx("circle",{cx:"8",cy:"16",r:"4",stroke:a==="theme_colors"?"#38bdf8":"#333",strokeWidth:"1.5"}),e.jsx("rect",{x:"12",y:"12",width:"8",height:"8",rx:"1",stroke:a==="theme_colors"?"#38bdf8":"#333",strokeWidth:"1.5"})]}),e.jsx("span",{style:{fontFamily:'"Poppins", sans-serif',fontWeight:500,fontSize:"16px",...a==="theme_colors"?{background:"linear-gradient(90deg, #38bdf8 0%, #1e90ff 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"}:{color:"black"}},children:"Custom Theme"})]})]})]}),a==="theme_view"&&e.jsx(D,{websiteConfiguration:t,setWebsiteConfiguration:p}),a==="theme_colors"&&e.jsxs(e.Fragment,{children:[e.jsx(P,{websiteConfiguration:t,setWebsiteConfiguration:p,themeColors:l,setThemeColors:F}),e.jsx("div",{style:{backgroundColor:"white",borderRadius:"8px",padding:"20px"},children:e.jsx(O,{websiteConfiguration:t,setWebsiteConfiguration:p})})]})]})})};export{xe as default};
