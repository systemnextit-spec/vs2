const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/pkg-toast-Dpd4iwUK.js","assets/react-core-KcGD0Z1V.js","assets/pkg-eventemitter3-CXfM2dhT.js","assets/pkg-goober-N6sOClW1.js","assets/page-storeordersuccess-DMh4z5av.js","assets/cmp-approutes-tsx-DORRjFJg.js","assets/react-jsx-runtime-BBsywpoz.js","assets/cmp-skeletonloaders-tsx-Durrj7lG.js","assets/icons-chunk-AVFeydwE.js","assets/page-storecheckout-CVCnk0IN.js","assets/cmp-admincustomization-BgTFiuh2.js","assets/cmp-gallerypicker-tsx-T-_pXSB3.js","assets/cmp-dashboard-CwyHj6aR.js","assets/pkg-socket-D1bUdbwx.js","assets/pkg-engine-io-BZqIjJKj.js","assets/pkg-@socket.io-component-emitter-Dkula2eQ.js","assets/pkg-socket.io-parser-CafqElEs.js","assets/cmp-addnewduemodal-tsx-OjU2U-0e.js","assets/cmp-modern-dashboard-C6grFkCj.js","assets/cmp-invoiceprinttemplate-tsx-CUwUe6zE.js","assets/pkg-papaparse-BEpmA8em.js","assets/pkg-xlsx-BljOZNTS.js","assets/page-adminnote-C1Ob2d7z.js","assets/cmp-duehistorymodal-tsx-KQ79TbYj.js","assets/cmp-landingpagecomponents-tsx-r6jaT4TN.js","assets/page-storeproductdetail-C9dtR2X2.js","assets/cmp-storeproductcomponents-tsx-DwE_Owim.js","assets/page-storeprofile-B4iKxpaf.js"])))=>i.map(i=>d[i]);
import{e as yt,c as Be,_ as xe,i as le,C as wt,h as fe,S as Pe,A as kt,n as Pt,d as nn,s as rn,f as on,j as bt,k as an}from"./cmp-approutes-tsx-DORRjFJg.js";import{j as we}from"./react-jsx-runtime-BBsywpoz.js";import{r as t}from"./react-core-KcGD0Z1V.js";import{D as f,l as re,m as oe,o as sn,n as cn,p as dn,a as ln,A as un,q as fn}from"./cmp-dashboard-CwyHj6aR.js";import{a as gn}from"./pkg-react-helmet-DTJUzF1Q.js";import"./cmp-skeletonloaders-tsx-Durrj7lG.js";import"./pkg-eventemitter3-CXfM2dhT.js";import"./pkg-socket-D1bUdbwx.js";import"./pkg-engine-io-BZqIjJKj.js";import"./pkg-@socket.io-component-emitter-Dkula2eQ.js";import"./pkg-socket.io-parser-CafqElEs.js";import"./cmp-addnewduemodal-tsx-OjU2U-0e.js";import"./icons-chunk-AVFeydwE.js";import"./cmp-admincustomization-BgTFiuh2.js";import"./pkg-toast-Dpd4iwUK.js";import"./pkg-goober-N6sOClW1.js";import"./cmp-gallerypicker-tsx-T-_pXSB3.js";import"./cmp-modern-dashboard-C6grFkCj.js";import"./cmp-invoiceprinttemplate-tsx-CUwUe6zE.js";import"./pkg-papaparse-BEpmA8em.js";import"./pkg-xlsx-BljOZNTS.js";import"./page-adminnote-C1Ob2d7z.js";import"./cmp-duehistorymodal-tsx-KQ79TbYj.js";import"./pkg-react-fast-compare-BmGsRe-8.js";import"./pkg-invariant-CumQvaAf.js";import"./pkg-shallowequal-BrjoEPkv.js";const hn={primaryColor:"#22c55e",secondaryColor:"#ec4899",tertiaryColor:"#9333ea",fontColor:"#0f172a",hoverColor:"#f97316",surfaceColor:"#e2e8f0",darkMode:!1},mn=t.createContext(null),pn=({children:n,themeConfig:e=hn})=>{const r=t.useMemo(()=>({themeConfig:e,classes:{bgPrimary:"bg-primary-500",bgPrimaryLight:"bg-primary-50",bgPrimaryHover:"hover:bg-primary-600",textPrimary:"text-primary-500",borderPrimary:"border-primary-500",bgSecondary:"bg-secondary-500",bgSecondaryLight:"bg-secondary-50",textSecondary:"text-secondary-500",borderSecondary:"border-secondary-500",bgAccent:"bg-accent-500",bgAccentLight:"bg-accent-50",textAccent:"text-accent-500",borderAccent:"border-accent-500",btnPrimary:"bg-primary-500 text-white hover:bg-primary-600 active:bg-primary-700 transition",btnSecondary:"bg-secondary-500 text-white hover:bg-secondary-600 active:bg-secondary-700 transition",btnOutline:"border border-primary-500 text-primary-500 hover:bg-primary-50 active:bg-primary-100 transition",hoverPrimary:"hover:text-primary-500 hover:bg-primary-50",hoverSecondary:"hover:text-secondary-500 hover:bg-secondary-50",activePrimary:"text-primary-500 bg-primary-50",badgePrimary:"bg-primary-100 text-primary-700 border border-primary-200",badgeSecondary:"bg-secondary-100 text-secondary-700 border border-secondary-200",badgeAccent:"bg-accent-100 text-accent-700 border border-accent-200"},styles:{primaryColor:e.primaryColor,secondaryColor:e.secondaryColor,tertiaryColor:e.tertiaryColor,fontColor:e.fontColor,hoverColor:e.hoverColor,surfaceColor:e.surfaceColor}}),[e]);return we.jsx(mn.Provider,{value:r,children:n})},ft=[],Et=[],It=[],_t=[],yn={apiKey:"",secretKey:"",instruction:""},wn={pixelId:"",accessToken:"",enableTestEvent:!1,isEnabled:!1};function bn(){const[n,e]=t.useState(!0),[r,s]=t.useState([]),[d,a]=t.useState([]),[h,S]=t.useState(null),[m,y]=t.useState(null),[b,L]=t.useState(void 0),[g,_]=t.useState([]),[F,A]=t.useState([]),[R,I]=t.useState(wn),[x,v]=t.useState(yn),[p,k]=t.useState([]),[w,O]=t.useState([]),[l,u]=t.useState(ft),[P,U]=t.useState(Et),[J,D]=t.useState([]),[T,N]=t.useState(It),[E,j]=t.useState(_t),[B,M]=t.useState(null),[Y,Q]=t.useState(!1),[Z,ee]=t.useState([]),[ie,be]=t.useState(1),[Le,ge]=t.useState(null),[G,ce]=t.useState([]),[X,Ne]=t.useState(null),he=t.useRef(r),ne=t.useRef(d),Ae=t.useRef(h),ae=t.useRef(m),ue=t.useRef(b),H=t.useRef(g),me=t.useRef(F),Ee=t.useRef(x),Oe=t.useRef(R),Te=t.useRef(p),pe=t.useRef(w),o=t.useRef(l),c=t.useRef(P),i=t.useRef(J),C=t.useRef(T),W=t.useRef(E),K=t.useRef(G),V=t.useRef(B),Ie=t.useRef(!1),Ce=t.useRef([]),ye=t.useRef(!1),We=t.useRef(!1),Se=t.useRef([]),Ke=t.useRef(!1),$e=t.useRef(null),Fe=t.useRef(null),Ve=t.useRef(void 0),Qe=t.useRef([]),Xe=t.useRef([]),Ze=t.useRef([]),je=t.useRef([]),et=t.useRef([]),tt=t.useRef([]),He=t.useRef([]),nt=t.useRef([]),rt=t.useRef([]),ot=t.useRef([]),at=t.useRef(!1),st=t.useRef(!1),it=t.useRef(!1),ct=t.useRef(null),dt=t.useMemo(()=>({ordersRef:he,productsRef:ne,logoRef:Ae,themeConfigRef:ae,websiteConfigRef:ue,deliveryConfigRef:H,paymentMethodsRef:me,courierConfigRef:Ee,facebookPixelConfigRef:Oe,rolesRef:Te,usersRef:pe,categoriesRef:o,subCategoriesRef:c,childCategoriesRef:i,brandsRef:C,tagsRef:W,landingPagesRef:K,userRef:V,ordersLoadedRef:Ie,prevOrdersRef:Ce,initialDataLoadedRef:ye,productsLoadedFromServerRef:We,prevProductsRef:Se,isFirstProductUpdateRef:Ke,prevLogoRef:$e,prevThemeConfigRef:Fe,prevWebsiteConfigRef:Ve,prevDeliveryConfigRef:Qe,prevPaymentMethodsRef:Xe,prevRolesRef:Ze,prevUsersRef:je,prevCategoriesRef:et,prevSubCategoriesRef:tt,prevChildCategoriesRef:He,prevBrandsRef:nt,prevTagsRef:rt,prevLandingPagesRef:ot,catalogLoadedRef:at,adminDataLoadedRef:st,sessionRestoredRef:it}),[]);return t.useEffect(()=>{he.current=r},[r]),t.useEffect(()=>{ne.current=d},[d]),t.useEffect(()=>{Ae.current=h},[h]),t.useEffect(()=>{ae.current=m},[m]),t.useEffect(()=>{ue.current=b},[b]),t.useEffect(()=>{H.current=g},[g]),t.useEffect(()=>{me.current=F},[F]),t.useEffect(()=>{Ee.current=x},[x]),t.useEffect(()=>{Oe.current=R},[R]),t.useEffect(()=>{Te.current=p},[p]),t.useEffect(()=>{pe.current=w},[w]),t.useEffect(()=>{o.current=l},[l]),t.useEffect(()=>{c.current=P},[P]),t.useEffect(()=>{i.current=J},[J]),t.useEffect(()=>{C.current=T},[T]),t.useEffect(()=>{W.current=E},[E]),t.useEffect(()=>{K.current=G},[G]),t.useEffect(()=>{V.current=B},[B]),{isLoading:n,setIsLoading:e,orders:r,setOrders:s,products:d,setProducts:a,logo:h,setLogo:S,themeConfig:m,setThemeConfig:y,websiteConfig:b,setWebsiteConfig:L,deliveryConfig:g,setDeliveryConfig:_,paymentMethods:F,setPaymentMethods:A,facebookPixelConfig:R,setFacebookPixelConfig:I,roles:p,setRoles:k,users:w,setUsers:O,categories:l,setCategories:u,subCategories:P,setSubCategories:U,childCategories:J,setChildCategories:D,brands:T,setBrands:N,tags:E,setTags:j,courierConfig:x,setCourierConfig:v,user:B,setUser:M,isLoginOpen:Y,setIsLoginOpen:Q,wishlist:Z,setWishlist:ee,checkoutQuantity:ie,setCheckoutQuantity:be,selectedVariant:Le,setSelectedVariant:ge,landingPages:G,setLandingPages:ce,selectedLandingPage:X,setSelectedLandingPage:Ne,refs:dt,handleMobileMenuOpenRef:ct}}let qe=null;const Ct=async()=>qe||(qe=await xe(()=>import("./pkg-toast-Dpd4iwUK.js"),__vite__mapDeps([0,1,2,3])),qe),ve={success:n=>Ct().then(e=>e.toast.success(n)),error:n=>Ct().then(e=>e.toast.error(n))};function Cn(n){const{activeTenantId:e,products:r,wishlist:s,checkoutQuantity:d,selectedProduct:a,selectedVariant:h,user:S,setProducts:m,setOrders:y,setRoles:b,setWishlist:L,setCheckoutQuantity:g,setSelectedProduct:_,setSelectedVariant:F,setSelectedLandingPage:A,setCurrentView:R,setLogo:I,setThemeConfig:x,setWebsiteConfig:v,setDeliveryConfig:p,setPaymentMethods:k,setCourierConfig:w,setCategories:O,setSubCategories:l,setChildCategories:u,setBrands:P,setTags:U}=n,J=t.useCallback(o=>{const c={...o,tenantId:o.tenantId||e};b(i=>[...i,c])},[e,b]),D=t.useCallback(o=>{const c={...o,tenantId:o.tenantId||e};b(i=>i.map(C=>C.id===c.id?c:C))},[e,b]),T=t.useCallback(o=>{b(c=>c.filter(i=>i.id!==o))},[b]),N=t.useCallback(o=>{const c=o.tenantId||e,i=yt(o.slug||o.name||`product-${o.id}`,r,c,o.id);m(C=>[...C,{...o,slug:i,tenantId:c}])},[e,r,m]),E=t.useCallback(o=>{const c=o.tenantId||e,i=yt(o.slug||o.name||`product-${o.id}`,r,c,o.id);m(C=>C.map(W=>W.id===o.id?{...o,slug:i,tenantId:c}:W))},[e,r,m]),j=t.useCallback(o=>{m(c=>{const i=c.filter(C=>C.id!==o);return f.save("products",i,e),i})},[m,e]),B=t.useCallback(o=>{m(c=>{const i=c.filter(C=>!o.includes(C.id));return f.save("products",i,e),ve.success(`Deleted ${o.length} products`),i})},[m,e]),M=t.useCallback((o,c)=>{const{slug:i,...C}=c;m(W=>{const K=W.map(V=>o.includes(V.id)?{...V,...C}:V);return f.save("products",K,e),K})},[m,e]),Y=t.useCallback((o,c)=>{m(i=>{const C=new Date,W=new Date(C.getTime()+10080*60*1e3),K=i.map(V=>o.includes(V.id)?c==="add"?{...V,flashSale:!0,flashSaleStartDate:C.toISOString(),flashSaleEndDate:W.toISOString()}:{...V,flashSale:!1,flashSaleStartDate:void 0,flashSaleEndDate:void 0}:V);return f.save("products",K,e),ve.success(c==="add"?`Added ${o.length} products to Flash Sale`:`Removed ${o.length} products from Flash Sale`),K})},[m,e]),Q=t.useCallback((o,c)=>{m(i=>{const C=i.map(W=>{if(!o.includes(W.id))return W;const K=W.originalPrice||W.price,V=Math.round(K*(1-c/100));return{...W,originalPrice:K,price:V,discount:`${c}%`}});return f.save("products",C,e),ve.success(`Applied ${c}% discount to ${o.length} products`),C})},[m,e]),Z=t.useCallback((o,c)=>{y(i=>i.map(C=>C.id===o?{...C,...c,tenantId:C.tenantId||e}:C))},[e,y]),ee=t.useCallback(o=>{const c={...o,tenantId:o.tenantId||e};y(i=>[c,...i])},[e,y]),ie=t.useCallback(o=>{L(c=>c.includes(o)?c:[...c,o])},[L]),be=t.useCallback(o=>{L(c=>c.filter(i=>i!==o))},[L]),Le=t.useCallback(o=>s.includes(o),[s]),ge=t.useCallback((o,c=1,i)=>{_(o),g(c),F(Be(o,i)),R("checkout"),window.history.pushState({},"","/checkout"),xe(()=>import("./page-storeordersuccess-DMh4z5av.js"),__vite__mapDeps([4,5,6,1,2,7,8])).catch(()=>{}),typeof window<"u"&&window.scrollTo({top:0,behavior:"smooth"})},[_,g,F,R]),G=t.useCallback(o=>{const c=r.find(i=>i.id===o);if(!c){ve.error("Product unavailable for checkout");return}ge(c,1,Be(c))},[r,ge]),ce=t.useCallback(async o=>{const c=`#${Math.floor(1e3+Math.random()*9e3)}`,i={id:c,tenantId:e,customer:o.fullName,location:o.address,amount:o.amount,date:new Date().toLocaleString("en-US",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),status:"Pending",email:o.email,phone:o.phone,division:o.division,variant:Be(a,o.variant||h),productId:a?.id,productName:a?.name,quantity:o.quantity||d,deliveryType:o.deliveryType,deliveryCharge:o.deliveryCharge,paymentMethod:o.paymentMethod,paymentMethodId:o.paymentMethodId,transactionId:o.transactionId,customerPaymentPhone:o.customerPaymentPhone};try{const W=await fetch(`https://allinbangla.com/api/orders/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(W.ok){const K=await W.json();y(V=>[K.data||i,...V])}else y(K=>[i,...K])}catch{y(W=>[i,...W])}R("success"),window.history.pushState({},"",`/success-order?orderId=${encodeURIComponent(c)}`),window.scrollTo(0,0)},[e,a,h,d,y,R]),X=t.useCallback(async o=>{const c=r.find(K=>K.id===o.productId);if(!c){ve.error("Product not found");return}const i=`LP-${Date.now()}-${Math.floor(1e3+Math.random()*9e3)}`,C=c.price*o.quantity,W={id:i,tenantId:e,customer:o.fullName,location:o.address,phone:o.phone,amount:C,date:new Date().toLocaleString("en-US",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),status:"Pending",email:o.email,division:o.division,variant:Be(c),productId:c.id,productName:c.name,quantity:o.quantity,source:"landing_page",landingPageId:o.pageId};try{const V=await fetch(`https://allinbangla.com/api/orders/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(W)});if(V.ok){const Ie=await V.json();y(Ce=>[Ie.data||W,...Ce]),ve.success(`Order ${i} placed successfully! You will be contacted soon.`),setTimeout(()=>{window.scrollTo(0,0)},100)}else y(Ie=>[W,...Ie]),ve.success(`Order ${i} placed successfully! You will be contacted soon.`)}catch(K){console.error("Order submission error:",K),y(V=>[W,...V]),ve.success(`Order ${i} placed successfully! You will be contacted soon.`)}},[e,r,y]),Ne=t.useCallback(()=>{A(null),R(le(S?.role)?"admin":"store")},[S,A,R]),he=t.useCallback(o=>I(o),[I]),ne=t.useCallback(async o=>{console.log("[handleUpdateTheme] Updating theme config:",o),x(o),e&&(console.log("[handleUpdateTheme] Saving to DataService for tenant:",e),await f.saveImmediate("theme_config",o,e),console.log("[handleUpdateTheme] Saved to DataService successfully"))},[e,x]),Ae=t.useCallback(async o=>{v(o),e&&await f.saveImmediate("website_config",o,e)},[e,v]),ae=t.useCallback(o=>w(o),[w]),ue=t.useCallback(async o=>{if(p(o),e)try{await f.save("delivery_config",o,e)}catch(c){console.error("Failed to save delivery config:",c)}},[e,p]),H=t.useCallback(async o=>{console.log("[useAppHandlers] handleUpdatePaymentMethods called with",o.length,"methods"),k(o)},[k]),me=t.useMemo(()=>({add:o=>{O(c=>{const i=[...c,{...o,tenantId:o?.tenantId||e}];return f.save("categories",i,e),i})},update:o=>{O(c=>{const i=c.map(C=>C.id===o.id?{...o,tenantId:o?.tenantId||e}:C);return f.save("categories",i,e),i})},delete:o=>{O(c=>{const i=c.filter(C=>C.id!==o);return f.save("categories",i,e),i})}}),[e,O]),Ee=t.useMemo(()=>({add:o=>{l(c=>{const i=[...c,{...o,tenantId:o?.tenantId||e}];return f.save("subcategories",i,e),i})},update:o=>{l(c=>{const i=c.map(C=>C.id===o.id?{...o,tenantId:o?.tenantId||e}:C);return f.save("subcategories",i,e),i})},delete:o=>{l(c=>{const i=c.filter(C=>C.id!==o);return f.save("subcategories",i,e),i})}}),[e,l]),Oe=t.useMemo(()=>({add:o=>{u(c=>{const i=[...c,{...o,tenantId:o?.tenantId||e}];return f.save("childcategories",i,e),i})},update:o=>{u(c=>{const i=c.map(C=>C.id===o.id?{...o,tenantId:o?.tenantId||e}:C);return f.save("childcategories",i,e),i})},delete:o=>{u(c=>{const i=c.filter(C=>C.id!==o);return f.save("childcategories",i,e),i})}}),[e,u]),Te=t.useMemo(()=>({add:o=>{P(c=>{const i=[...c,{...o,tenantId:o?.tenantId||e}];return f.save("brands",i,e),i})},update:o=>{P(c=>{const i=c.map(C=>C.id===o.id?{...o,tenantId:o?.tenantId||e}:C);return f.save("brands",i,e),i})},delete:o=>{P(c=>{const i=c.filter(C=>C.id!==o);return f.save("brands",i,e),i})}}),[e,P]),pe=t.useMemo(()=>({add:o=>{U(c=>{const i=[...c,{...o,tenantId:o?.tenantId||e}];return f.save("tags",i,e),i})},update:o=>{U(c=>{const i=c.map(C=>C.id===o.id?{...o,tenantId:o?.tenantId||e}:C);return f.save("tags",i,e),i})},delete:o=>{U(c=>{const i=c.filter(C=>C.id!==o);return f.save("tags",i,e),i})}}),[e,U]);return{handleAddRole:J,handleUpdateRole:D,handleDeleteRole:T,handleAddProduct:N,handleUpdateProduct:E,handleDeleteProduct:j,handleBulkDeleteProducts:B,handleBulkUpdateProducts:M,handleBulkFlashSale:Y,handleBulkDiscount:Q,handleUpdateOrder:Z,handleAddOrder:ee,addToWishlist:ie,removeFromWishlist:be,isInWishlist:Le,handleCheckoutStart:ge,handleCheckoutFromCart:G,handlePlaceOrder:ce,handleLandingOrderSubmit:X,handleCloseLandingPreview:Ne,handleUpdateLogo:he,handleUpdateTheme:ne,handleUpdateWebsiteConfig:Ae,handleUpdateCourierConfig:ae,handleUpdateDeliveryConfig:ue,handleUpdatePaymentMethods:H,catHandlers:me,subCatHandlers:Ee,childCatHandlers:Oe,brandHandlers:Te,tagHandlers:pe}}const Sn=typeof import.meta<"u"?"https://allinbangla.com":"",Rn=()=>{if(typeof window>"u")return null;try{return localStorage.getItem("admin_auth_token")}catch{return null}};async function vn(n){const e=Rn();if(!e){console.warn("[InventoryLogger] No auth token available");return}const r=n.newStock-n.previousStock,s=r>0?"increased":r<0?"decreased":"unchanged",d={tenantId:n.tenantId,action:"Inventory Updated",actionType:"update",resourceType:"inventory",resourceId:String(n.productId),resourceName:n.productName,details:`Stock ${s} from ${n.previousStock} to ${n.newStock} (${r>=0?"+":""}${r})`,metadata:{productId:n.productId,productName:n.productName,previousStock:n.previousStock,newStock:n.newStock,stockChange:r},status:"success"};try{const a=await fetch(`${Sn}/api/audit-logs`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(d)});a.ok||console.warn("[InventoryLogger] Failed to log inventory change:",a.statusText)}catch(a){console.error("[InventoryLogger] Error logging inventory change:",a)}}async function kn(n,e,r){const s=new Map(n.map(a=>[String(a.id),a])),d=[];for(const a of e){const h=s.get(String(a.id)),S=h?.stock??0,m=a.stock??0;h&&S!==m&&d.push({productId:a.id,productName:a.name,previousStock:S,newStock:m,tenantId:r})}d.length>0&&(console.log(`[InventoryLogger] Logging ${d.length} inventory changes`),await Promise.all(d.map(a=>vn(a))))}const q=n=>{const e=new WeakSet;return JSON.stringify(n,(r,s)=>{if(typeof s=="object"&&s!==null){if(e.has(s))return"[Circular]";e.add(s)}if(!(s instanceof HTMLElement||r==="_reactFiber"||r==="__reactFiber"||r.startsWith("__reactFiber")))return s})};function Pn(n){const{activeTenantId:e,isLoading:r,isTenantSwitching:s,orders:d,products:a,logo:h,themeConfig:S,websiteConfig:m,deliveryConfig:y,courierConfig:b,facebookPixelConfig:L,roles:g,users:_,categories:F,subCategories:A,childCategories:R,brands:I,tags:x,landingPages:v,refs:p}=n,{ordersLoadedRef:k,prevOrdersRef:w,initialDataLoadedRef:O,productsLoadedFromServerRef:l,prevProductsRef:u,isFirstProductUpdateRef:P,prevLogoRef:U,prevThemeConfigRef:J,prevWebsiteConfigRef:D,prevDeliveryConfigRef:T,prevRolesRef:N,prevCategoriesRef:E,prevSubCategoriesRef:j,prevChildCategoriesRef:B,prevBrandsRef:M,prevTagsRef:Y,prevLandingPagesRef:Q,catalogLoadedRef:Z,adminDataLoadedRef:ee,userRef:ie}=p;t.useEffect(()=>{ie.current=n.refs.userRef.current},[n.refs.userRef]),t.useEffect(()=>{if(!r&&!s&&e){if(re("orders",e)){oe("orders",e),w.current=d;return}if(!k.current){k.current=!0,w.current=d;return}if(d.length===0&&w.current.length>0)return;q(d)!==q(w.current)&&(w.current=d,f.save("orders",d,e))}},[d,r,s,e,k,w]),t.useEffect(()=>{!r&&e&&(O.current=!0)},[r,e,O]),t.useEffect(()=>{l.current=!1,P.current=!0,k.current=!1,Z.current=!1,u.current=[],w.current=[],E.current=[],j.current=[],B.current=[],M.current=[],Y.current=[],N.current=[]},[e]),t.useEffect(()=>{if(!(r||s||!O.current||!e)){if(re("products",e)){oe("products",e),u.current=a;return}if(P.current){P.current=!1,u.current=a,l.current=!0;return}a.length===0&&u.current.length>0||q(a)!==q(u.current)&&(kn(u.current,a,e),u.current=a,f.saveImmediate("products",a,e))}},[a,e,r,s]),t.useEffect(()=>{if(!r&&!s&&e&&ee.current&&g.length>0){if(q(g)===q(N.current))return;if(re("roles",e)){oe("roles",e),N.current=g;return}N.current=g,f.save("roles",g,e)}},[g,r,s,e]),t.useEffect(()=>{!r&&!s&&e&&ee.current&&_.length>0&&f.save("users",_,e)},[_,r,s,e]),t.useEffect(()=>{if(!(!e||r||s||!O.current)&&h!==U.current){if(re("logo",e)){oe("logo",e),U.current=h;return}U.current=h,f.save("logo",h,e)}},[h,r,s,e]),t.useEffect(()=>{if(!(!e||r||s||!O.current)&&q(S)!==q(J.current)){if(re("theme",e)){oe("theme",e),J.current=S;return}J.current=S,f.saveImmediate("theme_config",S,e)}},[S,r,s,e]),t.useEffect(()=>{if(!(!e||r||s||!O.current)&&q(m)!==q(D.current)){if(re("website",e)){oe("website",e),D.current=m;return}D.current=m,m&&f.saveImmediate("website_config",m,e)}},[m,r,s,e]),t.useEffect(()=>{if(!r&&!s&&e){if(q(y)===q(T.current))return;if(re("delivery",e)){oe("delivery",e),T.current=y;return}T.current=y,f.save("delivery_config",y,e)}},[y,r,s,e]),t.useEffect(()=>{!r&&!s&&e&&ee.current&&f.saveCourierConfig(e,b)},[b,r,s,e]),t.useEffect(()=>{!r&&!s&&e&&ee.current&&f.save("facebook_pixel",L,e)},[L,r,s,e]),t.useEffect(()=>{if(!r&&!s&&e&&Z.current){if(q(F)===q(E.current))return;if(re("categories",e)){oe("categories",e),E.current=F;return}E.current=F,f.save("categories",F,e)}},[F,r,s,e]),t.useEffect(()=>{if(!r&&!s&&e&&Z.current){if(q(A)===q(j.current))return;if(re("subcategories",e)){oe("subcategories",e),j.current=A;return}j.current=A,f.save("subcategories",A,e)}},[A,r,s,e]),t.useEffect(()=>{if(!r&&!s&&e&&Z.current){if(q(R)===q(B.current))return;if(re("childcategories",e)){oe("childcategories",e),B.current=R;return}B.current=R,f.save("childcategories",R,e)}},[R,r,s,e]),t.useEffect(()=>{if(!r&&!s&&e&&Z.current){if(q(I)===q(M.current))return;if(re("brands",e)){oe("brands",e),M.current=I;return}M.current=I,f.save("brands",I,e)}},[I,r,s,e]),t.useEffect(()=>{if(!r&&!s&&e&&Z.current){if(q(x)===q(Y.current))return;if(re("tags",e)){oe("tags",e),Y.current=x;return}Y.current=x,f.save("tags",x,e)}},[x,r,s,e]),t.useEffect(()=>{if(console.log("[LandingPages Persistence] Check:",{isLoading:r,isTenantSwitching:s,activeTenantId:e,initialDataLoaded:O.current,landingPagesCount:v.length,prevCount:Q.current.length}),!r&&!s&&e&&v.length>0){if(q(v)===q(Q.current)){console.log("[LandingPages Persistence] Skipped - no changes");return}if(re("landing_pages",e)){oe("landing_pages",e),Q.current=v,console.log("[LandingPages Persistence] Skipped - from socket");return}Q.current=v,console.log("[LandingPages Persistence] Saving landing pages:",v.length,"to tenant:",e),f.save("landing_pages",v,e)}},[v,r,s,e])}function En({activeTenantId:n,isLoading:e,user:r,websiteConfig:s,isTenantSwitching:d=!1}){const[a,h]=t.useState(!1),[S,m]=t.useState(!1),[y,b]=t.useState([]),[L,g]=t.useState(!1),_=t.useRef(null),F=t.useRef([]),A=t.useRef(!1),R=t.useRef(!1),I=t.useRef(!1),x=t.useRef(!1),v=t.useRef(r),p=t.useRef(!1);t.useEffect(()=>{v.current=r},[r]),t.useEffect(()=>{F.current=y},[y]),t.useEffect(()=>{A.current=S},[S]),t.useEffect(()=>{_.current=null},[n]),t.useEffect(()=>{if(!s?.chatGreeting||y.length>0)return;const E=n||"default";if(_.current===E)return;const j={id:`greeting-${Date.now()}`,sender:"admin",text:s.chatGreeting,timestamp:Date.now()};b([j]),_.current=E},[s?.chatGreeting,y.length,n]),t.useEffect(()=>{if(e||!n||!x.current||d)return;if(I.current){I.current=!1;return}(async()=>{R.current=!0;try{await f.save("chat_messages",y,n)}catch(j){console.warn("Unable to save chat messages",j)}finally{R.current=!1}})()},[y,e,n,d]),t.useEffect(()=>{if(typeof window>"u"||!n||e)return;if(!(a||S||le(r?.role))){p.current=!1;return}p.current=!0;let j=!0,B=!1;const M=async()=>{if(!(!j||B||R.current||!p.current)){B=!0;try{const Q=await f.getChatMessages(n);if(!j)return;const Z=Array.isArray(Q)?[...Q]:[];Z.sort((G,ce)=>(G?.timestamp||0)-(ce?.timestamp||0));const ee=F.current,ie=new Set(ee.map(G=>G.id)),be=Z.filter(G=>!ie.has(G.id));(ee.length!==Z.length||ee.some((G,ce)=>{const X=Z[ce];return X?G.id!==X.id||G.text!==X.text||G.timestamp!==X.timestamp||G.sender!==X.sender||(G.editedAt||0)!==(X.editedAt||0):!0}))&&(I.current=!0,b(Z)),be.some(G=>G.sender==="customer")&&le(v.current?.role)&&!A.current&&g(!0)}catch(Q){console.warn("Unable to sync chat messages",Q)}finally{B=!1}}},Y=window.setInterval(M,5e3);return M(),()=>{j=!1,p.current=!1,window.clearInterval(Y)}},[n,e,a,S,r?.role]);const k=t.useCallback((E,j)=>{const B=j.trim();if(!B)return;const M=v.current?.name||(E==="customer"?"Visitor":"Support Agent"),Y=v.current?.email||void 0,Q=v.current?.role,ee={id:`chat-${Date.now()}-${Math.random().toString(36).slice(2,7)}`,sender:E,text:B,timestamp:Date.now(),customerName:E==="customer"?v.current?.name||"Visitor":void 0,customerEmail:E==="customer"?v.current?.email:void 0,authorName:M,authorEmail:Y,authorRole:Q};R.current=!0,b(ie=>[...ie,ee])},[]),w=t.useCallback(E=>{k("customer",E),S||g(!0)},[k,S]),O=t.useCallback(E=>{k("admin",E)},[k]),l=t.useCallback((E,j)=>{const B=j.trim();if(!B)return;const M=F.current.find(Y=>Y.id===E);!M||M.text===B||(R.current=!0,b(Y=>Y.map(Q=>Q.id===E?{...Q,text:B,editedAt:Date.now()}:Q)))},[]),u=t.useCallback(E=>{F.current.some(B=>B.id===E)&&(R.current=!0,b(B=>B.filter(M=>M.id!==E)))},[]),P=t.useCallback(()=>{m(!1),h(!0)},[]),U=t.useCallback(()=>{h(!1)},[]),J=t.useCallback(()=>{m(!0),h(!1),g(!1)},[]),D=t.useCallback(()=>{m(!1)},[]),T=t.useCallback((E,j)=>{const B=Array.isArray(E)?E:[];I.current=!0,x.current=!0,b(B),_.current=B.length?j||"default":null,g(!1),m(!1)},[]),N=t.useCallback(()=>{x.current=!1},[]);return{isChatOpen:a,isAdminChatOpen:S,chatMessages:y,hasUnreadChat:L,handleCustomerSendChat:w,handleAdminSendChat:O,handleEditChatMessage:l,handleDeleteChatMessage:u,handleOpenChat:P,handleCloseChat:U,handleOpenAdminChat:J,handleCloseAdminChat:D,loadChatMessages:T,resetChatLoaded:N,setChatMessages:b,setHasUnreadChat:g,skipNextChatSaveRef:I,chatMessagesRef:F,isAdminChatOpenRef:A}}let Je=null;const lt=async()=>Je||(Je=await xe(()=>import("./pkg-toast-Dpd4iwUK.js"),__vite__mapDeps([0,1,2,3])),Je),Ge={success:n=>lt().then(e=>e.toast.success(n)),error:n=>lt().then(e=>e.toast.error(n)),info:n=>lt().then(e=>e.toast(n))},In=n=>n?`${wt}-${n}`:wt,St=n=>{try{return JSON.parse(localStorage.getItem(n)||"[]")}catch{return[]}};function _n({user:n,products:e,tenantId:r}){const s=t.useMemo(()=>In(r),[r]),[d,a]=t.useState(()=>typeof window>"u"?[]:St(s));t.useEffect(()=>{typeof window<"u"&&a(St(s))},[s]),t.useEffect(()=>{if(typeof window<"u")try{localStorage.setItem(s,JSON.stringify(d))}catch{}},[d,s]),t.useEffect(()=>{if(!n?.id)return;let y=!1;return(async()=>{try{const b=await f.get("cart",[],n.id);!y&&Array.isArray(b)&&a(b)}catch{}})(),()=>{y=!0}},[n?.id]),t.useEffect(()=>{n?.id&&f.save("cart",d,n.id).catch(()=>{})},[d,n?.id]);const h=t.useCallback((y,b)=>{a(L=>{const g=L.includes(y),_=g?L.filter(F=>F!==y):[...L,y];return b?.silent||Ge.success(g?"Removed from cart":"Added to cart"),_})},[]),S=t.useCallback((y,b=1,L,g)=>{a(_=>_.includes(y.id)?(g?.silent||Ge.info("Already in cart"),_):(g?.silent||Ge.success(`${y.name} added to cart`),[..._,y.id]))},[]),m=t.useCallback((y,b)=>{const L=e.find(g=>g.id===y);if(!L){Ge.error("Product unavailable");return}b(L,1,Be(L))},[e]);return{cartItems:d,setCartItems:a,handleCartToggle:h,handleAddProductToCart:S,handleCheckoutFromCart:m}}const ke="opbd",Rt="https://allinbangla.com",vt=()=>{if(typeof window>"u")return null;const e=window.location.hostname.match(/^([a-z0-9-]+)\.(systemnextit\.com|cartnget\.shop)$/i);return e?e[1]:null};function xn({tenants:n,users:e,activeTenantId:r,setUser:s,setUsers:d,setActiveTenantId:a,setCurrentView:h,setAdminSection:S,setSelectedVariant:m}){const y=t.useCallback((A,R)=>{const I=A.trim(),x=R.trim(),v=I.toLowerCase(),p=n.find(w=>w.adminEmail?.toLowerCase()===v&&w.adminPassword===x);if(p){const w=e.find(l=>l.email?.toLowerCase()===v),O=w?{...w,tenantId:p.id}:{name:`${p.name} Admin`,email:I,role:"tenant_admin",tenantId:p.id};return s(O),a(p.id),S("dashboard"),h("admin"),!0}if(v==="admin@admin.com"&&x==="admin121"){const w={name:"Super Admin",email:"admin@admin.com",role:"super_admin",tenantId:r||ke};return s(w),a(w.tenantId||r||ke),S("dashboard"),h("admin"),!0}if(v==="admin@super.com"&&x==="admin121"){const w={name:"Super Admin",email:"admin@super.com",role:"super_admin",tenantId:r||ke};return s(w),a(w.tenantId||r||ke),S("dashboard"),h("admin"),!0}const k=e.find(w=>w.email?.toLowerCase()===v&&w.password===x);if(k){const w={...k,tenantId:k.tenantId||r||ke};return s(w),a(w.tenantId||r||ke),k.tenantId||d(O=>O.map(l=>l.email===k.email?w:l)),le(w.role)&&(h("admin"),S("dashboard")),!0}return!1},[n,e,r,s,a,S,h,d]),b=t.useCallback(async(A,R)=>{const I=A.trim(),x=R.trim(),v=vt(),p={"Content-Type":"application/json"};v&&(p["x-tenant-subdomain"]=v);const k=await fetch(`${Rt}/api/auth/login`,{method:"POST",headers:p,body:JSON.stringify({email:I,password:x})});if(!k.ok){const l=await k.json().catch(()=>({}));throw new Error(l.message||"Invalid email or password.")}const w=await k.json();if(le(w.user.role))throw new Error("Admin users must login at /admin/login");localStorage.setItem("admin_auth_token",w.token),localStorage.setItem("admin_auth_user",JSON.stringify(w.user)),localStorage.setItem("admin_auth_permissions",JSON.stringify(w.permissions||[]));const O={name:w.user.name,email:w.user.email,role:w.user.role,tenantId:w.user.tenantId||r||ke};return s(O),a(O.tenantId||r||ke),!0},[r,s,a]),L=t.useCallback(async A=>{if(!A.email||!A.password)throw new Error("Email and password are required");const R=A.email.trim().toLowerCase(),I=vt();try{const x={"Content-Type":"application/json"};I&&(x["x-tenant-subdomain"]=I);const v=await fetch(`${Rt}/api/auth/register`,{method:"POST",headers:x,body:JSON.stringify({name:A.name,email:R,password:A.password,phone:A.phone||"",tenantId:A.tenantId||I||r})}),p=await v.json();if(!v.ok)throw v.status===409||p.error?.includes("already")?new Error("This email is already registered. Please try logging in instead."):new Error(p.error||p.message||"Registration failed. Please try again.");localStorage.setItem("admin_auth_token",p.token),localStorage.setItem("admin_auth_user",JSON.stringify(p.user)),localStorage.setItem("admin_auth_permissions",JSON.stringify(p.permissions||[]));const k={name:p.user.name,email:p.user.email,phone:p.user.phone,role:p.user.role||"customer",tenantId:p.user.tenantId||I||r};return s(k),d(w=>[...w.filter(O=>O.email!==k.email),k]),k.tenantId&&a(k.tenantId),!0}catch(x){throw new Error(x instanceof Error?x.message:"Registration failed")}},[r,d,s,a]),g=t.useCallback(async()=>{throw new Error("Google login is not available in this environment.")},[]),_=t.useCallback(async()=>{localStorage.removeItem("admin_auth_token"),localStorage.removeItem("admin_auth_user"),localStorage.removeItem("admin_auth_permissions");try{sessionStorage.removeItem("adminSection")}catch{}s(null),m(null),S("dashboard");const A=typeof window<"u"&&(window.location.pathname==="/admin"||window.location.pathname.startsWith("/admin/")),R=typeof window<"u"&&(window.location.hostname==="admin.allinbangla.com"||window.location.hostname.startsWith("admin.")),I=typeof window<"u"&&(window.location.hostname==="superadmin.allinbangla.com"||window.location.hostname.startsWith("superadmin."));R||I?h("admin-login"):A?(h("store"),window.history.pushState({},"","/")):h("store")},[s,h,m,S]),F=t.useCallback(A=>{const R={...A,tenantId:A.tenantId||r};s(R),d(I=>I.some(v=>v.email===A.email)?I.map(v=>v.email===A.email?R:v):[...I,R])},[r,s,d]);return{tryLegacyLogin:y,handleLogin:b,handleRegister:L,handleGoogleLogin:g,handleLogout:_,handleUpdateProfile:F}}function Ln({themeConfig:n,websiteConfig:e,activeTenantId:r,isLoading:s,currentView:d,isTenantSwitching:a=!1}){const h=t.useRef(!1),S=t.useRef(""),m=t.useRef(!1),y=t.useRef("");t.useEffect(()=>{m.current=!1,h.current=!1,S.current="",y.current=""},[r]);const b=t.useRef("");return t.useEffect(()=>{if(!n||!r)return;const L=JSON.stringify({primaryColor:n.primaryColor,secondaryColor:n.secondaryColor,tertiaryColor:n.tertiaryColor,fontColor:n.fontColor,hoverColor:n.hoverColor});if(b.current===L)return;b.current=L;const g=document.documentElement;console.log("[useThemeEffects] Applying theme colors:",{primaryColor:n.primaryColor,secondaryColor:n.secondaryColor,tertiaryColor:n.tertiaryColor,fontColor:n.fontColor,hoverColor:n.hoverColor,surfaceColor:n.surfaceColor});const _=fe(n.primaryColor||"#22c55e"),F=fe(n.secondaryColor||"#ec4899"),A=fe(n.tertiaryColor||"#9333ea"),R=fe(n.fontColor||"#0f172a"),I=fe(n.hoverColor||"#f97316"),x=fe(n.surfaceColor||"#e2e8f0");g.style.setProperty("--color-primary-rgb",_),g.style.setProperty("--color-secondary-rgb",F),g.style.setProperty("--color-tertiary-rgb",A),g.style.setProperty("--color-font-rgb",R),g.style.setProperty("--color-hover-rgb",I),g.style.setProperty("--color-surface-rgb",x),d==="admin"||d==="admin-login"?(n.adminBgColor&&g.style.setProperty("--admin-bg",fe(n.adminBgColor)),n.adminInputBgColor&&g.style.setProperty("--admin-bg-input",fe(n.adminInputBgColor)),n.adminBorderColor&&g.style.setProperty("--admin-border-rgb",fe(n.adminBorderColor)),n.adminFocusColor&&g.style.setProperty("--admin-focus-rgb",fe(n.adminFocusColor))):["--admin-bg","--admin-bg-input","--admin-border-rgb","--admin-focus-rgb"].forEach(p=>g.style.removeProperty(p)),!s&&!a&&!h.current&&(h.current=!0,S.current=JSON.stringify(n))},[n,s,a,r,d]),t.useEffect(()=>{if(!s&&!a&&e&&r&&(m.current||(m.current=!0,y.current=JSON.stringify(e)),e.favicon)){let L=document.querySelector("link[rel~='icon']");L||(L=document.createElement("link"),L.rel="icon",document.getElementsByTagName("head")[0].appendChild(L)),L.href=e.favicon}},[e,s,a,r]),{websiteConfigLoadedRef:m}}function An(n){t.useEffect(()=>{const e=()=>{["facebook-pixel-script","facebook-pixel-noscript"].forEach(a=>document.getElementById(a)?.remove())};if(!n?.isEnabled||!n.pixelId){e();return}e();const r=n.pixelId.trim(),s=n.enableTestEvent?`TEST_${Date.now()}`:null,d=()=>{if(typeof window.fbq=="function"){window.fbq("init",r,void 0,s?{eventID:s}:void 0),window.fbq("track","PageView");return}const a=Object.assign(document.createElement("script"),{id:"facebook-pixel-script",async:!0,defer:!0,src:"https://connect.facebook.net/en_US/fbevents.js"});a.onload=()=>{typeof window.fbq=="function"&&(window.fbq("init",r,void 0,s?{eventID:s}:void 0),window.fbq("track","PageView"))},document.head.appendChild(a);const h=document.createElement("noscript");h.id="facebook-pixel-noscript",h.innerHTML=`<img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=${r}&ev=PageView&noscript=1${n.enableTestEvent?"&cd[event_source_url]=test":""}" />`,document.body.appendChild(h)};return"requestIdleCallback"in window?window.requestIdleCallback(d,{timeout:1200}):setTimeout(d,1200),e},[n])}const ut=typeof window<"u"&&(window.location.hostname==="admin.allinbangla.com"||window.location.hostname.startsWith("admin.")||window.location.hostname==="admin.localhost"),Ye=typeof window<"u"&&(window.location.hostname==="superadmin.allinbangla.com"||window.location.hostname.startsWith("superadmin.")||window.location.hostname==="superadmin.localhost"),ze=typeof window<"u"&&(window.location.hostname==="systemnextit.website"||window.location.hostname==="www.systemnextit.website"),On=typeof window<"u"&&(window.location.pathname==="/admin"||window.location.pathname.startsWith("/admin/")),Tn=typeof window<"u"&&(window.location.pathname==="/register"||window.location.pathname.startsWith("/register"));function Dn(){if(typeof window>"u")return"store";if(Tn)return"register";if(ze){try{const e=window.localStorage.getItem(Pe);if(e){const r=JSON.parse(e);if(r&&r.role&&["admin","tenant_admin","staff"].includes(r.role))return"admin"}}catch{}return"admin-login"}if(Ye){try{const e=window.localStorage.getItem(Pe);if(e){const r=JSON.parse(e);if(r&&r.role==="super_admin")return"super-admin"}}catch{}return"admin-login"}if(ut){try{const e=window.localStorage.getItem(Pe);if(e){const r=JSON.parse(e);if(r&&r.role&&["super_admin","admin","tenant_admin","staff"].includes(r.role))return"admin"}}catch{}return"admin-login"}if(On&&!ut&&!Ye){try{const e=window.localStorage.getItem(Pe);if(e){const r=JSON.parse(e);if(r&&r.role&&["super_admin","admin","tenant_admin","staff"].includes(r.role))return"admin"}}catch{}return"admin-login"}const n=window.location.pathname.replace(/^\/+|\/+$/g,"");return n.startsWith("offer/")?"offer_preview":n.startsWith("p/")?"landing_preview":"store"}const Nn=()=>{if(typeof window>"u")return"dashboard";try{const n=window.sessionStorage.getItem("adminSection");if(n)return n}catch{}return"dashboard"};function Fn({products:n,user:e,landingPages:r,setSelectedLandingPage:s}){const[d,a]=t.useState(Dn),[h,S]=t.useState(Nn),m=l=>{if(S(l),typeof window<"u")try{window.sessionStorage.setItem("adminSection",l)}catch{}},[y,b]=t.useState(null),[L,g]=t.useState(null),[_,F]=t.useState(""),[A,R]=t.useState(null),I=t.useRef(d),x=t.useRef(e),v=t.useRef(r);t.useEffect(()=>{I.current=d},[d]),t.useEffect(()=>{x.current=e},[e]),t.useEffect(()=>{v.current=r},[r]);const p=t.useCallback(l=>{F(l),I.current!=="store"&&(g(null),a("store")),typeof window<"u"&&window.scrollTo(0,0)},[]),k=t.useCallback(l=>{const u=(l??window.location.pathname).replace(/^\/+|\/+$/g,""),P=I.current,U=x.current;if(u==="register"){P!=="register"&&a("register");return}if(u==="admin/login"){P!=="admin-login"&&a("admin-login");return}if(u==="checkout"){P!=="checkout"&&a("checkout");return}if(u==="visual-search"||u==="search"){P!=="visual-search"&&a("visual-search");return}if(u==="success-order"){P!=="success"&&a("success");return}if(u==="all-products"){const T=new URLSearchParams(window.location.search),N=T.get("category"),E=T.get("brand");b(N||(E?`brand:${E}`:"all")),P.startsWith("admin")||(g(null),a("store"));return}if(u.startsWith("product-details/")){const T=u.replace("product-details/","");console.log("[Navigation] Product details route detected:",{slugOrId:T,productsCount:n.length});let N=n.find(E=>E.slug===T);if(console.log("[Navigation] Match by slug:",N?.name||"not found"),!N&&!isNaN(Number(T))&&(N=n.find(E=>E.id===Number(T)),console.log("[Navigation] Match by ID:",N?.name||"not found")),N){console.log("[Navigation] Setting product:",N.name),g(N),a("detail");return}else console.warn("[Navigation] Product not found for:",T)}if(u.startsWith("p/")){const T=u.replace("p/","");console.log("[Navigation] Landing page route detected:",{urlSlug:T,landingPagesCount:v.current.length,landingPages:v.current.map(E=>({slug:E.urlSlug,status:E.status}))});const N=v.current.find(E=>E.urlSlug===T&&E.status==="published");if(N){console.log("[Navigation] Matched landing page:",N.id),s(N),a("landing_preview");return}else{console.log("[Navigation] No matching landing page found for slug:",T);return}}if(u.startsWith("offer/")){const T=u.replace("offer/","");console.log("[Navigation] Offer page route detected (legacy):",{urlSlug:T}),R(T),a("offer_preview");return}const J=["privacy","privacy-policy","about","about-us","terms","terms-and-conditions","contact","contact-us","profile","categories","track","track-order","faq","help","support","blog","cart","wishlist","orders","my-orders","account","login","signup","sign-up","signin","sign-in","forgot-password","reset-password","returns","return-policy","refund","refund-policy","shipping","shipping-policy","delivery","delivery-policy"];if(u&&!u.includes("/")&&/^[a-z0-9-]+$/i.test(u)){if(J.includes(u.toLowerCase())){console.log("[Navigation] Static route detected, not treating as offer:",u),P.startsWith("admin")||(g(null),a("store"));return}console.log("[Navigation] Checking if path is a landing page slug:",u);const T=v.current.find(N=>N.urlSlug===u&&N.status==="published");if(T){console.log("[Navigation] Matched landing page:",T.id),s(T),a("landing_preview");return}console.log("[Navigation] Unknown path, routing to store:",u),P.startsWith("admin")||(g(null),a("store"));return}if(u==="products"){const N=new URLSearchParams(window.location.search).get("categories");if(N){b(N),P.startsWith("admin")||(g(null),a("store"));return}else{window.history.replaceState({},"","/"),b(null),P.startsWith("admin")||(g(null),a("store"));return}}if(!u){if(b(null),ze){le(U?.role)?P!=="admin"&&a("admin"):P!=="admin-login"&&a("admin-login");return}if(Ye){U?.role==="super_admin"?P!=="super-admin"&&a("super-admin"):P!=="admin-login"&&a("admin-login");return}if(ut){!P.startsWith("admin")&&P!=="admin-login"&&a("admin-login");return}P.startsWith("admin")||(g(null),a("store"));return}if(u==="admin"){le(U?.role)?a("admin"):a("admin-login");return}const D=n.find(T=>T.slug===u);if(D){g(D),a("detail");return}if(P!=="admin-login"){if(Ye){U?.role==="super_admin"?P!=="super-admin"&&a("super-admin"):a("admin-login");return}if(ze){le(U?.role)?P!=="admin"&&a("admin"):a("admin-login");return}if(u.startsWith("product-details/")){console.log("[Navigation] Product route detected but product not found yet - waiting for products to load");return}u==="landingpage"||u.startsWith("landingpage/")||(window.history.replaceState({},"","/"),P.startsWith("admin")||(g(null),a("store")))}},[n]);t.useEffect(()=>{const l=()=>k();return window.addEventListener("popstate",l),()=>window.removeEventListener("popstate",l)},[k]),t.useEffect(()=>{k(window.location.pathname)},[n,r,k]),t.useEffect(()=>{const l=window.location.pathname.replace(/^\/+|\/+$/g,"");l!=="admin/login"&&l!=="register"&&(l==="visual-search"||l==="search"||ze||l.startsWith("p/")||l.startsWith("offer/")||l==="landingpage"||l.startsWith("landingpage/")||/^[a-z0-9-]+$/i.test(l)&&!["admin","register","checkout","cart","wishlist","profile","orders","tracking"].includes(l)||l.startsWith("product-details/")||l!=="all-products"&&l!=="products"&&(n.find(u=>u.slug===l)||d==="store"&&window.location.pathname!=="/"&&!window.location.pathname.includes("checkout")&&!window.location.pathname.includes("success-order")&&!window.location.pathname.includes("register")&&window.history.replaceState({},"","/")))},[d,n]),t.useEffect(()=>{const l=u=>{const{orderId:P}=u.detail;console.log("[App] Navigate to order:",P),a("admin"),m("orders"),window.sessionStorage.setItem("highlightOrderId",P)};return window.addEventListener("navigate-to-order",l),()=>{window.removeEventListener("navigate-to-order",l)}},[]);const w=t.useCallback(l=>{a("detail"),g(l),l.slug&&window.history.pushState({slug:l.slug},"",`/product-details/${l.slug}`),requestAnimationFrame(()=>{window.scrollTo({top:0,behavior:"instant"})})},[]),O=t.useCallback(l=>{b(l),requestAnimationFrame(()=>{l?l==="all"?window.history.pushState({},"","/all-products"):l.startsWith("brand:")?window.history.pushState({},"",`/all-products?brand=${l.replace("brand:","")}`):window.history.pushState({},"",`/all-products?category=${l}`):window.history.pushState({},"","/")})},[]);return{currentView:d,setCurrentView:a,adminSection:h,setAdminSection:m,urlCategoryFilter:y,setUrlCategoryFilter:b,selectedProduct:L,setSelectedProduct:g,storeSearchQuery:_,setStoreSearchQuery:F,selectedOfferSlug:A,setSelectedOfferSlug:R,handleStoreSearchChange:p,syncViewWithLocation:k,handleProductClick:w,handleCategoryFilterChange:O,currentViewRef:I}}const Mn=(n,e,r)=>{const s=t.useRef(n);s.current=n,t.useEffect(()=>sn((d,a)=>{s.current(d,a)}),[e?.join(","),r])},Bn=(n,e=500,r,s)=>{const d=t.useRef(null),a=t.useRef({key:null}),h=t.useCallback((S,m)=>{a.current={key:S,tid:m},d.current&&clearTimeout(d.current),d.current=setTimeout(()=>{a.current.key&&n(a.current.key,a.current.tid),d.current=null,a.current.key=null},e)},[n,e]);Mn(h,r,s),t.useEffect(()=>()=>{d.current&&clearTimeout(d.current)},[])},Un=[{id:"demo-1",name:"SystemNext IT - Professional E-commerce Solutions",image:"https://placehold.co/1200x400/6366F1/white?text=SystemNext+IT+-+E-commerce+Solutions",mobileImage:"https://placehold.co/600x300/6366F1/white?text=SystemNext+IT",url:"#features",urlType:"Internal",status:"Publish",serial:1},{id:"demo-2",name:"Build Your Online Business with SystemNext IT",image:"https://placehold.co/1200x400/7C3AED/white?text=Build+Your+Business",mobileImage:"https://placehold.co/600x300/7C3AED/white?text=Build+Your+Business",url:"#pricing",urlType:"Internal",status:"Publish",serial:2},{id:"demo-3",name:"Launch Your Store in Minutes - SystemNext IT",image:"https://placehold.co/1200x400/10B981/white?text=Launch+Your+Store",mobileImage:"https://placehold.co/600x300/10B981/white?text=Launch+Your+Store",url:"#contact",urlType:"Internal",status:"Publish",serial:3}],Wn=[{id:"1",name:"Electronics",slug:"electronics",image:"https://placehold.co/100x100/3B82F6/white?text=ðŸ“±",status:"Active"},{id:"2",name:"Fashion",slug:"fashion",image:"https://placehold.co/100x100/EC4899/white?text=ðŸ‘—",status:"Active"},{id:"3",name:"Home & Living",slug:"home-living",image:"https://placehold.co/100x100/F59E0B/white?text=ðŸ ",status:"Active"},{id:"4",name:"Beauty",slug:"beauty",image:"https://placehold.co/100x100/8B5CF6/white?text=ðŸ’„",status:"Active"},{id:"5",name:"Sports",slug:"sports",image:"https://placehold.co/100x100/10B981/white?text=âš½",status:"Active"},{id:"6",name:"Books",slug:"books",image:"https://placehold.co/100x100/6366F1/white?text=ðŸ“š",status:"Active"}],$n=[{id:"1",name:"SystemNext IT",logo:"https://placehold.co/120x40/6366F1/white?text=SystemNext+IT",status:"Active"},{id:"2",name:"TechPro",logo:"https://placehold.co/120x40/3B82F6/white?text=TechPro",status:"Active"},{id:"3",name:"StyleHub",logo:"https://placehold.co/120x40/8B5CF6/white?text=StyleHub",status:"Active"}],jn=[{id:1,name:"Premium Wireless Headphones",slug:"premium-wireless-headphones",price:2999,originalPrice:4999,description:"High-quality wireless headphones with noise cancellation",image:"https://placehold.co/400x400/3B82F6/white?text=Headphones",galleryImages:["https://placehold.co/400x400/3B82F6/white?text=Headphones"],category:"Electronics",brand:"TechPro",stock:50,status:"Active",rating:4.5,reviews:128},{id:2,name:"Smart Watch Pro",slug:"smart-watch-pro",price:5499,originalPrice:7999,description:"Advanced smartwatch with health monitoring",image:"https://placehold.co/400x400/10B981/white?text=Smart+Watch",galleryImages:["https://placehold.co/400x400/10B981/white?text=Smart+Watch"],category:"Electronics",brand:"TechPro",stock:30,status:"Active",rating:4.8,reviews:256},{id:3,name:"Designer Backpack",slug:"designer-backpack",price:1299,originalPrice:1999,description:"Stylish and durable backpack for everyday use",image:"https://placehold.co/400x400/EC4899/white?text=Backpack",galleryImages:["https://placehold.co/400x400/EC4899/white?text=Backpack"],category:"Fashion",brand:"StyleHub",stock:100,status:"Active",rating:4.3,reviews:89},{id:4,name:"Bluetooth Speaker",slug:"bluetooth-speaker",price:1499,originalPrice:2499,description:"Portable speaker with powerful bass",image:"https://placehold.co/400x400/F59E0B/white?text=Speaker",galleryImages:["https://placehold.co/400x400/F59E0B/white?text=Speaker"],category:"Electronics",brand:"TechPro",stock:75,status:"Active",rating:4.6,reviews:167},{id:5,name:"Fitness Tracker Band",slug:"fitness-tracker-band",price:999,originalPrice:1499,description:"Track your fitness goals with precision",image:"https://placehold.co/400x400/EF4444/white?text=Fitness+Band",galleryImages:["https://placehold.co/400x400/EF4444/white?text=Fitness+Band"],category:"Sports",brand:"TechPro",stock:200,status:"Active",rating:4.4,reviews:312},{id:6,name:"Organic Face Cream",slug:"organic-face-cream",price:599,originalPrice:899,description:"Natural ingredients for glowing skin",image:"https://placehold.co/400x400/8B5CF6/white?text=Face+Cream",galleryImages:["https://placehold.co/400x400/8B5CF6/white?text=Face+Cream"],category:"Beauty",brand:"StyleHub",stock:150,status:"Active",rating:4.7,reviews:445},{id:7,name:"Laptop Stand",slug:"laptop-stand",price:799,originalPrice:1199,description:"Ergonomic aluminum laptop stand",image:"https://placehold.co/400x400/6366F1/white?text=Laptop+Stand",galleryImages:["https://placehold.co/400x400/6366F1/white?text=Laptop+Stand"],category:"Electronics",brand:"SystemNext IT",stock:80,status:"Active",rating:4.5,reviews:98},{id:8,name:"Yoga Mat Premium",slug:"yoga-mat-premium",price:699,originalPrice:999,description:"Non-slip eco-friendly yoga mat",image:"https://placehold.co/400x400/14B8A6/white?text=Yoga+Mat",galleryImages:["https://placehold.co/400x400/14B8A6/white?text=Yoga+Mat"],category:"Sports",brand:"StyleHub",stock:120,status:"Active",rating:4.6,reviews:234}],Hn={websiteName:"SystemNext IT",shortDescription:"Professional E-commerce & Software Solutions",headerLogo:"https://hdnfltv.com/image/nitimages/04aad350-812e-4678-a009-7d576378b603.webp",carouselItems:Un,socialLinks:[{id:"1",platform:"facebook",url:"https://facebook.com/systemnextit"},{id:"2",platform:"instagram",url:"https://instagram.com/systemnextit"},{id:"3",platform:"twitter",url:"https://twitter.com/systemnextit"}],emails:["contact@allinbangla.com"],phones:["+880 1700-000000"],addresses:["Head Office: Dhaka, Bangladesh"],showFlashSaleCounter:!0};function qn(){if(typeof window>"u")return!1;const n=window.location.hostname,e="allinbangla.com";return n===e||n===`www.${e}`?!0:n==="localhost"||n==="127.0.0.1"?n.split(".").length<=1:!1}const Ue=typeof window<"u"&&(window.location.hostname==="admin.allinbangla.com"||window.location.hostname.startsWith("admin.")),xt=typeof window<"u"&&(window.location.hostname==="superadmin.allinbangla.com"||window.location.hostname.startsWith("superadmin.")),De=()=>{typeof window<"u"&&typeof window.__hidePreloadSkeleton__=="function"&&window.__hidePreloadSkeleton__()},Jn=({setUser:n,setCurrentView:e,setActiveTenantId:r,refs:s})=>{t.useEffect(()=>{if(console.log("[SessionRestoration] Starting..."),typeof window>"u"){s.sessionRestoredRef.current=!0;return}const d=window.localStorage.getItem(Pe);if(console.log("[SessionRestoration] Stored user:",d?"found":"NOT FOUND"),xt){if(d)try{const a=JSON.parse(d);if(a&&a.role==="super_admin"){console.log("[SessionRestoration] Super admin restored"),n(a),e("super-admin"),s.sessionRestoredRef.current=!0,De();return}}catch(a){console.error("Session restoration error:",a)}e("admin-login"),s.sessionRestoredRef.current=!0,De();return}if(!d){console.log("[SessionRestoration] No stored session, setting admin-login view"),Ue&&(e("admin-login"),De()),s.sessionRestoredRef.current=!0;return}try{const a=JSON.parse(d);if(a){console.log("[SessionRestoration] Restoring user:",a.email,"role:",a.role),n(a);const h=a.tenant,S=a.tenantId||h?.id||h?._id;S&&r(S);const m=window.location.pathname==="/admin"||window.location.pathname.startsWith("/admin/");(Ue||m)&&a.role&&["super_admin","admin","tenant_admin","staff"].includes(a.role)&&(console.log("[SessionRestoration] Setting view to admin"),e("admin"))}}catch(a){console.error("Unable to restore session",a),window.localStorage.removeItem(Pe),window.localStorage.removeItem(kt)}finally{s.sessionRestoredRef.current=!0,console.log("[SessionRestoration] Complete, sessionRestoredRef.current = true")}},[])},Gn=({user:n,refs:e})=>{const r=t.useRef(!1);t.useEffect(()=>{if(console.log("[SessionPersistence] Running, user:",n?.email||"null","hadUserRef:",r.current,"sessionRestored:",e.sessionRestoredRef.current),!(typeof window>"u")){if(!e.sessionRestoredRef.current){console.log("[SessionPersistence] Session not restored yet, skipping");return}n?(console.log("[SessionPersistence] Saving user to localStorage"),r.current=!0,window.localStorage.setItem(Pe,JSON.stringify(n))):r.current?(console.log("[SessionPersistence] CLEARING localStorage (user was previously set)"),window.localStorage.removeItem(Pe),window.localStorage.removeItem(kt)):console.log("[SessionPersistence] User is null but hadUserRef is false, NOT clearing")}},[n,e.sessionRestoredRef])},zn=({user:n,activeTenantId:e,currentViewRef:r,refs:s,setActiveTenantId:d,setCurrentView:a,setAdminSection:h})=>{const S=t.useRef(!1);t.useEffect(()=>{if(!n){const b=typeof window<"u"&&(window.location.pathname==="/admin"||window.location.pathname.startsWith("/admin/")),L=typeof window<"u"?window.localStorage.getItem("admin_auth_user"):null;if(s.sessionRestoredRef.current&&r.current.startsWith("admin")&&(Ue||b)){if(L&&!S.current)return;a("admin-login"),h("dashboard")}return}S.current=!0;const m=n.tenantId||e;m!==e&&d(m);const y=typeof window<"u"&&(window.location.pathname==="/admin"||window.location.pathname.startsWith("/admin/"));le(n.role)&&!r.current.startsWith("admin")&&!r.current.startsWith("super")&&(Ue||y)&&(n.role==="super_admin"?a("super-admin"):a("admin"),h("dashboard"))},[n,e,d,a,h,r,s.sessionRestoredRef])},Yn=n=>{t.useEffect(()=>{if(!n)return;const e=setTimeout(()=>cn(n),3500);return()=>{clearTimeout(e),dn(n)}},[n])},Kn=({activeTenantId:n,hostTenantSlug:e,loadChatMessages:r,completeTenantSwitch:s,setActiveTenantId:d,setHostTenantId:a,setIsLoading:h,setProducts:S,setOrders:m,setLogo:y,setThemeConfig:b,setWebsiteConfig:L,setDeliveryConfig:g,setPaymentMethods:_,setLandingPages:F,setCategories:A,setSubCategories:R,setChildCategories:I,setBrands:x,setTags:v,refs:p})=>{t.useEffect(()=>{let k=!0;return(async()=>{if(qn()){console.log("[App] Main domain detected - loading demo data"),S(jn),L(Hn),A(Wn),x($n),v([]),m([]),y("/icons/icon-192x192.png"),b(null),g([]),_([]),F([]),R([]),I([]),De(),h(!1);return}nn()||h(!0);let l=null;try{let u=n;if(e&&!Ue&&!xt){const D=rn(e),T=await f.resolveTenantBySubdomain(D);if(!k)return;if(T?.id){if(u&&u!==T.id)try{["products","theme_config","website_config","categories","brands","tags"].forEach(N=>{localStorage.removeItem(`ds_cache_${u}::${N}`)})}catch{}u=T.id,on(D,T.id),n!==T.id&&(d(u),a(T.id))}}if(!u){De(),h(!1);return}const P=await f.bootstrap(u);if(!k)return;const U=Pt(P.products,u);S(U),p.prevThemeConfigRef.current=P.themeConfig,p.prevWebsiteConfigRef.current=P.websiteConfig,p.prevProductsRef.current=U,b(P.themeConfig),L(P.websiteConfig),(async()=>{if(k)try{const D=await f.getSecondaryData(u);if(!k)return;p.ordersLoadedRef.current=!1,p.prevOrdersRef.current=D.orders,m(D.orders),p.prevLogoRef.current=D.logo,y(D.logo),p.prevDeliveryConfigRef.current=D.deliveryConfig,g(D.deliveryConfig),p.prevPaymentMethodsRef.current=D.paymentMethods||[],_(D.paymentMethods||[]),r(D.chatMessages,n),p.prevLandingPagesRef.current=D.landingPages,F(D.landingPages),p.prevCategoriesRef.current=D.categories,A(D.categories),p.prevSubCategoriesRef.current=D.subcategories,R(D.subcategories),p.prevChildCategoriesRef.current=D.childcategories,I(D.childcategories),p.prevBrandsRef.current=D.brands,x(D.brands),p.prevTagsRef.current=D.tags,v(D.tags),p.catalogLoadedRef.current=!0}catch(D){console.warn("Failed to load secondary data",D)}})()}catch(u){l=u,console.error("Failed to load data",u)}finally{k&&(h(!1),s(l),De())}})(),()=>{k=!1}},[n,e,r,s,d,a])},Vn=({activeTenantId:n,currentView:e,tenants:r,applyTenantList:s,setUsers:d,setRoles:a,setCourierConfig:h,setFacebookPixelConfig:S,setCategories:m,setSubCategories:y,setChildCategories:b,setBrands:L,setTags:g,refs:_})=>{const F=t.useCallback(async()=>{if(n)try{if(r.length===0){const u=await f.listTenants(!0);A.current(u)}const[R,I,x,v,p,k,w,O,l]=await Promise.all([f.getUsers(n),f.getRoles(n),f.getCourierConfig(n),f.get("facebook_pixel",{pixelId:"",accessToken:"",enableTestEvent:!1,isEnabled:!1},n),f.getCatalog("categories",ft,n),f.getCatalog("subcategories",Et,n),f.getCatalog("childcategories",[],n),f.getCatalog("brands",It,n),f.getCatalog("tags",_t,n)]);_.prevUsersRef.current=R,d(R),_.prevRolesRef.current=I,a(I),h({apiKey:x?.apiKey||"",secretKey:x?.secretKey||"",instruction:x?.instruction||""}),S(v),_.catalogLoadedRef.current||(_.prevCategoriesRef.current=p,m(p),_.prevSubCategoriesRef.current=k,y(k),_.prevChildCategoriesRef.current=w,b(w),_.prevBrandsRef.current=O,L(O),_.prevTagsRef.current=l,g(l),_.catalogLoadedRef.current=!0)}catch(R){console.warn("Failed to load admin data",R)}},[n,_]),A=t.useRef(s);return t.useEffect(()=>{A.current=s},[s]),t.useEffect(()=>{e==="admin"&&!_.adminDataLoadedRef.current&&(_.adminDataLoadedRef.current=!0,F())},[e,F,_]),t.useEffect(()=>{_.adminDataLoadedRef.current=!1,_.prevLogoRef.current=null},[n,_]),{loadAdminData:F}},Qn=({products:n,categories:e,activeTenantIdRef:r,currentViewRef:s,skipNextChatSaveRef:d,chatMessagesRef:a,isAdminChatOpenRef:h,refs:S,setProducts:m,setOrders:y,setLogo:b,setThemeConfig:L,setWebsiteConfig:g,setDeliveryConfig:_,setPaymentMethods:F,setCategories:A,setLandingPages:R,setChatMessages:I,setHasUnreadChat:x})=>{const v=t.useCallback(async(p,k,w=!1)=>{if(s.current.startsWith("admin")||k&&k!==r.current)return;const O=k||r.current;try{switch(p){case"products":const l=await f.getProducts(O);(l.length>0||n.length===0)&&(S.isFirstProductUpdateRef.current=!0,m(Pt(l,O)));break;case"orders":y(await f.getOrders(O));break;case"logo":b(await f.get("logo",null,O));break;case"theme":L(await f.getThemeConfig(O));break;case"website":typeof window<"u"&&typeof window.__getAdminCustomizationUnsavedChanges=="function"&&window.__getAdminCustomizationUnsavedChanges()||g(await f.getWebsiteConfig(O));break;case"delivery":_(await f.getDeliveryConfig(O));break;case"payment_methods":F(await f.getPaymentMethods(O));break;case"categories":const P=await f.getCatalog("categories",ft,O);(P.length>0||e.length===0)&&A(P);break;case"landing_pages":R(await f.getLandingPages(O));break;case"chat_messages":const U=await f.getChatMessages(O),J=Array.isArray(U)?[...U]:[];J.sort((N,E)=>(N?.timestamp||0)-(E?.timestamp||0)),d.current=!0,I(J);const D=new Set(a.current.map(N=>N.id));J.filter(N=>!D.has(N.id)&&N.sender==="customer").length>0&&!h.current&&le(S.userRef.current?.role)&&x(!0);break}}catch(l){console.warn(`[DataRefresh] Failed to refresh ${p}:`,l)}},[n.length,e.length,d,a,h,I,x,r,s,S]);Bn(v,500)},Xn=({currentView:n,isAdminChatOpen:e,handleCloseAdminChat:r})=>{t.useEffect(()=>{!n.startsWith("admin")&&e&&r()},[n,e,r])},Zn=t.lazy(()=>xe(()=>import("./pkg-toast-Dpd4iwUK.js"),__vite__mapDeps([0,1,2,3])).then(n=>({default:n.Toaster}))),er=typeof window<"u"&&(window.location.hostname==="superadmin.allinbangla.com"||window.location.hostname.startsWith("superadmin.")),_r=()=>xe(()=>import("./page-storecheckout-CVCnk0IN.js"),__vite__mapDeps([9,5,6,1,2,7,10,0,3,11,12,13,14,15,16,17,8,18,19,20,21,22,23,24])),xr=()=>xe(()=>import("./page-storeproductdetail-C9dtR2X2.js"),__vite__mapDeps([25,5,6,1,2,7,24,8,26,10,0,3,11,12,13,14,15,16,17,18,19,20,21,22,23])),Lr=()=>xe(()=>import("./page-storeprofile-B4iKxpaf.js"),__vite__mapDeps([27,5,6,1,2,7,8])),Ar=()=>{const n=bn(),{isLoading:e,setIsLoading:r,orders:s,setOrders:d,products:a,setProducts:h,logo:S,setLogo:m,themeConfig:y,setThemeConfig:b,websiteConfig:L,setWebsiteConfig:g,deliveryConfig:_,setDeliveryConfig:F,paymentMethods:A,setPaymentMethods:R,facebookPixelConfig:I,setFacebookPixelConfig:x,roles:v,setRoles:p,users:k,setUsers:w,categories:O,setCategories:l,subCategories:u,setSubCategories:P,childCategories:U,setChildCategories:J,brands:D,setBrands:T,tags:N,setTags:E,courierConfig:j,setCourierConfig:B,user:M,setUser:Y,isLoginOpen:Q,setIsLoginOpen:Z,wishlist:ee,setWishlist:ie,checkoutQuantity:be,setCheckoutQuantity:Le,selectedVariant:ge,setSelectedVariant:G,landingPages:ce,setLandingPages:X,selectedLandingPage:Ne,setSelectedLandingPage:he,refs:ne,handleMobileMenuOpenRef:Ae}=n,ae=ln(),{tenants:ue,activeTenantId:H,setActiveTenantId:me,hostTenantId:Ee,setHostTenantId:Oe,hostTenantSlug:Te,isTenantSwitching:pe,isTenantSeeding:o,deletingTenantId:c,applyTenantList:i,refreshTenants:C,completeTenantSwitch:W,tenantsRef:K,activeTenantIdRef:V}=ae,Ie=Fn({products:a,user:M,landingPages:ce,setSelectedLandingPage:he}),{currentView:Ce,setCurrentView:ye,adminSection:We,setAdminSection:Se,urlCategoryFilter:Ke,selectedProduct:$e,setSelectedProduct:Fe,storeSearchQuery:Ve,handleStoreSearchChange:Qe,handleProductClick:Xe,handleCategoryFilterChange:Ze,currentViewRef:je}=Ie,et=En({activeTenantId:H,isLoading:e,user:M,websiteConfig:L,isTenantSwitching:pe}),{isChatOpen:tt,isAdminChatOpen:He,chatMessages:nt,hasUnreadChat:rt,handleCustomerSendChat:ot,handleAdminSendChat:at,handleEditChatMessage:st,handleDeleteChatMessage:it,handleOpenChat:ct,handleCloseChat:dt,handleOpenAdminChat:Lt,handleCloseAdminChat:gt,loadChatMessages:At,resetChatLoaded:ht,setChatMessages:Ot,setHasUnreadChat:Tt,skipNextChatSaveRef:Dt,chatMessagesRef:Nt,isAdminChatOpenRef:Ft}=et,Mt=_n({user:M,products:a,tenantId:H}),{cartItems:Bt,handleCartToggle:mt,handleAddProductToCart:Ut}=Mt,Wt=t.useCallback(($,te,se)=>{mt($.id,{silent:!1})},[mt]),$t=xn({tenants:ue,users:k,activeTenantId:H,setUser:Y,setUsers:w,setActiveTenantId:me,setCurrentView:ye,setAdminSection:Se,setSelectedVariant:()=>G(null)}),{handleLogin:jt,handleRegister:Ht,handleGoogleLogin:qt,handleLogout:Jt,handleUpdateProfile:Gt}=$t,z=Cn({activeTenantId:H,products:a,wishlist:ee,checkoutQuantity:be,selectedProduct:$e,selectedVariant:ge,user:M,setProducts:h,setOrders:d,setRoles:p,setWishlist:ie,setCheckoutQuantity:Le,setSelectedProduct:Fe,setSelectedVariant:G,setSelectedLandingPage:he,setCurrentView:ye,setLogo:m,setThemeConfig:b,setWebsiteConfig:g,setDeliveryConfig:F,setPaymentMethods:R,setCourierConfig:B,setCategories:l,setSubCategories:P,setChildCategories:J,setBrands:T,setTags:E}),zt=t.useCallback(async $=>{const te={...$,tenantId:$.tenantId||H};X(se=>[te,...se]);try{return await f.saveImmediate("landing_pages",[te,...ne.landingPagesRef.current],H),console.log("[Landing Page] Saved to database:",te.id),!0}catch(se){throw console.error("[Landing Page] Failed to save:",se),X(de=>de.filter(_e=>_e.id!==te.id)),se}},[H,X,ne]),Yt=t.useCallback(async $=>{const te={...$,tenantId:$.tenantId||H};let se=[];X(de=>(se=de.some(Re=>Re.id===te.id)?de.map(Re=>Re.id===te.id?te:Re):[te,...de],se));try{return await f.saveImmediate("landing_pages",se,H),!0}catch(de){throw de}},[H,X]),Kt=t.useCallback(async($,te)=>{const se=new Date().toISOString();let de=[];X(_e=>(de=_e.map(Re=>Re.id===$?{...Re,status:te,updatedAt:se,publishedAt:te==="published"?se:void 0}:Re),de));try{await f.saveImmediate("landing_pages",de,H)}catch(_e){throw console.error("[Landing Page] Failed to update publish status:",_e),_e}},[X,H]);Ln({themeConfig:y,websiteConfig:L,activeTenantId:H,isLoading:e,currentView:Ce,isTenantSwitching:pe}),An(I),Jn({setUser:Y,setCurrentView:ye,setActiveTenantId:me,refs:ne}),Gn({user:M,refs:ne}),zn({user:M,activeTenantId:H,currentViewRef:je,refs:ne,setActiveTenantId:me,setCurrentView:ye,setAdminSection:Se}),Yn(H),Kn({activeTenantId:H,hostTenantSlug:Te||"",loadChatMessages:At,completeTenantSwitch:W,setActiveTenantId:me,setHostTenantId:Oe,setIsLoading:r,setProducts:h,setOrders:d,setLogo:m,setThemeConfig:b,setWebsiteConfig:g,setDeliveryConfig:F,setPaymentMethods:R,setLandingPages:X,setCategories:l,setSubCategories:P,setChildCategories:J,setBrands:T,setTags:E,refs:ne}),Vn({activeTenantId:H,currentView:Ce,tenants:ue,applyTenantList:i,setUsers:w,setRoles:p,setCourierConfig:B,setFacebookPixelConfig:x,setCategories:l,setSubCategories:P,setChildCategories:J,setBrands:T,setTags:E,refs:ne}),Qn({products:a,categories:O,activeTenantIdRef:V,currentViewRef:je,skipNextChatSaveRef:Dt,chatMessagesRef:Nt,isAdminChatOpenRef:Ft,refs:ne,setProducts:h,setOrders:d,setLogo:m,setThemeConfig:b,setWebsiteConfig:g,setDeliveryConfig:F,setPaymentMethods:R,setCategories:l,setLandingPages:X,setChatMessages:Ot,setHasUnreadChat:Tt}),Xn({currentView:Ce,isAdminChatOpen:He,handleCloseAdminChat:gt}),Pn({activeTenantId:H,isLoading:e,isTenantSwitching:pe,orders:s,products:a,logo:S,themeConfig:y,websiteConfig:L,deliveryConfig:_,courierConfig:j,facebookPixelConfig:I,roles:v,users:k,categories:O,subCategories:u,childCategories:U,brands:D,tags:N,landingPages:ce,refs:ne}),t.useEffect(()=>{ne.userRef.current=M},[M,ne]),t.useEffect(()=>{We==="tenants"&&!bt(M?.role)&&Se("dashboard")},[We,M,Se]);const Me=t.useCallback($=>{ae.handleTenantChange($,{onResetChat:ht,setUser:te=>Y(te(M)),setCurrentView:ye,setAdminSection:Se,setSelectedProduct:()=>Fe(null),setSelectedLandingPage:()=>he(null)})},[ae,ht,M,ye,Se,Fe,he,Y]),Vt=t.useCallback(async($,te)=>ae.handleCreateTenant($,te,Me),[ae,Me]),Qt=t.useCallback(async $=>ae.handleDeleteTenant($,Me),[ae,Me]),Xt=bt(M?.role),Zt=le(M?.role),pt=ue.find($=>$.id===H)||K.current.find($=>$.id===H)||null,en=!!Ee?ue.filter($=>$.id===Ee):ue,tn=Xt?en:pt?[pt]:[];return we.jsx(gn,{children:we.jsx(un,{children:we.jsx(fn,{children:we.jsx(pn,{themeConfig:y||void 0,children:we.jsxs(t.Suspense,{fallback:null,children:[we.jsx(Zn,{position:"top-right",toastOptions:{duration:2500}}),we.jsx("div",{className:"relative bg-gray-50 dark:bg-gray-900 min-h-screen transition-colors duration-300",children:we.jsx(an,{currentView:Ce,isSuperAdminSubdomain:er,products:a,orders:s,logo:S,themeConfig:y,websiteConfig:L,deliveryConfig:_,paymentMethods:A,courierConfig:j,facebookPixelConfig:I,categories:O,subCategories:u,childCategories:U,brands:D,tags:N,chatMessages:nt,user:M,wishlist:ee,cartItems:Bt,selectedProduct:$e,selectedLandingPage:Ne,selectedVariant:ge,checkoutQuantity:be,storeSearchQuery:Ve,urlCategoryFilter:Ke,activeTenantId:H,headerTenants:tn,isTenantSwitching:pe,isTenantSeeding:o,deletingTenantId:c,isChatOpen:tt,isAdminChatOpen:He,hasUnreadChat:rt,canAccessAdminChat:Zt,onProductClick:Xe,onQuickCheckout:z.handleCheckoutStart,onToggleWishlist:$=>z.isInWishlist($)?z.removeFromWishlist($):z.addToWishlist($),isInWishlist:z.isInWishlist,onLogin:jt,onRegister:Ht,onGoogleLogin:qt,onLogout:Jt,onUpdateProfile:Gt,onUpdateOrder:z.handleUpdateOrder,onAddProduct:z.handleAddProduct,onUpdateProduct:z.handleUpdateProduct,onDeleteProduct:z.handleDeleteProduct,onBulkDeleteProducts:z.handleBulkDeleteProducts,onBulkUpdateProducts:z.handleBulkUpdateProducts,onBulkFlashSale:z.handleBulkFlashSale,onUpdateLogo:z.handleUpdateLogo,onUpdateTheme:z.handleUpdateTheme,onUpdateWebsiteConfig:z.handleUpdateWebsiteConfig,onUpdateDeliveryConfig:z.handleUpdateDeliveryConfig,onUpdatePaymentMethods:z.handleUpdatePaymentMethods,onUpdateCourierConfig:z.handleUpdateCourierConfig,onPlaceOrder:z.handlePlaceOrder,onLandingOrderSubmit:z.handleLandingOrderSubmit,onCloseLandingPreview:z.handleCloseLandingPreview,onTenantChange:Me,onCreateTenant:Vt,onDeleteTenant:Qt,onRefreshTenants:C,onSearchChange:Qe,onCategoryFilterChange:Ze,onMobileMenuOpenRef:$=>{Ae.current=$},onToggleCart:Wt,onCheckoutFromCart:z.handleCheckoutFromCart,onAddToCart:Ut,onOpenChat:ct,onCloseChat:dt,onOpenAdminChat:Lt,onCloseAdminChat:gt,onCustomerSendChat:ot,onAdminSendChat:at,onEditChatMessage:st,onDeleteChatMessage:it,setCurrentView:ye,setUser:Y,setIsLoginOpen:Z,isLoginOpen:Q,landingPages:ce,onCreateLandingPage:zt,onUpsertLandingPage:Yt,onToggleLandingPublish:Kt,onAddOrder:z.handleAddOrder})})]})})})})})};export{Ar as default,_r as preloadCheckout,xr as preloadProductDetail,Lr as preloadStoreProfile};
