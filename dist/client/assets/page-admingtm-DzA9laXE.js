import{j as e}from"./react-jsx-runtime-BBsywpoz.js";import{r}from"./react-core-KcGD0Z1V.js";import{D as N}from"./cmp-dashboard-CvCpAVHs.js";import{aW as v,b0 as h,aK as b,ao as k,aZ as T}from"./icons-chunk-AVFeydwE.js";import"./pkg-eventemitter3-CXfM2dhT.js";import"./pkg-socket-B8R9XNBE.js";import"./pkg-engine-io-C8bqYME4.js";import"./pkg-@socket.io-component-emitter-B3A4JZne.js";import"./pkg-socket.io-parser-C0hgSYjy.js";import"./cmp-approutes-tsx-T9J5ygBG.js";import"./cmp-skeletonloaders-tsx-Durrj7lG.js";import"./cmp-addnewduemodal-tsx-OjU2U-0e.js";import"./cmp-admincustomization-DQ3Wytgo.js";import"./pkg-toast-Dpd4iwUK.js";import"./pkg-goober-N6sOClW1.js";import"./cmp-gallerypicker-tsx-CnyOus4y.js";import"./cmp-modern-dashboard-C6grFkCj.js";import"./cmp-invoiceprinttemplate-tsx-CUwUe6zE.js";import"./pkg-papaparse-BEpmA8em.js";import"./pkg-xlsx-BljOZNTS.js";import"./page-adminnote-C1Ob2d7z.js";import"./cmp-duehistorymodal-tsx-KQ79TbYj.js";const u=N,R=({onBack:y,tenantId:i})=>{const[a,m]=r.useState(""),[t,o]=r.useState(!1),[l,d]=r.useState(!0),[c,x]=r.useState(null),[f,j]=r.useState(!0),[p,g]=r.useState(!1);r.useEffect(()=>{(async()=>{try{const n=await u.get("gtm_config",{containerId:"",isEnabled:!1,enableDataLayer:!0},i);n&&(m(n.containerId||""),o(n.isEnabled||!1),d(n.enableDataLayer??!0))}catch(n){console.warn("Failed to load GTM config:",n)}finally{j(!1)}})()},[i]);const w=async()=>{if(t&&!a.trim()){alert("GTM Container ID is required while tracking is enabled.");return}if(a.trim()&&!a.trim().match(/^GTM-[A-Z0-9]+$/i)){alert("Invalid GTM Container ID format. It should be like GTM-XXXXXXX");return}g(!0);try{const s={containerId:a.trim().toUpperCase(),isEnabled:t,enableDataLayer:l};await u.save("gtm_config",s,i),x("Google Tag Manager settings saved. Changes apply instantly on storefront."),setTimeout(()=>x(null),4e3)}catch(s){console.error("Failed to save GTM config:",s),alert("Failed to save settings. Please try again.")}finally{g(!1)}};return f?e.jsxs("div",{className:"w-full max-w-5xl mx-auto p-2 animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-48 mb-8"}),e.jsx("div",{className:"h-24 bg-gray-200 rounded mb-6"}),e.jsx("div",{className:"h-12 bg-gray-200 rounded mb-4"}),e.jsx("div",{className:"h-12 bg-gray-200 rounded"})]}):e.jsxs("div",{className:"w-full max-w-5xl mx-auto space-y-4 sm:space-y-6 lg:space-y-8 animate-fade-in px-3 sm:px-4 lg:px-2",children:[e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx("button",{onClick:y,className:"p-1.5 sm:p-2 hover:bg-gray-200 rounded-full transition flex-shrink-0",children:e.jsx(v,{size:18,className:"text-gray-600 sm:w-5 sm:h-5"})}),e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-900 truncate",children:"Google Tag Manager"})]}),e.jsxs("div",{className:"flex items-start gap-3 sm:gap-4",children:[e.jsx("div",{className:"w-10 sm:w-12 h-10 sm:h-12 rounded-full bg-blue-500 flex items-center justify-center flex-shrink-0 border-2 sm:border-4 border-blue-100 shadow-sm ring-1 ring-blue-400",children:e.jsx(h,{size:20,className:"text-white sm:w-6 sm:h-6"})}),e.jsxs("div",{className:"pt-0.5 sm:pt-1 flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-3",children:[e.jsx("h3",{className:"text-sm sm:text-base lg:text-lg font-medium text-gray-900",children:"Google Tag Manager"}),e.jsx("span",{className:`inline-flex items-center gap-1 px-2 sm:px-3 py-0.5 sm:py-1 rounded-full text-[10px] sm:text-xs font-semibold ${t&&a?"bg-green-100 text-green-700":"bg-amber-100 text-amber-700"}`,children:t&&a?e.jsxs(e.Fragment,{children:[e.jsx(b,{size:10,className:"sm:w-3 sm:h-3"})," Live"]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{size:10,className:"sm:w-3 sm:h-3"})," Inactive"]})})]}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 line-clamp-2",children:"Manage all marketing tags, analytics, and tracking in one place."})]})]}),c&&e.jsxs("div",{className:"bg-green-50 border border-green-200 text-green-700 px-3 sm:px-4 py-2 sm:py-3 rounded-lg flex items-center gap-2 text-xs sm:text-sm",children:[e.jsx(b,{size:16,className:"sm:w-[18px] sm:h-[18px]"})," ",c]}),e.jsxs("div",{className:"space-y-3 sm:space-y-4 lg:space-y-6 max-w-3xl pt-1 sm:pt-2",children:[e.jsxs("div",{className:"flex items-center justify-between border border-gray-200 rounded-lg sm:rounded-xl p-3 sm:p-4 bg-white shadow-sm gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-semibold text-gray-800 text-sm sm:text-base",children:"Enable GTM"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 line-clamp-2",children:"Turn this off to pause GTM without losing your container ID."})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer flex-shrink-0",children:[e.jsx("input",{type:"checkbox",className:"sr-only",checked:t,onChange:s=>o(s.target.checked)}),e.jsx("span",{className:`w-11 sm:w-14 h-6 sm:h-7 flex items-center rounded-full px-1 transition ${t?"bg-green-500":"bg-gray-300"}`,children:e.jsx("span",{className:`bg-white w-5 sm:w-6 h-5 sm:h-6 rounded-full shadow transform transition ${t?"translate-x-5 sm:translate-x-7":""}`})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2",children:"GTM Container ID"}),e.jsx("input",{type:"text",placeholder:"GTM-XXXXXXX",className:"w-full px-3 sm:px-4 py-2 sm:py-2.5 lg:py-3 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-700 placeholder-gray-400 shadow-sm font-mono",value:a,onChange:s=>m(s.target.value.toUpperCase())}),e.jsx("p",{className:"text-[10px] sm:text-xs text-gray-500 mt-1",children:"Find in GTM → Admin → Container Settings"})]}),e.jsxs("div",{className:"flex items-center justify-between border border-gray-200 rounded-lg sm:rounded-xl p-3 sm:p-4 bg-white shadow-sm gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-semibold text-gray-800 text-sm sm:text-base",children:"Enhanced Data Layer"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 line-clamp-2",children:"Push e-commerce events to dataLayer for advanced tracking."})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer flex-shrink-0",children:[e.jsx("input",{type:"checkbox",className:"sr-only",checked:l,onChange:s=>d(s.target.checked)}),e.jsx("span",{className:`w-11 sm:w-14 h-6 sm:h-7 flex items-center rounded-full px-1 transition ${l?"bg-green-500":"bg-gray-300"}`,children:e.jsx("span",{className:`bg-white w-5 sm:w-6 h-5 sm:h-6 rounded-full shadow transform transition ${l?"translate-x-5 sm:translate-x-7":""}`})})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 sm:p-4",children:[e.jsxs("h4",{className:"font-semibold text-blue-800 mb-1.5 sm:mb-2 flex items-center gap-2 text-sm sm:text-base",children:[e.jsx(h,{size:14,className:"sm:w-4 sm:h-4"})," What can you do with GTM?"]}),e.jsxs("ul",{className:"text-xs sm:text-sm text-blue-700 space-y-0.5 sm:space-y-1.5",children:[e.jsx("li",{children:"• Add GA4, Facebook Pixel, TikTok Pixel"}),e.jsx("li",{children:"• Track custom events & conversions"}),e.jsx("li",{children:"• A/B testing and remarketing"})]}),e.jsxs("a",{href:"https://tagmanager.google.com/",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1.5 mt-2 sm:mt-3 text-xs sm:text-sm font-medium text-blue-600 hover:text-blue-800",children:["Open GTM ",e.jsx(T,{size:12,className:"sm:w-3.5 sm:h-3.5"})]})]}),l&&e.jsxs("div",{className:"bg-gray-50 border border-dashed border-gray-200 rounded-lg p-3 sm:p-4",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-1.5 sm:mb-2 text-sm sm:text-base",children:"Available dataLayer Events"}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-1.5 sm:gap-2 text-[10px] sm:text-xs",children:[e.jsx("code",{className:"bg-white px-1.5 sm:px-2 py-0.5 sm:py-1 rounded border text-gray-600 truncate",children:"view_item"}),e.jsx("code",{className:"bg-white px-1.5 sm:px-2 py-0.5 sm:py-1 rounded border text-gray-600 truncate",children:"add_to_cart"}),e.jsx("code",{className:"bg-white px-1.5 sm:px-2 py-0.5 sm:py-1 rounded border text-gray-600 truncate",children:"remove_from_cart"}),e.jsx("code",{className:"bg-white px-1.5 sm:px-2 py-0.5 sm:py-1 rounded border text-gray-600 truncate",children:"begin_checkout"}),e.jsx("code",{className:"bg-white px-1.5 sm:px-2 py-0.5 sm:py-1 rounded border text-gray-600 truncate",children:"purchase"}),e.jsx("code",{className:"bg-white px-1.5 sm:px-2 py-0.5 sm:py-1 rounded border text-gray-600 truncate",children:"search"})]})]}),e.jsx("div",{className:"flex justify-end pt-2 sm:pt-4",children:e.jsx("button",{onClick:w,disabled:p,className:"px-4 sm:px-6 py-2 sm:py-2.5 lg:py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 shadow-lg shadow-blue-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 text-sm",children:p?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-3.5 sm:w-4 h-3.5 sm:h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Saving..."]}):"Save"})})]})]})};export{R as default};
